try{!function(e,t){"use strict";if(!e.document)throw new Error("kLib requires a window with a document");!function(e){if(void 0!==e.klevu)return e.klevu;var t=function e(t){return e.pt.options(t)};function n(){"undefined"!=typeof klevu_apiKey&&(t.settings.search={apiKey:klevu_apiKey},t.settings.analytics={apiKey:klevu_apiKey});var e=ce();e.length>0&&t.each(e,(function(e,n){t.strStartsWith(n.name,"klib_")&&(n.name=n.name.replace("klib_","").replace(new RegExp(/_/,"g"),"."),B(C,n.name,n.value))})),t.interactive(),t.ready(),C.chains.initChain=t.chain(),C.console.type.general&&je("KlevuLib - Debug - activated and set to level "+C.console.level)}t.pt=t.prototype={version:s,constructor:t},t.options=t.pt.options=function(e){return t.extend(!0,C,e),t.reInitialize(),this},t.reInitialize=function(){return C.chains.initChain.list().length>0&&(C.chains.initChain.setData(C),C.chains.initChain.fire()),this};var s="2.9.1",a=e.document,i="Boolean Number String Function Array Date RegExp Object Error Symbol",o=[],c=(o.slice,o.concat,o.push),r=o.indexOf,l=Object.getPrototypeOf,u={},d=u.toString,p=u.hasOwnProperty,g=p.toString,m=g.call(Object),h=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,f=/[^\x20\t\r\n\f]+/g,v=/\[\]$/,b=/%20/g,S=/#.*$/,y=/([?&])_=[^&]*/,k=/^(.*?):[ \t]*([^\r\n]*)$/gm,O=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,j=/^\/\//,x=/^(?:GET|HEAD)$/,P=/\?/,C={url:{protocol:a.location.protocol}};String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return this.substr(!t||t<0?0:+t,e.length)===e});e.document.querySelectorAll||(e.document.querySelectorAll=function(t){var n,s=e.document.createElement("style"),a=[];if(e.document.documentElement.firstChild.appendChild(s),e.document._qsa=[],!s.styleSheet||void 0===s.styleSheet.cssText)return a;for(s.styleSheet.cssText=t+"{x-qsa:expression(window.document._qsa && window.document._qsa.push(this))}",e.scrollBy(0,0),s.parentNode.removeChild(s);e.document._qsa.length;)(n=e.document._qsa.shift()).style.removeAttribute("x-qsa"),a.push(n);return e.document._qsa=null,a});e.document.querySelector||(e.document.querySelector=function(t){var n=e.document.querySelectorAll(t);return n.length?n[0]:null});Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(e){for(var t=(this.document||this.ownerDocument).querySelectorAll(e),n=t.length;--n>=0&&t.item(n)!==this;);return n>-1});Array.prototype.filter||(Array.prototype.filter=function(e,t){if("Function"!=typeof e&&"function"!=typeof e||!this)throw new TypeError;var n=this.length>>>0,s=new Array(n),a=this,i=0,o=-1;if(void 0===t)for(;++o!==n;)o in this&&e(a[o],o,a)&&(s[i++]=a[o]);else for(;++o!==n;)o in this&&e.call(t,a[o],o,a)&&(s[i++]=a[o]);return s.length=i,s});Array.prototype.forEach||(Array.prototype.forEach=function(e){var t,n;if(null===this)throw new TypeError("this is null or not defined");var s=Object(this),a=s.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(arguments.length>1&&(t=arguments[1]),n=0;n<a;){var i;n in s&&(i=s[n],e.call(t,i,n,s)),n++}});function E(){if(!a.documentElement.dataset)return!1;var e=a.createElement("div");return e.setAttribute("data-a-b","c"),e.dataset&&"c"==e.dataset.aB}E()||Object.defineProperty(Element.prototype,"dataset",{get:function(){for(var e=this,t=this.attributes,n={},s=0;s<t.length;s++){var a=t[s];if(a&&a.name&&/^data-\w[\w-]*$/.test(a.name)){var i=a.name,o=a.value,c=i.substr(5).replace(/-./g,(function(e){return e.charAt(1).toUpperCase()}));Object.defineProperty(n,c,{enumerable:!0,get:function(){return this.value}.bind({value:o||""}),set:function(e,t){void 0!==t?this.setAttribute(e,t):this.removeAttribute(e)}.bind(e,i)})}}return n}});"function"!=typeof NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach);"function"!=typeof e.isNaN&&(e.isNaN=function(e){var t=Number(e);return t!=t});"function"!=typeof Number.isNaN&&(Number.isNaN=Number.isNaN||function(e){return"number"==typeof e&&e!=e});function w(e){return Object.keys(e).map((function(t){return t+"="+e[t]})).join("&")}function D(e,t,n){return e.substr(!n||n<0?0:+n,t.length)===t}function T(e){return void 0===e}function q(e){switch(t.type(e)){case"string":return"true"===e||"1"===e;case"boolean":return!!e;case"number":return 1===e;default:return!1}}function U(e){return T(e)&&null!==e&&e===e.window}function F(e,t,n){var s,i=(t=t||a).createElement("script"),o={type:!0,src:!0,noModule:!0};if(i.text=e,n)for(s in o)n[s]&&(i[s]=n[s]);t.head.appendChild(i).parentNode.removeChild(i)}function _(e){F(e)}function A(e){return"function"==typeof e&&"number"!=typeof e.nodeType}function L(e){return null===e?e+"":"object"==typeof e||"function"==typeof e?u[d.call(e)]||"object":typeof e}function I(e){var t,n;return!(!e||"[object Object]"!==d.call(e))&&(!(t=l(e))||"function"==typeof(n=p.call(t,"constructor")&&t.constructor)&&g.call(n)===m)}function R(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function M(e){return e=e.replace(new RegExp("[\\]]",["g"]),"").split(new RegExp("[\\[\\.]",["g"]))}function G(e,n,s){t.isUndefined(s)&&(s=void 0);var a=n.shift();return 0===n.length?T(e[a])?s:e[a]:T(e[a])?s:G(e[a],n,s)}function K(e,n,s){if(t.isUndefined(s)&&(s=void 0),!T(e)&&I(e))return G(e,n=M(n),s)}function N(e,n,s){if(t.isUndefined(s)&&(s=void 0),!T(e))return G(e,n=M(n),s)}function B(e,t,n){if(T(n))return e;for(var s=-1,a=(t=M(t)).length,i=a-1,o=e;++s<a;){var c=t[s];s===i?o[c]=n:(T(o[c])||null===o[c])&&(o[c]={}),o=o[c]}return e}function H(e){for(var t=Object.keys(e),n={check:function(e){return null==e||e===[]||e==={}||!1===e||0===e||""===e||"number"!=typeof e&&"boolean"!=typeof e&&R(e)},filter:function(e){return!n.check(e)},sanitise:function(e,t){return!!n.check(e[t])&&(delete e[t],!0)}},s=0;s<t.length;s++){var a=t[s];n.sanitise(e,a)||"object"==typeof e[a]&&(e[a]=H(e[a]),W(e[a])&&(e[a]=e[a].filter(n.filter)),n.sanitise(e,a))}return e}function V(e,t){var n=Object.prototype.toString.call(e);if(n!==Object.prototype.toString.call(t))return!1;if(["[object Array]","[object Object]"].indexOf(n)<0)return!1;var s="[object Array]"===n?e.length:Object.keys(e).length;if(s!==("[object Array]"===n?t.length:Object.keys(t).length))return!1;var a=function(e,t){var n=Object.prototype.toString.call(e);if(["[object Array]","[object Object]"].indexOf(n)>=0){if(!V(e,t))return!1}else{if(n!==Object.prototype.toString.call(t))return!1;if("[object Function]"===n){if(e.toString()!==t.toString())return!1}else if(e!==t)return!1}};if("[object Array]"===n){for(var i=0;i<s;i++)if(!1===a(e[i],t[i]))return!1}else for(var o in e)if(e.hasOwnProperty(o)&&!1===a(e[o],t[o]))return!1;return!0}function W(e){var t=!!e&&"length"in e&&e.length,n=L(e);return!A(e)&&!U(e)&&("array"===n||0===t||"number"==typeof t&&t>0&&t-1 in e)}function J(e,t,n){return null===t?-1:r.call(t,e,n)}function $(e,t){for(var n=+t.length,s=0,a=e.length;s<n;s++)e[a++]=t[s];return e.length=a,e}function Q(e,t){var n=t||[];return null!==e&&(W(Object(e))?$(n,"string"==typeof e?[e]:e):c.call(n,e)),n}function X(e){if(!t.isArrayLike(e))return!1;var n=function(e,t,n){return n.indexOf(e)===t};return e.filter(n)}function z(e){var t=L(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))}function Y(e){var t=L(e);return"number"===t||"string"===t}function Z(e){return null===e?"":(e+"").replace(h,"")}function ee(e,t){var n,s=0;if(W(e))for(n=e.length;s<n&&!1!==t.call(e[s],s,e[s]);s++);else for(s in e)if(e.hasOwnProperty(s)&&!1===t.call(e[s],s,e[s]))break;return e}function te(e,t){var n=0,s=[];if(W(e))for(n=e.length-1;n>=0&&!1!==t.call(e[n],n,e[n]);n--);else{for(n in e)e.hasOwnProperty(n)&&s.push(n);te(s,(function(n,s){if(!1===t.call(e[s],s,e[s]))return!1}))}return e}function ne(e){var t={};return ee(e.match(f)||[],(function(e,n){t[n]=!0})),t}"function"==typeof Symbol&&(t.pt[Symbol.iterator]=o[Symbol.iterator]);function se(t){return e.btoa(e.encodeURIComponent(t).replace(/%([0-9A-F]{2})/g,(function(e,t){return String.fromCharCode(parseInt(t,16))})))}function ae(t){return e.decodeURIComponent(Array.prototype.map.call(e.atob(t),(function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)})).join(""))}function ie(e){return e!==Object(e)}function oe(t){var n,s,a=e.location.search.substring(1).split("&");for(s=0;s<a.length;s++)if((n=a[s].split("="))[0]===t)try{return void 0!==n[1]&&decodeURIComponent(n[1])}catch(e){return Se(e,"UrlParam"),ke(e),!1}}function ce(){var t,n,s=e.location.search.substring(1).split("&"),a=[];for(n=0;n<s.length;n++){t=s[n].split("=");try{a.push({name:t[0],value:void 0!==t[1]&&decodeURIComponent(t[1])})}catch(e){Se(e,"UrlParam"),ke(e)}}return a}function re(e,n,s,a){t.isUndefined(a)&&(a={settings:t.settings}),null===a&&(a={settings:t.settings}),t.isUndefined(s)&&(s=void 0),e={settings:e.settings};var i=t.getObjectPath(e,n),o=t.getObjectPath(a,n);return t.isUndefined(i)?t.isUndefined(o)?s:o:I(i)||Array.isArray(i)?t.extend(!0,{},t.extend(!0,o,i)):i}function le(e,t){return re({settings:{}},e="settings."+e,t,null)}function ue(e,n,s,a){return T(a)&&(a=!1),B(a?{settings:t.settings}:e,n,s),re(e,n)}function de(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}function pe(){return"f"+de().replace(new RegExp("-","g"),"")}function ge(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return"kl"+e()+e()+e()}function me(e){var t=0,n=e.length,s=0;if(n>0)for(;s<n;)t=(t<<5)-t+e.charCodeAt(s++)|0;return t}function he(e,n,s){var a;if(Array.isArray(n))t.each(n,(function(t,n){v.test(e)?s(e,n):he(e+"["+("object"==typeof n&&null!==n?t:"")+"]",n,s)}));else if("object"===L(n))for(a in n)he(e+"["+a+"]",n[a],s);else s(e,n)}function fe(n){var s;if(!n||"string"!=typeof n)return null;try{s=(new e.DOMParser).parseFromString(n,"text/xml")}catch(e){s=void 0}return s&&!s.getElementsByTagName("parsererror").length||t.error("Invalid XML: "+n),s}function ve(e,t){for(var n=Array.prototype.slice.call(arguments,2),s=e.split("."),a=s.pop(),i=0;i<s.length;i++)t=t[s[i]];return t[a].apply(t,n)}function be(e,t){(new Image).src="//"+C.console.errorReporting+"/error-log?type=jsv2&c="+t+"&m="+encodeURIComponent(e)}function Se(e,t){be('{"error":"LOAD","extra": {"name":"'+e.name+'","line":"'+(e.lineNumber||e.line)+'","script":"'+(e.fileName||e.sourceURL||e.script)+'","stack":"'+(e.stackTrace||e.stack)+'","namespace":"kLib","message":"'+e.message+'"}}',t)}function ye(e){C.console.active&&console.log(e)}function ke(e){C.console.level>=1&&ye(e)}function Oe(e){C.console.level>=2&&ye(e)}function je(e){C.console.level>=3&&ye(e)}function xe(e){C.console.level>=4&&ye(e)}ee(ne(i),(function(e){u["[object "+e+"]"]=e.toLowerCase()})),t.param=function(e){var n,s=[],a=function(e,t){var n=A(t)?t():t;s[s.length]=encodeURIComponent(e)+"="+encodeURIComponent(null===n?"":n)};if(Array.isArray(e)||e.version&&!t.isPlainObject(e))t.each(e,(function(){a(this.name,this.value)}));else for(n in e)he(n,e[n],a);return s.join("&")},t.extend=t.pt.extend=function(){var e,n,s,a,i,o,c=arguments[0]||{},r=1,l=arguments.length,u=!1;for("boolean"==typeof c&&(u=c,c=arguments[r]||{},r++),"object"==typeof c||A(c)||(c={}),r===l&&(c=this,r--);r<l;r++)if(null!==(e=arguments[r])){if(I(e)&&e.hasOwnProperty("isKlevuChain")){c=t.chainClone(e);continue}for(n in e)s=c[n],c!==(a=e[n])&&(u&&a&&(t.isPlainObject(a)||(i=Array.isArray(a)))?(i?(i=!1,o=s&&Array.isArray(s)?s:[]):o=s&&t.isPlainObject(s)?s:{},a.hasOwnProperty("isKlevuChain")?c[n]=t.chainClone(a):c[n]=t.extend(u,o,a)):void 0!==a&&(c[n]=a))}return c},t.extend({version:s,uid:"kLib-"+de(),class2type:u,settings:C,type:L,toBoolean:q,isFunction:A,isWindow:U,isUndefined:T,isPlainObject:I,isEmptyObject:R,isEqualObj:V,isNumeric:z,isString:Y,strStartsWith:D,isArray:Array.isArray,isArrayLike:W,inArray:J,makeArray:Q,toUniqueArray:X,parseJSON:JSON.parse,parseXML:fe,each:ee,eachReverse:te,getObjectPath:K,getObjectPathValue:G,getInterfaceObjectPath:N,setObjectPath:B,isPrimitive:ie,decode:ae,encode:se,getUrlParameter:oe,getSetting:re,setSetting:ue,getGlobalSetting:le,clean:H,randomId:de,randomClass:ge,hashCode:me,getAllUrlParameters:ce,queryString:w,globalEval:_,executeFunctionByName:ve,randomFunctionName:pe}),t.support={list:{},hooks:{},register:function(e){if(t.isUndefined(e.name))return!1;if(t.isUndefined(e.objectType)){let t=e.name.split(".");t.length>1?(e.objectType=t[0],e.name=t[1]):e.objectType=e.name}t.isUndefined(e.dependency)&&(e.dependency=[]),t.isUndefined(e.loaded)&&(e.loaded=!0),t.isUndefined(e.active)&&(e.active=!1),t.setObjectPath(t.support.list,e.name,{loaded:e.loaded,active:e.active,objectType:e.objectType,dependency:e.dependency}),e.objectType!==e.name&&t.setObjectPath(t.support,e.objectType+"."+e.name,!0),t.setObjectPath(t.support,e.name,!0),t.support.isActive(e.name)&&t.eachReverse(t.support.hooks,(function(n,s){n.replace(new RegExp("([_])",["g"]),".").includes(e.name)&&t.support.test(n.split(","))&&(t.each(s,(function(e,t){t()})),delete t.support.hooks[n])}))},isLoaded:function(e){return t.getObjectPath(t.support.list,e+".loaded",!1)},isActive:function(e,n){if(t.isUndefined(n)){let t=e.split(".");t.length>1?(n=t[0],e=t[1]):n=e}let s=t.getObjectPath(t.support.list,e+".active",!1),a=t.getObjectPath(t.support.list,"core."+e+".active",!1),i=t.getObjectPath(t.support.list,e.replace(/^(core\.)/,"")+".active",!1),o=t.getObjectPath(t.support.list,n+"."+e+".active",!1);return!!(s||a||i||o)},test:function(e){e=e.sort();let n=!0;return t.each(e,(function(e,s){if(s=s.replace(new RegExp("([_])",["g"]),"."),!t.support.isActive(s)){let e=s.split(".");e.length>1&&t.support.isActive(e[1],e[0])||(n=!1)}})),n},hook:function(e,n,s){if(t.isUndefined(s)&&(s=t.randomId()),t.support.test(e))n();else{let a={};a[s]=n,a=t.extend(t.getObjectPath(t.support.hooks,e.join(",").replace(new RegExp("([.])",["g"]),"_"),{}),a),t.setObjectPath(t.support.hooks,e.join(",").replace(new RegExp("([.])",["g"]),"_"),a)}}},t.constructors={list:{},add:function(e){if(t.isUndefined(e.name))return!1;t.isUndefined(e.dependency)&&(e.dependency=[]),t.isUndefined(e.create)&&(e.create=function(){}),t.isUndefined(e.chains)&&(e.chains={}),t.isUndefined(e.loaded)&&(e.loaded=!0);let n=e.name;t.setObjectPath(t.constructors.list,n+".create",e.create),t.setObjectPath(t.constructors.list,n+".chains",e.chains),t.setObjectPath(t.constructors.list,n+".dependency",e.dependency),t.setObjectPath(t.constructors.list,n+".loaded",e.loaded)},get:function(e){return!t.isUndefined(e)&&t.getObjectPath(t.constructors.list,e,!1)},construct:function(e){if(t.isUndefined(e))return!1;return t.getObjectPath(t.constructors.list,e+".create",!1)()},isLoaded:function(e){return!t.isUndefined(e)&&t.getObjectPath(t.constructors.list,e+".loaded",!1)}},t.support.register({name:"constructors",objectType:"core",active:!0}),t.extend(!0,C,{console:{active:!1,errorReporting:"stats.ksearchnet.com",level:1,type:{general:!1,ajax:!1,chain:!1,translator:!1,template:!1,event:!1,storage:!1,assets:!1}}}),t.extend({logError:ke,logWarning:Oe,logInfo:je,logDebug:xe,sendImageReportToKlevu:be}),t.support.register({name:"log",objectType:"core",loaded:!0,active:!0,dependency:[]}),t.css=t.pt.css={rawData:function(e){try{this.data=ae(e)}catch(e){return this.data="",C.console.type.general&&(ke("CSS decoding error"),ke(e)),void Se(e,"CSS-Decode")}this.insertReplace()},link:function(e,n){T(n)&&(n="kLib-css"),t.dom.helpers.removeElementFromDocument("kLib-css"),t.dom.helpers.addElementToHead({content:e,type:"css-link",name:n})},data:null,origData:null,insertReplace:function(){if(this.data!==this.origData)return t.dom.helpers.removeElementFromDocument("kLib-css"),t.dom.helpers.addElementToHead({content:this.data,type:"css",name:"kLib-css"}),C.console.type.general&&(je("CSS inserted/replaced in main document"),xe(this.data)),this.origData=this.data,!0}},t.support.register({name:"css",objectType:"core",loaded:!0,active:!0,dependency:["core.dom"]}),t.extend(!0,C,{chains:{}}),t.extend({chain:function(e){var n,s={stopOnFalse:!1,list:[],fireList:[],queue:[],firingIndex:-1,firing:!1,fired:!1,parameters:{},scope:{},spacer:10,webhook:{run:!1,name:!1,object:!1,scope:"all"}},a="string"==typeof e?s:t.extend(!0,s,e),i=function(){if(a.fired=a.firing=!0,a.webhook.run&&a.webhook.name&&a.webhook.object){let e=t.extend(!0,{},a.webhook);e.action="before",t.event.webhook.runForScopeList({data:a.parameters,scope:a.scope,settings:e})}for(;a.queue.length;a.firingIndex=-1)for(n=a.queue.shift();++a.firingIndex<a.fireList.length;)!1===a.fireList[a.firingIndex].apply(n[0],n[1])&&a.stopOnFalse&&(C.console.type.chain&&Oe("KlevuLib - Chain - Fire - stopped because false was returned"),a.firingIndex=a.fireList.length,n=!1);if(a.webhook.run&&a.webhook.name&&a.webhook.object){let e=t.extend(!0,{},a.webhook);e.action="after",t.event.webhook.runForScopeList({data:a.parameters,scope:a.scope,settings:e})}a.firing=!1};function o(){a.fireList=[],t.each(a.list,(function(e,t){!R(t)&&A(t.func)&&a.fireList.push(t.func)})),a.firingIndex=a.fireList.length}var c={list:function(){var e=[];return t.each(a.list,(function(t,n){R(n)||e.push({name:n.name,position:t,function:n.func})})),e},indexOf:function(e){var n=-1;return t.each(a.list,(function(t,s){if(!R(s)&&s.name===e)return n=t,!1})),n},positionOf:function(e){var t=c.indexOf(e);return"boolean"!==L(t)&&t},add:function(){var e;return a.list&&(e=arguments,t.each(e,(function(e,t){if(z(t.position)||(t.position=a.list.length+a.spacer),A(t.fire)){-1!==c.indexOf(t.name)&&c.remove({name:t.name});var n={name:t.name,func:t.fire};R(a.list[t.position])?a.list[t.position]=n:a.list.splice(t.position,0,n)}})),o()),this},addBefore:function(e,t){var n=c.indexOf(e);return-1!==n&&(t.position=n,c.add(t)),this},addAfter:function(e,t){var n=c.indexOf(e);return-1!==n&&(t.position=n+1,c.add(t)),this},remove:function(){return t.each(arguments,(function(e,t){if(T(t.position)){if(!T(t.name)){var n=c.indexOf(t.name);n>=0&&a.list.splice(n,1,{})}}else R(a.list[t.position])||a.list.splice(t.position,1,{})})),o(),this},move:function(){return t.each(arguments,(function(e,n){if(!T(n.name)){z(n.position)||(n.hasOwnProperty("before")?n.position=c.indexOf(n.before):n.hasOwnProperty("after")&&(n.position=c.indexOf(n.after)+1));var s=c.indexOf(n.name);if(s>=0){var i=t.extend(!0,{},a.list[s]);c.remove({position:s}),a.list.splice(n.position,0,i),o()}}})),this},fireWith:function(e,t){if(T((t=[e,(t=t||[]).slice?t.slice():t])[1][0])){if(!c.hasData())return C.console.type.chain&&Oe("KlevuLib - Chain - Fire - could not complete because no data was set or provided"),this;C.console.type.chain&&xe("KlevuLib - Chain - Fire - no data override was set or provided - using set data"),t[1][0]=c.getData(),t[1].length=1,c.hasScope()&&(t[1][1]=c.getScope(),t[1].length++)}else a.parameters=t[1][0],T(t[1][1])||(a.scope=t[1][1]);return C.console.type.chain&&(xe("KlevuLib - Chain - Fire - Chain"),xe(c.list()),xe("KlevuLib - Chain - Fire - with data"),xe(a.parameters),xe("KlevuLib - Chain - Fire - with scope"),xe(a.scope)),a.queue.push(t),a.firing||(a.firingIndex=-1,i()),this},fire:function(){return c.fireWith(this,arguments),this},empty:function(){return a.list&&(a.list=[]),o(),this},fired:function(){return a.fired},stopOnFalse:function(e){return a.stopOnFalse=e,this},hasData:function(){return!R(a.parameters)},setData:function(e){return C.console.type.chain&&(xe("KlevuLib - Chain - setData - with data"),xe(e)),a.parameters=e,a.fired=!1,this},getData:function(){return a.parameters},hasScope:function(){return!R(a.scope)},setScope:function(e){C.console.type.chain&&(xe("KlevuLib - Chain - setScope - with data"),xe(e)),a.scope=e,a.fired=!1;let n=t.getObjectPath(a,"scope.webhookSettings",!1);return n&&(a.webhook=t.extend(!0,a.webhook,n)),this},setWebhookSettings:function(e){return e&&(a.webhook=t.extend(!0,a.webhook,e)),this},getWebhookSettings:function(){return a.webhook},getScope:function(){return a.scope},regenerateFireList:o,getOptions:function(){return a},options:a,isKlevuChain:!0};return c},chainClone:function(e){var n={list:t.extend(!0,[],e.getOptions().list),parameters:t.extend(!0,{},e.getOptions().parameters),scope:t.extend(!0,{},{}),stopOnFalse:t.extend(!0,{},e.getOptions().stopOnFalse),webhook:t.extend(!0,{},e.getOptions().webhook)},s=t.chain(n);return s.regenerateFireList(),s}}),t.support.register({name:"chains",objectType:"core",loaded:!0,active:!0,dependency:["core.webhook"]});var Pe=Date.now(),Ce={},Ee={},we="*/".concat("*"),De=a.createElement("a");function Te(e,t,n){for(var s,a,i,o,c=e.contents,r=e.dataTypes;"*"===r[0];)r.shift(),void 0===s&&(s=e.mimeType||t.getResponseHeader("Content-Type"));if(s)for(a in c)if(c[a]&&c[a].test(s)){r.unshift(a);break}if(r[0]in n)i=r[0];else{for(a in n){if(!r[0]||e.converters[a+" "+r[0]]){i=a;break}o||(o=a)}i=i||o}if(i)return i!==r[0]&&r.unshift(i),n[i]}function qe(e,t,n,s){var a,i,o,c,r,l={},u=e.dataTypes.slice();if(u[1])for(o in e.converters)l[o.toLowerCase()]=e.converters[o];for(i=u.shift();i;)if(e.responseFields[i]&&(n[e.responseFields[i]]=t),!r&&s&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),r=i,i=u.shift())if("*"===i)i=r;else if("*"!==r&&r!==i){if(!(o=l[r+" "+i]||l["* "+i]))for(a in l)if((c=a.split(" "))[1]===i&&(o=l[r+" "+c[0]]||l["* "+c[0]])){!0===o?o=l[a]:!0!==l[a]&&(i=c[0],u.unshift(c[1]));break}if(!0!==o)if(o&&e.throws)t=o(t);else try{t=o(t)}catch(e){return C.console.type.ajax&&(ke("KlevuLib - AJAX - ajaxConvert - can not convert data from "+r+" to "+i),xe(e.message)),{state:"parsererror",error:o?e:"No conversion from "+r+" to "+i}}}return{state:"success",data:t}}function Ue(e,n){var s,a,i=t.ajaxSettings.flatOptions||{};for(s in n)void 0!==n[s]&&((i[s]?e:a||(a={}))[s]=n[s]);return a&&t.extend(!0,e,a),e}function Fe(e){return function(t,n){"string"!=typeof t&&(n=t,t="*");var s,a=0,i=t.toLowerCase().match(f)||[];if(A(n))for(;s=i[a++];)"+"===s[0]?(s=s.slice(1)||"*",(e[s]=e[s]||[]).unshift(n)):(e[s]=e[s]||[]).push(n)}}function _e(e,n,s,a){var i={},o=e===Ee;function c(r){var l;return i[r]=!0,t.each(e[r]||[],(function(e,t){var r=t(n,s,a);return"string"!=typeof r||o||i[r]?o?!(l=r):void 0:(n.dataTypes.unshift(r),c(r),!1)})),l}return c(n.dataTypes[0])||!i["*"]&&c("*")}De.href=location.href,t.extend({lastModified:{},etag:{},ajaxSettings:{url:location.href,type:"GET",isLocal:O.test(location.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":we,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":fe},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,n){return C.console.type.ajax&&(je("KlevuLib - AJAX - ajaxSetup executed"),xe("KlevuLib - AJAX - ajaxSetup - target passed"),xe(e),xe("KlevuLib - AJAX - ajaxSetup - settings passed"),xe(n)),n?Ue(Ue(e,t.ajaxSettings),n):Ue(t.ajaxSettings,e)},ajaxPrefilter:Fe(Ce),ajaxTransport:Fe(Ee),ajax:function(n,s){"object"==typeof n&&(s=n,n=void 0),s=s||{};var i,o,c,r,l,u,d,p,g,m=t.ajaxSetup({},s),h=m.context||m,v=m.statusCode||{},O={},E={},w="canceled",D={readyState:0,callbacks:{},getResponseHeader:function(e){var t;if(d){if(!r)for(r={};t=k.exec(c);)r[t[1].toLowerCase()]=t[2];t=r[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return d?c:null},setRequestHeader:function(e,t){return null==d&&(e=E[e.toLowerCase()]=E[e.toLowerCase()]||e,O[e]=t),this},overrideMimeType:function(e){return null==d&&(m.mimeType=e),this},statusCode:function(e){var t;if(e)if(d)A(e[D.status])&&(C.console.type.ajax&&(xe("KlevuLib - AJAX - statusCode - Executed - url "+n),xe("KlevuLib - AJAX - statusCode - Executed - Status code"+D.status)),e[D.status](D.responseObj));else for(t in e)C.console.type.ajax&&(xe("KlevuLib - AJAX - statusCode - added processor - url "+n),xe("KlevuLib - AJAX - statusCode - added processor - code "+t)),v[t]=[v[t],e[t]];return this},abort:function(e){C.console.type.ajax&&(xe("KlevuLib - AJAX - Request Abort - url "+n),xe("KlevuLib - AJAX - Request Abort - status text "+e),xe("KlevuLib - AJAX - Request Abort - klXHR"),xe(D));var t=e||w;return i&&i.abort(t),T(0,t),this},requestDetails:m.requestDetails||{}};if(m.url=((n||m.url||location.href)+"").replace(j,location.protocol+"//"),m.type=s.method||s.type||m.method||m.type,m.dataTypes=(m.dataType||"*").toLowerCase().match(f)||[""],null===m.crossDomain){u=a.createElement("a");try{u.href=m.url,u.href=u.href,m.crossDomain=De.protocol+"//"+De.host!=u.protocol+"//"+u.host}catch(e){m.crossDomain=!0}}if(m.data&&m.processData&&"string"!=typeof m.data&&(m.data=t.param(m.data)),_e(Ce,m,s,D),d)return D;for(p in m.type=m.type.toUpperCase(),m.hasContent=!x.test(m.type),o=m.url.replace(S,""),m.hasContent?m.data&&m.processData&&0===(m.contentType||"").indexOf("application/x-www-form-urlencoded")&&(m.data=m.data.replace(b,"+")):(g=m.url.slice(o.length),m.data&&(m.processData||"string"==typeof m.data)&&(o+=(P.test(o)?"&":"?")+m.data,delete m.data),!1===m.cache&&(o=o.replace(y,"$1"),g=(P.test(o)?"&":"?")+"_="+Pe+++g,C.console.type.ajax&&xe("KlevuLib - AJAX - Request - ajax call forced to punch cache for url: "+g)),m.url=o+g),m.ifModified&&(t.lastModified[o]&&D.setRequestHeader("If-Modified-Since",t.lastModified[o]),t.etag[o]&&D.setRequestHeader("If-None-Match",t.etag[o])),(m.data&&m.hasContent&&!1!==m.contentType||s.contentType)&&D.setRequestHeader("Content-Type",m.contentType),D.setRequestHeader("Accept",m.dataTypes[0]&&m.accepts[m.dataTypes[0]]?m.accepts[m.dataTypes[0]]+("*"!==m.dataTypes[0]?", "+we+"; q=0.01":""):m.accepts["*"]),m.headers)D.setRequestHeader(p,m.headers[p]);if(m.beforeSend&&(!1===m.beforeSend.call(h,D,m)||d))return D.abort();if(w="abort",D.callbacks.done=m.done,D.callbacks.success=m.success,D.callbacks.fail=m.error,i=_e(Ee,m,s,D)){if(D.readyState=1,d)return D;m.async&&m.timeout>0&&(l=e.setTimeout((function(){D.abort("timeout")}),m.timeout));try{d=!1,i.send(O,T)}catch(e){if(d)throw e;T(-1,e)}}else T(-1,"No Transport");function T(n,s,a,r){var u,p,g,h=s;d||(d=!0,l&&e.clearTimeout(l),i=void 0,c=r||"",D.readyState=n>0?4:0,u=n>=200&&n<300||304===n,a&&(p=Te(m,D,a)),p=qe(m,p,D,u),u?(m.ifModified&&((g=D.getResponseHeader("Last-Modified"))&&(t.lastModified[o]=g),(g=D.getResponseHeader("etag"))&&(t.etag[o]=g)),204===n||"HEAD"===m.type?h="nocontent":304===n?h="notmodified":(h=p.state,p.data,u=!p.error)):(h,!n&&h||(h="error",n<0&&(n=0))),D.status=n,D.statusText=(s||h)+"",D.responseObj=p,D.isSuccess=u,C.console.type.ajax&&(xe("KlevuLib - AJAX - Request Done - isSuccess - "+D.isSuccess),xe("KlevuLib - AJAX - Request Done - status - "+D.status),xe("KlevuLib - AJAX - Request Done - status Text - "+D.statusText),xe("KlevuLib - AJAX - Request Done - xhr"),xe(D)),u?A(D.callbacks.success)&&D.callbacks.success(D):A(D.callbacks.fail)&&D.callbacks.fail(D),D.statusCode(v),v=void 0,A(D.callbacks.done)&&D.callbacks.done(D))}return D},getJSON:function(e,n,s){return t.get(e,n,s,"json")},getScript:function(e,n){return t.get(e,void 0,n,"script")}}),t.each(["get","post"],(function(e,n){t[n]=function(e,s,a,i){return A(s)&&(i=i||a,a=s,s=void 0),t.ajax(t.extend({url:e,type:n,dataType:i,data:s,success:a},t.isPlainObject(e)&&e))}})),t.ajaxPrefilter((function(e){e.crossDomain&&(e.contents.script=!1)})),t.ajaxTransport((function(n){var s,a;if(t.support.isActive("cors")||Le&&!n.crossDomain)return{send:function(t,i){var o,c=n.xhr();if(c.open(n.type,n.url,n.async,n.username,n.password),C.console.type.ajax&&(xe("KlevuLib - AJAX - ajaxTransport - xhr - send with options: "),xe(n)),n.xhrFields)for(o in n.xhrFields)c[o]=n.xhrFields[o];for(o in n.mimeType&&c.overrideMimeType&&c.overrideMimeType(n.mimeType),n.crossDomain||t["X-Requested-With"]||(t["X-Requested-With"]="XMLHttpRequest"),t)c.setRequestHeader(o,t[o]);s=function(e){return function(){s&&(s=a=c.onload=c.onerror=c.onabort=c.ontimeout=c.onreadystatechange=null,"abort"===e?c.abort():"error"===e?"number"!=typeof c.status?i(0,"error"):i(c.status,c.statusText):i(Ae[c.status]||c.status,c.statusText,"text"!==(c.responseType||"text")||"string"!=typeof c.responseText?{binary:c.response}:{text:c.responseText},c.getAllResponseHeaders()))}},c.onload=s(),a=c.onerror=c.ontimeout=s("error"),void 0!==c.onabort?c.onabort=a:c.onreadystatechange=function(){4===c.readyState&&e.setTimeout((function(){s&&a()}))},s=s("abort");try{c.send(n.hasContent&&n.data||null)}catch(e){if(s)throw e}},abort:function(){s&&s()}}})),t.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return C.console.type.ajax&&(xe("AJAX - Core converters - text script - executed for script: "),xe(e)),_(e),e}}}),t.ajaxPrefilter("script",(function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")})),t.ajaxSettings.xhr=function(){try{return new e.XMLHttpRequest}catch(e){}};var Ae={0:200,1223:204},Le=t.ajaxSettings.xhr();t.support.register({name:"cors",objectType:"core",loaded:!0,active:!!Le&&"withCredentials"in Le,dependency:["core.ajax"]}),t.support.register({name:"ajax",objectType:"core",loaded:!0,active:Le=!!Le,dependency:[]}),t.extend(!0,C,{fetchSettings:{url:location.href,method:"GET",processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},success:function(){},done:function(){},error:function(){}}}),t.fetch=t.pt.fetch=function(n,s){n=klevu.extend(!0,klevu.extend(!0,{},klevu.fetchSettings),n);let a={};klevu.isUndefined(n.mimeType)||(a={"Content-Type":n.mimeType}),t.isUndefined(n.extraHeaders)||t.each(n.extraHeaders,(function(e,t){a[e]=t})),a=new Headers(a);let i={method:n.method,headers:a};if("get"===n.method.toLowerCase()){var o=new URL(n.url);if(""!==n.data){var c={q:n.data};Object.keys(c).forEach((function(e,t){o.searchParams.append(t,c[t])}))}n.url=o.toString()}else i.body=n.data;n.crossDomain&&(i.mode="cors");let r=function(t){if(t.ok){var a=null;switch(klevu.isUndefined(n.dataType)?null!=t.headers.get("content-type")&&(-1!==t.headers.get("content-type").indexOf("json")?a="json":-1!==t.headers.get("content-type").indexOf("xml")&&(a="xml")):a=n.dataType.toLowerCase(),a){case"json":t.json().then((function(e){n.success(e,s,t.status,t.ok)}));break;case"xml":t.text().then((function(a){n.success((new e.DOMParser).parseFromString(a,"text/xml"),s,t.status,t.ok)}));break;default:t.text().then((function(e){n.success(e,s,t.status,t.ok)}))}}else n.error(s,t.status,t.ok)};if(t.getGlobalSetting("fetchSettings.fallback",!1))fetch(n.url,i).then((function(e){r(e)}),(function(e){n.error(s,"0",!1)}));else{let e=new Request(n.url,i);fetch(e).then((function(e){r(e)}),(function(e){n.error(s,"0",!1)}))}},t.support.register({name:"fetch",objectType:"core",loaded:!0,active:!0,dependency:[]}),t.extend(!0,C,{request:{type:"FETCH",method:"GET",crossDomain:!1,data:"",success:function(){},done:function(){},error:function(){}}}),t.request=t.pt.request=function(e,n){if(!T(e)){if(T((e=klevu.extend(!0,klevu.extend(!0,{},klevu.settings.request),e)).url))return!1;"fetch"===e.type.toLowerCase()?(delete e.type,klevu.fetch(e,n)):(delete e.type,t.setObjectPath(n,"context.requestDetails",{}),t.setObjectPath(n,"context.requestObject",{}),e.requestDetails=n,klevu.ajax(e))}},t.get=t.pt.get=function(e){e.method="GET",t.request(e)},t.post=t.pt.post=function(e){e.method="POST",t.request(e)},t.support.register({name:"request",objectType:"core",loaded:!0,active:!0,dependency:["core.ajax","core.fetch"]}),t.extend(!0,C,{assets:{support:["template","js","css"]}});var Ie={js:function(e,n){t.dom.helpers.addElementToHead({content:e,type:"js",name:"kfl-"+de()})},css:function(e,n){t.dom.helpers.addElementToHead({content:e,type:"css",name:"kfl-"+de()})},template:function(e,t){klevu.search[t.pbid].getScope().template.setTemplate(e,t.name,!0)}};t.assets=t.pt.assets={getFile:function(n){if(!n.hasOwnProperty("url"))return!1;if(!n.hasOwnProperty("type"))return!1;switch(n.hasOwnProperty("options")||(n.options={}),n.options.url=n.url,n.options.type=n.type,n.options.type){case"css":n.options.mimeType="text/css";break;case"js":n.options.mimeType="text/javascript";break;default:n.options.mimeType="text/plain"}var s={success:function(e,n,s,a){C.console.type.assets&&xe("ASSETS - getFile - success to load file "+n.url),t.assets.process(e,n),n.hasOwnProperty("successCallback")&&n.successCallback(n)},error:function(e,t,n,s){C.console.type.assets&&xe("ASSETS - getFile - Fail to load file "+t.url),t.hasOwnProperty("errorCallback")&&t.errorCallback(t)},options:n.options},a={url:n.url,type:"FETCH",method:"GET",mimeType:n.options.mimeType,crossDomain:!0};e.fetch?(a.success=function(e,t,n,s){t.success(e,t.options,n,s)},a.error=function(e,t,n){e.error({},e.options,t,n)}):(a.type="AJAX",a.success=function(e){s.success(e.responseObj.data,e.requestDetails.options,e.status,e.isSuccess)},a.error=function(e){s.error({},e.requestDetails.options,e.status,e.isSuccess)}),t.request(a,s)},process:function(e,t){if(!Ie.hasOwnProperty(t.type))return C.console.type.assets&&xe("ASSETS - process - Processor does not exist for type "+t.type),!1;Ie[t.type](e,t)},addProcessor:function(e){return!!e.hasOwnProperty("type")&&(!!e.hasOwnProperty("fire")&&void(Ie[e.type]=e.fire))},getProcessors:function(){return Ie}},t.support.register({name:"assets",objectType:"core",loaded:!0,active:!0,dependency:["core.request","core.dom"]}),t.modules={},t.support.hook(["core.constructors"],(function(){t.constructors.isLoaded("core.loader")||(t.constructors.add({name:"core.loader",create:function(){let e={settings:{list:{}},loadModules:function(){let e=this.getUnloadedModules();t.each(e,(function(e,n){t.assets.getFile({url:n.src,type:"jsModule"})}))},getUnloadedModules:function(){let e=[];return t.each(this.settings.list,(function(t,n){n.loaded||(e.push(n),n.loaded=!0)})),e},addModule:function(e){t.getObjectPath(this.settings.list,e.name,!1)||(t.setObjectPath(this.settings.list,e.name,{name:e.name,src:e.src,loaded:!1}),this.loadModules())}},n=t.assets.getProcessors();return t.isUndefined(n.jsModule)&&t.assets.addProcessor({type:"jsModule",fire:function(e,n){return t.assets.getProcessors().js(e,n)}}),e}}),t.support.hook(["core.assets"],(function(){t.support.isActive("analytics.collector")||(t.extend(!0,t.modules,{loader:t.constructors.construct("core.loader")}),t.support.register({name:"core.loader",loaded:!0,active:!0,dependency:["core.assets"]}))})))}));var Re={request:[],response:[],keys:0};t.cache=t.pt.cache=function(){var e={getCache:function(t){var n=e.getCacheKey(t);return n>=0&&Re.response[n]},getCacheKey:function(e){var n=-1;return t.each(Re.request,(function(s,a){if(t.isEqualObj(e,a))return n=s,!1})),n},hasCache:function(t){return-1!==e.getCacheKey(t)},setCache:function(t,n){var s=e.getCacheKey(t);return s>=0?Re.response[s]=n:(Re.request[Re.keys]=t,Re.response[Re.keys]=n,Re.keys++),!0},getAllCache:function(){return Re}};return e},t.support.register({name:"cache",objectType:"core",loaded:!0,active:!0,dependency:[]});var Me={};t.extend({globalDictionaryRepo:Me}),t.dictionary=t.pt.dictionary=function(n){var s={dictionaryMap:{},type:n||"translation",storageType:null,storage:null,cookies:[]};function i(t){C.console.type.storage&&xe("Dictionary - storageTest - testing for storage - "+t);var n="test";try{return e[t].setItem(n,n),e[t].removeItem(n),!0}catch(e){return!1}}function o(e){return"klv_"+s.type+"_"+e}function c(e){return e.replace(o(""),"")}function r(e){return D(e,o(""))}function l(){for(var e,t=0,n={};(e=s.storage.key(t))&&"undefined"!==e;t++){var a=s.storage.getItem(e);null!==a&&r(e)&&(n[c(e)]=a)}return n}function u(){return null!==s.storage&&s.storage}function d(){return null!==s.storageType&&s.storageType}function p(){return null!==s.storageType}function g(){if(p()){var e=l();if(!t.dataProtection.dataCanBeTracked()&&(t.isUndefined(Me[s.type].klvDataProtected)&&!t.isUndefined(e.klvDataProtected)&&t.toBoolean(e.klvDataProtected)||!t.isUndefined(Me[s.type].klvDataProtected)&&t.toBoolean(Me[s.type].klvDataProtected)))return C.console.type.storage&&xe("Dictionary - mergeToStorage - storage could not be read because of data protection - "+s.type),!1;ee(e,(function(e,t){try{s.storage.removeItem(o(e))}catch(t){C.console.type.storage&&xe("Dictionary - mergeToStorage - storage could not be removed for key - "+e),Se(t,"STORAGE-removeKey-"+o(e))}})),ee(Me[s.type],(function(e,t){try{s.storage.setItem(o(e),t)}catch(t){C.console.type.storage&&xe("Dictionary - mergeToStorage - storage could not re set for key - "+e),Se(t,"STORAGE-addKey-"+o(e))}}))}}function m(){if(p()){var e=l();if(!t.dataProtection.dataCanBeTracked()&&(t.isUndefined(Me[s.type].klvDataProtected)&&!t.isUndefined(e.klvDataProtected)&&t.toBoolean(e.klvDataProtected)||!t.isUndefined(Me[s.type].klvDataProtected)&&t.toBoolean(Me[s.type].klvDataProtected)))return C.console.type.storage&&xe("Dictionary - mergeFromStorage - storage could not be read because of data protection - "+s.type),!1;Me[s.type]=t.extend(!0,Me[s.type],e)}}T(Me[s.type])&&(Me[s.type]={});var h={getGlobal:function(){return m(),Me[s.type]},mergeToGlobal:function(){return Me[s.type]=t.extend(!0,Me[s.type],s.dictionaryMap),g(),this},overrideGlobal:function(){return Me[s.type]=s.dictionaryMap,g(),this},mergeFromGlobal:function(){return m(),s.dictionaryMap=t.extend(!0,s.dictionaryMap,Me[s.type]),this},setElements:function(e){return W(e)?e.length>0&&ee(e,(function(e,t){h.addElement(e,t)})):I(e)&&ee(e,(function(e,t){h.addElement(e,t)})),this},getElements:function(){return s.dictionaryMap},resetElements:function(){return s.dictionaryMap={},this},getElement:function(e){return T(e)?"":(T(s.dictionaryMap[e])||null===s.dictionaryMap[e]||(e=s.dictionaryMap[e]),e)},addElement:function(e,t){return s.dictionaryMap[e]=t,this},removeElement:function(e){return delete s.dictionaryMap[e],this},getAllStorage:l,setStorage:function(n,c){T(c)&&(c=!1);try{var r=!1;if("local"===n&&i("localStorage")?(s.storageType=n,s.storage=e.localStorage,r=!0):c?(C.console.type.storage&&xe("Dictionary - setStorage - storage could not be set to - localStorage - fallback to cookies"),n="cookies"):C.console.type.storage&&xe("Dictionary - setStorage - storage could not be set to - localStorage - no fallback"),r||("session"===n&&i("sessionStorage")?(s.storageType=n,s.storage=e.sessionStorage):c?(C.console.type.storage&&xe("Dictionary - setStorage - storage could not be set to - sessionStorage - fallback to cookies"),n="cookiesSession"):C.console.type.storage&&xe("Dictionary - setStorage - storage could not be set to - sessionStorage - no fallback")),"cookies"===n||"cookiesSession"===n){s.storageType=n,s.storage={getItem:function(e){return e&&this.hasOwnProperty(e)?decodeURI(a.cookie.replace(new RegExp("(?:^|.*;\\s*)"+encodeURI(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*((?:[^;](?!;))*[^;]?).*"),"$1")):null},key:function(e){var n=a.cookie.replace(/\s*\=(?:.(?!;))*$/,"").split(/\s*\=(?:[^;](?!;))*[^;]?;\s*/);return ee(t.extend(!0,{},n),(function(e,t){-1===t.indexOf(o(""))&&n.splice(n.indexOf(t),1)})),decodeURI(n[e])},setItem:function(e,t){if(e){var n="";if("cookies"===s.storageType){var i=new Date;i.setTime(i.getTime()+6048e5),n=" expires="+i.toUTCString()+";"}a.cookie=encodeURI(e)+"="+encodeURI(t)+";"+n+" path=/";var c=new RegExp(o(""),["g"]);this.length=a.cookie.match(c).length}},length:0,removeItem:function(e){e&&this.hasOwnProperty(e)&&(a.cookie=encodeURI(e)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/",this.length--)},hasOwnProperty:function(e){return new RegExp("(?:^|;\\s*)"+encodeURI(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(a.cookie)}};var l=new RegExp(o(""),["g"]);s.storage.length=a.cookie.match(l).length}p()&&m(),C.console.type.storage&&xe("Dictionary - setStorage - storage set to - "+s.storageType)}catch(e){C.console.type.storage&&ke("Dictionary - setStorage - storage could not be set to - "+n),Se(e,"STORAGE-storageSet-"+n)}},getStorage:u,getStorageType:d,hasStorage:p,mergeFromStorage:m,mergeToStorage:g,setDataProtection:function(e){return h.addElement("klvDataProtected",e),this}};return h},t.support.register({name:"dictionary",objectType:"core",loaded:!0,active:!0,dependency:["core.dataProtection"]}),t.extend(!0,C,{currency:{precision:2,grouping:3,decimal:".",thousand:","}}),t.currency=t.pt.currency=function(){var e=t.dictionary("currency"),n={getGlobal:e.getGlobal,mergeToGlobal:e.mergeToGlobal,overrideGlobal:e.overrideGlobal,mergeFromGlobal:e.mergeFromGlobal,setCurrencys:function(e){return I(e)&&ee(e,(function(e,t){n.addCurrency(e,t)})),this},getCurrencys:e.getElements,resetCurrencys:e.resetElements,getCurrency:function(t){var n={};if(T(t))return n;t=Z(t);var s=e.getElement(t);return n=s!==t?s:{code:t,string:t,atEnd:!0,format:"%s%s"}},addCurrency:function(t,n){return n.hasOwnProperty("format")||(n.format="%s%s"),n.hasOwnProperty("atEnd")||(n.atEnd=!1),n.hasOwnProperty("code")||(n.code=t),n.hasOwnProperty("precision")?n.precision=parseInt(n.precision):n.precision=parseInt(C.currency.precision),n.hasOwnProperty("thousand")||(n.thousand=C.currency.thousand),n.hasOwnProperty("decimal")||(n.decimal=C.currency.decimal),n.hasOwnProperty("grouping")?n.grouping=parseInt(n.grouping):n.grouping=parseInt(C.currency.grouping),n.hasOwnProperty("code")&&n.hasOwnProperty("string")&&e.addElement(t,n),this},removeCurrency:e.removeElement,parse:function(e){var t=[].slice.call(arguments,1),n=0;return e.replace(/(%s)/g,(function(){var e="";return T(t[n])||(e=t[n]),n++,e}))},unformatPrice:function(e,t){if("number"!=typeof(e=e||0)){t=t||C.currency.decimal;var n=new RegExp("[^0-9-"+t+"]",["g"]);e=parseFloat((""+e).replace(/\((?=\d+)(.*)\)/,"-$1").replace(n,"").replace(t,".")),e=isNaN(e)?0:e}return e},formatPrice:function(e){var s=arguments,a={precision:C.currency.precision,thousand:C.currency.thousand,decimal:C.currency.decimal,grouping:C.currency.grouping};void 0!==s[1]&&(a=I(s[1])?t.extend(!0,a,s[1]):a);var i=(e=n.unformatPrice(e,a.decimal))<0?"-":"",o=parseInt(Number(Math.round(Number(n.unformatPrice(Math.abs(e||0))+"e"+a.precision))+"e-"+a.precision).toFixed(a.precision),10)+"",c=o.length>a.grouping?o.length%a.grouping:0;return i+(c?o.substr(0,c)+a.thousand:"")+o.substr(c).replace(/(\d{3})(?=\d)/g,"$1"+a.thousand)+(a.precision?a.decimal+Number(Math.round(Number(n.unformatPrice(Math.abs(e))+"e"+a.precision))+"e-"+a.precision).toFixed(a.precision).split(".")[1]:"")},processCurrency:function(e,t){var s=n.getCurrency(e);return t=n.formatPrice(t,s),t=s.atEnd?n.parse.apply(null,[s.format,t,s.string]):n.parse.apply(null,[s.format,s.string,t])}};return n},t.support.register({name:"currency",objectType:"core",loaded:!0,active:!0,dependency:["core.dictionary"]}),t.translator=t.pt.translator=function(){var e=!1,n=t.dictionary("translation"),s={getGlobal:n.getGlobal,mergeToGlobal:n.mergeToGlobal,overrideGlobal:n.overrideGlobal,mergeFromGlobal:n.mergeFromGlobal,setTranslations:n.setElements,getTranslations:n.getElements,resetTranslations:n.resetElements,getTranslation:n.getElement,addTranslation:n.addElement,removeTranslation:n.removeElement,parse:function(e){var t=[].slice.call(arguments,1),n=0;return e.replace(/(%s)/g,(function(){var e="";return T(t[n])||(e=t[n]),n++,e}))},translate:function(e){if(0===(e=s.getTranslation(e)).length)return e;if(W(arguments)&&arguments.length>1){var t=arguments;t[0]=e,e=s.parse.apply(null,t)}return e},getCurrencyObject:function(){return e||(e=t.currency())}};return s},t.support.register({name:"translator",objectType:"core",loaded:!0,active:!0,dependency:["core.dictionary","core.currency"]}),t.extend({template:function(){var e={templateList:{},templateName:{},helpers:{},data:{},translator:null,currency:null,webhook:{run:!1,name:"template",object:!1,scope:"all"}};function n(n,s){var a={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},o=/(.)^/,c=/\\|'|\r|\n|\u2028|\u2029/g,r={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},l=function(e){return"\\"+r[e]};s=t.extend({},s,a),C.console.type.template&&(xe("TEMPLATE - generation - settings used: "),xe(s));var u,p=new RegExp([(s.escape||o).source,(s.interpolate||o).source,(s.evaluate||o).source].join("|")+"|$","g"),g=0,m="__out+='";n.replace(p,(function(e,t,s,a,i){return m+=n.slice(g,i).replace(c,l),g=i+e.length,t?m+="'+\n((__temp=("+t+"))==null?'':encodeURIComponent(__temp))+\n'":s?m+="'+\n((__temp=("+s+"))==null?'':__temp)+\n'":a&&(m+="';\n"+a+"\n__out+='"),e})),m+="';\n",s.variable||(m="with(data||{}){\n"+m+"}\n"),m="var __temp,__out='',__joiner=Array.prototype.join,print=function(){__out+=__joiner.call(arguments,'');};\n"+m+"return __out;\n";try{u=new Function(s.variable||"data","dataLocal","helper","scope",m)}catch(e){throw e.source=m,Se(e,"TEMPLATE-renderError"),e}var h=function(t,n,s,a){return T(a)&&(a=d),T(t)&&a.hasData()&&(t=e.data),T(n)&&(n=t),T(s)&&(s=i()),u.call(this,t,n,s,a)},f=s.variable||"data",v="dataLocal",b="helper",S="scope";return h.source="function("+f+","+v+", "+b+", "+S+"){\n"+m+"}",h.list=s.list,h.naming=s.name,h}function s(e,n,s,a,i){T(n)&&(n=d),void 0===s&&n.hasData()&&(s=n.getTemplateSettings().data),T(a)&&(a=s),T(i)&&(i=n.getHelpers());let o="";return t.isUndefined(n.getTemplateSettings().templateList[e])||t.each(n.getTemplateSettings().templateList[e],(function(c,r){let l=r.naming;t.isFunction(r)&&(klevu.isUndefined(klevu.getGlobalSetting("global.templateHints"))||"true"!==klevu.getGlobalSetting("global.templateHints")?o+=r(s,a,i,n):o+="<div style=' border: 1px solid red;'><span style='color: white;background-color: red;'>L: "+e+" T:"+l+"</span>"+r(s,a,i,n)+"</div>")})),o}function i(){return e.helpers}function o(t,n){return A(n)&&(e.helpers[t]=n),e.helpers}function c(){return e.translator=t.translator(),o("translator",e.translator),e.translator.mergeFromGlobal(),o("translate",e.translator.translate),o("addTranslation",e.translator.addTranslation),o("getTranslation",e.translator.getTranslation),o("removeTranslation",e.translator.removeTranslation),o("setTranslations",e.translator.setTranslations),e.currency=e.translator.getCurrencyObject(),e.currency.mergeFromGlobal(),o("processCurrency",e.currency.processCurrency),e.translator}function r(){return e.translator}function l(){return r().translate.apply(null,arguments)}function u(e,n,s){var a=e.indexOf("#"),i=-1!==(e=-1===a?e:e.substr(0,a)).indexOf("?")?"&":"?",o=new RegExp("([?&])"+n+"=.*?(&|$)","i"),c={};return c[n]=s,c=t.param(c),e.match(o)?e.replace(o,"$1"+c+"$2"):e+i+c}c(),o("render",s),o("each",t.each),o("buildUrl",u),o("stripHtml",t.dom.helpers.stripHtml),o("escapeHTML",t.dom.helpers.escapeHtml);var d={getTemplateSettings:function(){return e},setTemplateSettings:function(t){return e=t},setTemplate:function(s,a,i,o,c){let r,l;if(t.isPlainObject(s)){if(!klevu.getObjectPath(s,"template",!1)||!klevu.getObjectPath(s,"name",!1))return C.console.type.template&&ke("TEMPLATE - setTemplate - When setting a template using a object name and template needs to be defined "),!1;a=klevu.getObjectPath(s,"name",void 0),i=klevu.getObjectPath(s,"decoded",!1),o=klevu.getObjectPath(s,"skipWebhook",!1),c=klevu.getObjectPath(s,"list",!1),r=klevu.getObjectPath(s,"before",!1),l=klevu.getObjectPath(s,"after",!1),s=klevu.getObjectPath(s,"template",void 0)}if(void 0===s||void 0===a)return C.console.type.template&&ke("TEMPLATE - setTemplate - When setting a template name and content needs to be defined "),!1;if(!(i=i||!1))try{s=ae(s)}catch(e){return this.data="",C.console.type.template&&(ke("TEMPLATE - setTemplate - Template decoding error for template name "+a),ke(e)),Se(e,"TEMPLATE-templateDecode"),!1}c||(c=a),e.templateName[a]=n(s,{list:c,name:a}),t.isUndefined(e.templateList[c])&&(e.templateList[c]=[]);let u=!1,p=!1;if(e.templateList[c].length>0&&((r||l)&&(p=!0),t.eachReverse(e.templateList[c],(function(t,n){n.naming===a&&(p?e.templateList[c].splice(t,1):(u=!0,e.templateList[c][t]=e.templateName[a]))})),(r||l)&&t.eachReverse(e.templateList[c],(function(t,n){r&&!u&&n.naming===r&&(u=!0,e.templateList[c].splice(t,0,e.templateName[a])),l&&!u&&n.naming===l&&(u=!0,e.templateList[c].splice(t+1,0,e.templateName[a]))}))),u||e.templateList[c].push(e.templateName[a]),!(o=o||!1)&&e.webhook.run&&e.webhook.name&&e.webhook.object){let n=t.extend(!0,{},e.webhook);n.action="setTemplate",t.event.webhook.runForScopeList({data:{name:a,list:c},scope:d,settings:n})}return!0},render:s,list:function(){var n=[];return t.each(e.templateName,(function(e,t){R(t)||n.push({name:t.naming,list:t.list,function:t.source})})),n},convertTemplate:function(e){var t=a.createElement("div");return t.innerHTML=Z(e),t.className="klevuWrap",t},insertTemplate:function(e,t){return e.appendChild(t),e},stripHtml:t.dom.helpers.stripHtml,setHelper:o,getHelpers:i,translate:l,getTranslator:r,initTranslator:c,hasData:function(){return!R(e.data)},setData:function(t){return C.console.type.template&&(xe("TEMPLATE - setData - with data"),xe(t)),e.data=t,this},getData:function(){return e.data},setWebhookSettings:function(n){return n&&(e.webhook=t.extend(!0,e.webhook,n)),this},getWebhookSettings:function(){return e.webhook}};return d},templateClone:function(e){var n=t.template(),s=t.extend(!0,{},e.getTemplateSettings());return n.setTemplateSettings(s),n.initTranslator(),n}}),t.support.register({name:"template",objectType:"core",loaded:!0,active:!0,dependency:["core.translator","core.currency","core.log","core.webhook"]}),t.extend(!0,C,{events:{maxExecutions:100,defaultDelay:0,skipFirstRun:!1}});var Ge={};t.extend({isReady:!1,isInteractive:!1}),t.extend({event:{attach:function(e,t,n,s){"undefined"!=typeof addEventListener?(T(s)&&(s=!1),e.addEventListener(t,n,s)):e.attachEvent("on"+t,n)},detach:function(e,t,n,s){"undefined"!=typeof removeEventListener?(T(s)&&(s=!1),e.removeEventListener(t,n,s)):e.detachEvent("on"+t,n)},fireChain:function(e,n,s,a,i){var o=t.getObjectPath(e,n);if(!t.isUndefined(o)&&0!==o.list().length)return o.setScope(s),o.setData(a),o.fire(),o.getData().preventDefault&&i.preventDefault(),i}}}),t.support.register({name:"event",objectType:"core",loaded:!0,active:!0,dependency:["core.chains"]});var Ke={fireChainAndClear:function(e){e.list().length>0&&e.hasData()&&(e.fire(),e.empty(),e.setData({counter:0,list:[]}))},addToChain:function(e,n){if(A(n)?n={name:t.randomId(),fire:n}:R(n)||n.name||(n.name=t.randomId()),n){if(A(n.fire)){var s=n.fire;n.fire=function(e,t){s.call(this,e.list[e.counter],t),e.counter++}}e.add(n);var a=e.getData();n.data||(n.data={}),a.list.push(n.data),e.setData(a)}},initChain:function(){var e=t.chain();return e.setData({counter:0,list:[]}),e},events:{completedEvent:function(e){C.console.type.event&&xe("KlevuLib - startInterface - completedEvent - "+a.readyState),"load"===e.type||"complete"===a.readyState?(Ke.events.detachEvent(),Ke.interactiveFire(),Ke.readyFire()):"interactive"===a.readyState&&Ke.interactiveFire()},detachEvent:function(){C.console.type.event&&xe("KlevuLib - startInterface - detachEvent - "+a.readyState),a.addEventListener?(a.removeEventListener("DOMContentLoaded",Ke.events.completedEvent,!1),e.removeEventListener("load",Ke.events.completedEvent,!1)):(a.detachEvent("onreadystatechange",Ke.events.completedEvent),e.detachEvent("onload",Ke.events.completedEvent))}},readyFire:function(){if(!a.body)return setTimeout(Ke.readyFire);C.console.type.event&&xe("KlevuLib - readyFire - "+a.readyState+" - isReady - "+t.isReady),t.isInteractive=!0,t.isReady=!0,Ke.fireChainAndClear(C.chains.readyChain)},interactiveFire:function(){if(C.console.type.event&&xe("KlevuLib - interactiveFire - "+a.readyState+" - isReady - "+t.isReady),!a.body)return setTimeout(Ke.interactiveFire);t.isInteractive=!0,Ke.fireChainAndClear(C.chains.interactiveChain)},interactivePromise:function(e){C.console.type.event&&xe("KlevuLib - interactivePromise - "+a.readyState+" - isReady - "+t.isReady),"interactive"===a.readyState&&(t.isInteractive=!0),C.chains.interactiveChain||(C.chains.interactiveChain=Ke.initChain()),Ke.addToChain(C.chains.interactiveChain,e),t.isInteractive&&Ke.fireChainAndClear(C.chains.interactiveChain)},readyPromise:function(n){if(C.console.type.event&&xe("KlevuLib - readyPromise - "+a.readyState+" - isReady - "+t.isReady),!C.chains.readyChain)if(C.chains.readyChain=Ke.initChain(),"complete"===a.readyState)setTimeout(Ke.readyFire);else if(a.addEventListener)a.addEventListener("DOMContentLoaded",Ke.events.completedEvent,!1),e.addEventListener("load",Ke.events.completedEvent,!1);else{a.attachEvent("onreadystatechange",Ke.events.completedEvent),e.attachEvent("onload",Ke.events.completedEvent);var s=!1;try{s=null===e.frameElement&&a.documentElement}catch(e){}s&&s.doScroll&&function e(){if(!t.isReady){C.console.type.event&&xe("KlevuLib - doScrollCheck - "+a.readyState+" - isReady - "+t.isReady);try{s.doScroll("left")}catch(t){return setTimeout(e,50)}Ke.events.detachEvent(),Ke.readyFire()}}()}Ke.addToChain(C.chains.readyChain,n),t.isReady&&Ke.fireChainAndClear(C.chains.readyChain)}};t.extend({ready:function(e){Ke.readyPromise(e)},interactive:function(e){Ke.interactivePromise(e)}}),t.support.register({name:"ready",objectType:"core",loaded:!0,active:!0,dependency:["core.chains"]}),t.support.register({name:"interactive",objectType:"core",loaded:!0,active:!0,dependency:["core.chains"]}),t.extend({coreEvent:{build:function(e){if(e.maxCount=e.maxCount||C.events.maxExecutions,e.delay=e.delay||C.events.defaultDelay,e.skipFirstRun=e.skipFirstRun||C.events.skipFirstRun,T(e.name)||T(e.fire)||!A(e.fire))return!1;Ge[e.name]={fire:e.fire,counter:0,delay:e.delay,maxCount:e.maxCount,skipFirstRun:e.skipFirstRun},t.coreEvent.promise(name)},attach:function(e,n){if(T(e)||T(Ge[e]))return!1;t.coreEvent.promise(e,n)},promise:function(e,n){if(T(e)||T(Ge[e]))return!1;C.console.type.event&&xe("KlevuLib - Custom Event - promise - "+e),C.chains[e+"Chain"]||(C.chains[e+"Chain"]=Ke.initChain(),setTimeout(t.coreEvent.fire.bind(t,e),Ge[e].delay)),Ke.addToChain(C.chains[e+"Chain"],n),Ge[e].skipFirstRun||!0===Ge[e].fire.call(t)&&t.coreEvent.fire(e)},fire:function(e){return!T(e)&&!T(Ge[e])&&(Ge[e].counter>=Ge[e].maxCount?(C.console.type.event&&xe("KlevuLib - Custom Event - fire max executions reached - "+e),!1):(Ge[e].counter++,void(!0===Ge[e].fire.call(t)?(C.console.type.event&&xe("KlevuLib - Custom Event - fire success - "+e+" - execute chain "),Ke.fireChainAndClear(C.chains[e+"Chain"]),Ge[e].counter=0):(C.console.type.event&&xe("KlevuLib - Custom Event - fire fail - "+e+" - schedule in "+Ge[e].delay),setTimeout(t.coreEvent.fire.bind(t,e),Ge[e].delay)))))}}}),t.support.register({name:"coreEvent",objectType:"core",loaded:!0,active:!0,dependency:["core.chains"]}),t.extend(!0,{event:{eventList:{build:function(n){function s(){let e=Object.create(Array.prototype);for(key in Object.defineProperty(e,"length",{value:0,enumerable:!1,writable:!0}),e.chain=t.chain({stopOnFalse:!0}),arguments)e[key]=arguments[key],e.length+=1;e.run=function(){let e={action:"run",element:this},n=this.chain;t.isUndefined(n)||0===n.list().length||(n.setScope(this),n.setData(e),n.fire())},e.remove=function(e){const t=this.indexOf(e);return t>-1&&(this.splice(t,1),!0)};try{e.push=function(e){return this[this.length]=e,this.length++,this.run(),1},e.pop=function(){this.length--;const e=this[this.length];return delete this[this.length],e},e.filter=function(e){let t=[];for(let n in this)if(this.hasOwnProperty(n)){const s=this[n];e(s,n)&&t.push(s)}return t}}catch(e){C.console.type.general&&(ke("Array Object Creation Failed"),ke(e)),Se(e,"Array Object Creation")}return e}n.hasOwnProperty("name")||(n.name="klv"+t.randomFunctionName()),n.hasOwnProperty("global")||(n.global=!1);let a=s();if(t.event.eventList.list[n.name]=a,n.global){let s=t.isUndefined(e[n.name])?[]:e[n.name];s.length>0&&t.each(s,(function(e,t){a.push(t)})),e[n.name]=a}return a},getByName:function(e){return t.getObjectPath(t.event.eventList.list,e,!1)?t.getObjectPath(t.event.eventList.list,e):t.event.eventList.build({name:e})},hasByName:function(e){return t.getObjectPath(t.event.eventList.list,e,!1)},list:{}}}}),t.support.register({name:"eventList",objectType:"core",loaded:!0,active:!0,dependency:["core.chains"]}),t.extend(!0,{event:{webhook:{build:function(e){function n(){let n={};return n.chain=t.chain({stopOnFalse:!1}),n.addListener=function(e){let n=t.randomFunctionName();return this.chain.add({name:n,fire:e}),n},n.removeListener=function(e){return this.chain.remove({name:e}),!0},n.run=function(n,s){(t.isUndefined(n)||t.isEmptyObject(n))&&(n={action:"run",element:this}),(t.isUndefined(s)||t.isEmptyObject(s))&&(s=this),t.getGlobalSetting("console.type.webhook",!1)&&(xe("WEBHOOK - run - settings used: "),xe(e),xe("WEBHOOK - run - data/scope used: "),xe(n),xe(s));let a=this.chain;t.isUndefined(a)||0===a.list().length||(a.setScope(s),a.setData(n),a.fire())},n}e.hasOwnProperty("name")||(e.name=t.randomFunctionName()),e.hasOwnProperty("object")||(e.object="klevu"),e.hasOwnProperty("scope")||(e.scope="all"),e.hasOwnProperty("action")||(e.action="all"),t.getGlobalSetting("console.type.webhook",!1)&&(xe("WEBHOOK - build - settings used: "),xe(e));let s=n();return t.setObjectPath(t.event.webhook.list,e.object+"."+e.name+"."+e.action+"."+e.scope,s),s},setAsSingleRun:function(e){t.setSetting(t.settings,"flags.webhook.singleRun."+e.object+"."+e.name+"."+e.action+"."+e.scope,!0)},isSingleRun:function(e){return t.getGlobalSetting("flags.webhook.singleRun."+e.object+"."+e.name+"."+e.action+"."+e.scope,!1)},hasWebhook:function(e){return!!e.hasOwnProperty("name")&&(!!e.hasOwnProperty("object")&&(!!e.hasOwnProperty("scope")&&(!!e.hasOwnProperty("action")&&!!t.getObjectPath(t.event.webhook.list,e.object+"."+e.name+"."+e.action+"."+e.scope,!1))))},getWebhook:function(e){return t.event.webhook.hasWebhook(e)?t.getObjectPath(t.event.webhook.list,e.object+"."+e.name+"."+e.action+"."+e.scope,!1):t.event.webhook.build(e)},attach:function(e){e.hasOwnProperty("scope")||(e.scope="all"),e.hasOwnProperty("fire")||(e.fire=function(e,t){}),t.getGlobalSetting("console.type.webhook",!1)&&(xe("WEBHOOK - attach - settings used: "),xe(e));let n=e.scope.split(",");t.each(n,(function(n,s){var a={name:e.name,object:e.object,scope:s.trim(),action:e.action};let i=t.event.webhook.getWebhook(a);i.addListener(e.fire),t.event.webhook.isSingleRun(a)&&(i.run(),i.chain.empty())}))},runForScopeList:function(e){let n=e.scope,s=e.data,a=e.settings;t.getObjectPath(e.settings,"singleRun",!1)&&t.event.webhook.setAsSingleRun(e.settings);var i=a.scope.split(",");t.eachReverse(i,(function(e,i){if(a.scope=i,t.event.webhook.hasWebhook(a)){let e=t.event.webhook.getWebhook(a);e.run(s,n),t.event.webhook.isSingleRun(a)&&e.chain.empty()}}))},buildEventList:function(){t.event.eventList.build({name:"_klvWebhook",global:!0}),t.event.eventList.getByName("_klvWebhook").chain.add({name:"moveToWebhook",fire:function(e,n){if(e.element.length>0){let n=[];t.each(e.element,(function(e,s){let a={},i=!0;if(t.getObjectPath(s,"name",!1)?a.name=t.getObjectPath(s,"name"):(i=!1,t.getGlobalSetting("console.type.webhook",!1)&&(xe("WEBHOOK - _klvWebhook - missing name: "),xe(s))),t.getObjectPath(s,"object",!1)?a.object=t.getObjectPath(s,"object"):(i=!1,t.getGlobalSetting("console.type.webhook",!1)&&(xe("WEBHOOK - _klvWebhook - missing object: "),xe(s))),t.getObjectPath(s,"scope",!1)&&(a.scope=t.getObjectPath(s,"scope")),t.getObjectPath(s,"action",!1)?a.action=t.getObjectPath(s,"action"):(i=!1,t.getGlobalSetting("console.type.webhook",!1)&&(xe("WEBHOOK - _klvWebhook - missing action: "),xe(s))),t.getObjectPath(s,"fire",!1)?a.fire=t.getObjectPath(s,"fire"):(i=!1,t.getGlobalSetting("console.type.webhook",!1)&&(xe("WEBHOOK - _klvWebhook - missing function to execute: "),xe(s))),t.event.webhook){if(i&&(t.event.webhook.attach(a),t.event.webhook.isSingleRun(a))){let e=t.event.webhook.getWebhook({name:a.name,object:a.object,scope:a.scope,action:a.action});e.run(),e.chain.empty()}n.push(s)}})),n.length>0&&t.each(n,(function(t,n){e.element.remove(n)}))}}}),t.event.eventList.getByName("_klvWebhook").run(),t.event.eventList.build({name:"_klvReady",global:!0}),t.event.eventList.getByName("_klvReady").chain.add({name:"moveToWebhook",fire:function(e,n){if(e.element.length>0){let n=[],s=t.event.eventList.getByName("_klvWebhook");t.each(e.element,(function(e,a){t.isFunction(a)?(s.push({object:"core",scope:"all",name:"framework",action:"init",fire:a}),n.push(a)):t.getGlobalSetting("console.type.webhook",!1)&&(xe("WEBHOOK - _klvReady - missing function to execute: "),xe(a))})),n.length>0&&t.each(n,(function(t,n){e.element.remove(n)}))}}}),t.event.eventList.getByName("_klvReady").run()},list:{},helpers:{setWebhookSettingsForScope:function(e,n){return e&&(n.webhookSettings=t.extend(!0,n.webhookSettings,e)),n},getWebhookSettingsForScope:function(e){return e.webhookSettings},fireEventForScope:function(e){let n=t.extend(!0,{},e.webhookSettings);n.name=e.name,n.action=e.action,t.event.webhook.runForScopeList({data:e.data,scope:e.scope,settings:n})}}}}}),t.extend(!0,{modifyRequest:function(e,n,s,a){let i="chains.request.build",o="after";if(t.isUndefined(a)&&(a="search"),t.isUndefined(s)&&(s=""),t.isUndefined(e)&&(e="all"),"object"==typeof e)try{if(i=t.getObjectPath(e,"chain",i),o=t.getObjectPath(e,"action",o),a=t.getObjectPath(e,"object",a),!t.isUndefined(e.callback)&&t.isFunction(e.callback))n=t.getObjectPath(e,"callback",n);else{if(t.isUndefined(e.entity)||!t.isString(e.entity))return void(t.getGlobalSetting("console.type.webhook",!1)&&(ke("WEBHOOK - modifyQuery - Could not attach webhook via klevu.modifyQuery because either a callback or setting+value were not supplied via the object. "),ke(e)));n=t.getObjectPath(e,"entity",n),s=t.getObjectPath(e,"value",s)}e=t.getObjectPath(e,"scope","all")}catch(e){t.getGlobalSetting("console.type.webhook",!1)&&(ke("WEBHOOK - modifyQuery - Problem trying to set the webhook settings via object. "),ke(e))}if(t.isUndefined(n))n=function(e,t){};else if(t.isString(n)){var c={path:n,value:s};n=function(e,n){var s=t.getObjectPath(e,"localOverrides.query."+c.path,void 0);if(t.isUndefined(s)||"object"!=typeof c.value)t.setObjectPath(e,"localOverrides.query."+c.path,c.value);else{var a={};c.value.length&&(a=[]);var i=t.extend(1,a,s,c.value);t.setObjectPath(e,"localOverrides.query."+c.path,i)}}}t.event.webhook.attach({object:a,scope:e,name:i,action:o,fire:n})},modifyResponse:function(e,n,s,a,i){t.isUndefined(s)&&(s="search"),t.isUndefined(n)&&(n=function(e,t){}),t.isUndefined(e)&&(e="all"),t.isUndefined(i)&&(i="chains.template.process.success"),t.isUndefined(a)&&(a="before"),t.event.webhook.attach({object:s,scope:e,name:i,action:a,fire:n})},afterTemplateRender:function(e,n,s,a,i){t.isUndefined(a)&&(a="search"),t.isUndefined(n)&&(n=function(e,t){}),t.isUndefined(e)&&(e="all"),t.isUndefined(s)&&(s="chains.template.events"),t.isUndefined(i)&&(i="after"),t.event.webhook.attach({object:a,scope:e,name:s,action:i,fire:n})},beforeActivation:function(e,n,s,a,i){t.isUndefined(a)&&(a="search"),t.isUndefined(n)&&(n=function(e,t){}),t.isUndefined(e)&&(e="all"),t.isUndefined(i)&&(i="mainObject"),t.isUndefined(s)&&(s="beforeInit"),t.event.webhook.attach({object:a,scope:e,name:i,action:s,fire:n})}}),t.event.webhook.buildEventList(),t.support.register({name:"webhook",objectType:"core",loaded:!0,active:!0,dependency:["core.chains"]}),t.extend({dom:{find:function(n,s){return T(s)&&(s=e.document),t.isString(s)&&""!==s&&(s=e.document.getElementById(s)),t.dom.helpers.isHTMLNode(s)||(s=e.document),s.querySelectorAll?s.querySelectorAll(n):a.querySelectorAll(s.id+" "+n)},getFirst:function(n,s){T(s)&&(s=e.document);var a=t.dom.find(n,s);return a.length>0?a[0]:a},helpers:{isHTMLNode:function(e){return"object"==typeof Node?e instanceof Node:e&&"object"==typeof e&&"number"==typeof e.nodeType&&"string"==typeof e.nodeName},querySelectorAll:a.querySelectorAll,getClosest:function(e,t){for(;e&&e!==a;e=e.parentNode)if(e.matches(t))return e;return null},addElementToHead:function(e){var t;T(e)||("css"===e.type?((t=a.createElement("style")).type="text/css",t.id=e.name,t.styleSheet?t.styleSheet.cssText=e.content:t.appendChild(a.createTextNode(e.content))):"js"===e.type?((t=a.createElement("script")).type="text/javascript",t.id=e.name,t.appendChild(a.createTextNode(e.content))):"css-link"===e.type&&((t=a.createElement("link")).setAttribute("rel","stylesheet"),t.setAttribute("type","text/css"),t.id=e.name,t.setAttribute("href",e.content)),T(t)||a.getElementsByTagName("head")[0].appendChild(t))},removeElementFromDocument:function(e){var t=a.getElementById(e);!T(t)&&t&&t.parentNode.removeChild(t)},addElementToParent:function(t,n,s){(T(t)||null===t)&&(t=e.document.body);var i=a.createElement(n);for(var o in s)s.hasOwnProperty(o)&&i.setAttribute(o,s[o]);return t.appendChild(i),i},getHTML:function(e,n,s){var a=t.dom.find(e,n);if(T(s)&&(s=0),!z(s)&&Y(s)&&""!==s)switch(s){case"first":default:s=0;break;case"last":s=a.length-1}return z(s)&&t.dom.helpers.isHTMLNode(a[s])?a[s].innerHTML:""},convertHtmlToText:function(e){var t=a.createElement("div");return t.innerHTML=e,e=t.textContent},stripHtml:function(e){return e=e.replace(/(<([^>]+)>)/gi,"")},escapeHtml:function(e){if(e&&e.length){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};return String(e).replace(/[&<>"'`=\/]/g,(function(e){return t[e]}))}return e}}}}),t.support.register({name:"dom",objectType:"core",loaded:!0,active:!0,dependency:[]}),t.time={timestamp:function(){return Math.floor(Date.now()/1e3)},microTime:function(){return Math.floor(Date.now())}},t.support.register({name:"time",objectType:"core",loaded:!0,active:!0,dependency:[]}),t.extend({md:{parser:function(e){let t=function(e){return e.replace(/</g,"&lt;").replace(/\>/g,"&gt;")};return klevu.isString(e)?(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace(/\n(.+?)\n.*?\-\-\s?\|\s?\-\-.*?\n([\s\S]*?)\n\s*?\n/g,(function(e,t,n){var s=t.replace(/^\|(.+)/gm,"$1").replace(/(.+)\|$/gm,"$1").replace(/\|/g,"<th>"),a=n.replace(/^\|(.+)/gm,"$1").replace(/(.+)\|$/gm,"$1");return"\n<table>\n<thead>\n<th>"+s+"\n</thead>\n<tbody>"+(a=a.replace(/(.+)/gm,"<tr><td>$1</td></tr>").replace(/\|/g,"<td>"))+"\n</tbody></table>\n\n"}))).replace(/^-{3,}|^\_{3,}|^\*{3,}$/gm,"<hr>").replace(/\n\n<hr\>/g,"\n<br><hr>")).replace(/^##### (.*?)\s*#*$/gm,"<h5>$1</h5>").replace(/^#### (.*?)\s*#*$/gm,"<h4>$1</h4>").replace(/^### (.*?)\s*#*$/gm,"<h3>$1</h3>").replace(/^## (.*?)\s*#*$/gm,"<h2>$1</h2>").replace(/^# (.*?)\s*#*$/gm,"<h1>$1</h1>").replace(/^<h(\d)\>(.*?)\s*{(.*)}\s*<\/h\d\>$/gm,'<h$1 id="$3">$2</h$1>')).replace(/``(.*?)``/gm,(function(e,n){return"<code>"+t(n).replace(/`/g,"&#96;")+"</code>"}))).replace(/`(.*?)`/gm,"<code>$1</code>")).replace(/^\>\> (.*$)/gm,"<blockquote><blockquote>$1</blockquote></blockquote>")).replace(/^\> (.*$)/gm,"<blockquote>$1</blockquote>")).replace(/<\/blockquote\>\n<blockquote\>/g,"\n<br>")).replace(/<\/blockquote\>\n<br\><blockquote\>/g,"\n<br>")).replace(/!\[(.*?)\]\((.*?) "(.*?)"\)/gm,'<img alt="$1" src="$2" $3 />')).replace(/!\[(.*?)\]\((.*?)\)/gm,'<img alt="$1" src="$2" width="90%" />')).replace(/\[(.*?)\]\((.*?) "new"\)/gm,'<a href="$2" target=_new>$1</a>')).replace(/\[(.*?)\]\((.*?) "(.*?)"\)/gm,'<a href="$2" title="$3">$1</a>')).replace(/([<\s])(https?\:\/\/.*?)([\s\>])/gm,'$1<a href="$2">$2</a>$3')).replace(/\[(.*?)\]\(\)/gm,'<a href="$1">$1</a>')).replace(/\[(.*?)\]\((.*?)\)/gm,'<a href="$2">$1</a>')).replace(/^[\*+-][ .](.*)/gm,"<ul><li>$1</li></ul>")).replace(/^\d\d?[ .](.*)/gm,"<ol><li>$1</li></ol>")).replace(/^\s{2,6}[\*+-][ .](.*)/gm,"<ul><ul><li>$1</li></ul></ul>")).replace(/^\s{2,6}\d[ .](.*)/gm,"<ul><ol><li>$1</li></ol></ul>")).replace(/<\/[ou]l\>\n\n?<[ou]l\>/g,"\n")).replace(/<\/[ou]l\>\n<[ou]l\>/g,"\n")).replace(/\*\*\*(\w.*?[^\\])\*\*\*/gm,"<b><em>$1</em></b>")).replace(/\*\*(\w.*?[^\\])\*\*/gm,"<b>$1</b>")).replace(/\*(\w.*?[^\\])\*/gm,"<em>$1</em>")).replace(/___(\w.*?[^\\])___/gm,"<b><em>$1</em></b>")).replace(/__(\w.*?[^\\])__/gm,"<u>$1</u>")).replace(/\^\^\^(.+?)\^\^\^/gm,"<mark>$1</mark>")).replace(/\^\^(\w.*?)\^\^/gm,"<ins>$1</ins>")).replace(/~~(\w.*?)~~/gm,"<del>$1</del>")).replace(/  \n/g,"\n<br/>").replace(/\n\s*\n/g,"\n<p>\n")).replace(/^ {4,10}(.*)/gm,(function(e,n){return"<pre><code>"+t(n)+"</code></pre>"}))).replace(/^\t(.*)/gm,(function(e,n){return"<pre><code>"+t(n)+"</code></pre>"}))).replace(/<\/code\><\/pre\>\n<pre\><code\>/g,"\n")).replace(/\\([`_~\*\+\-\.\^\\\<\>\(\)\[\]])/gm,"$1"):""}}}),t.support.register({name:"markdown",objectType:"core",loaded:!0,active:!0,dependency:[]}),t.dataProtection=t.pt.dataProtection={consentSettings:t.dictionary("consent"),hasUseConsent:function(){return!t.isUndefined(t.getGlobalSetting("dataProtection.useConsent"))},getUseConsent:function(){return t.toBoolean(t.getGlobalSetting("dataProtection.useConsent",!1))},getUseConsentStorage:function(){var e=t.dataProtection.consentSettings.getElement("useConsent");return"useConsent"===e&&(e=!1),t.toBoolean(e)},setUseConsent:function(e,n){t.isUndefined(n)&&(n=t.settings),t.setObjectPath(n,"dataProtection.useConsent",t.toBoolean(e)),t.dataProtection.consentSettings.addElement("useConsent",t.toBoolean(e)),t.dataProtection.saveConsentSettings()},hasConsentState:function(){return!t.isUndefined(t.getGlobalSetting("dataProtection.consentState"))},getConsentState:function(){return t.toBoolean(t.getGlobalSetting("dataProtection.consentState",!1))},getConsentStateStorage:function(){var e=t.dataProtection.consentSettings.getElement("consentState");return"consentState"===e&&(e=!1),t.toBoolean(e)},setConsentState:function(e,n){t.isUndefined(n)&&(n=t.settings),!1!==t.toBoolean(e)&&t.setObjectPath(n,"dataProtection.useConsent",t.toBoolean(e)),t.dataProtection.consentSettings.addElement("consentState",t.toBoolean(e)),t.dataProtection.saveConsentSettings()},dataCanBeTracked:function(){return!t.dataProtection.hasUseConsent()||(!t.dataProtection.getUseConsent()||!!t.dataProtection.hasConsentState()&&t.toBoolean(t.dataProtection.getConsentState()))},saveConsentSettings:function(){var e=t.dataProtection.consentSettings;e.addElement("useConsent",t.dataProtection.getUseConsent()),e.addElement("consentState",t.dataProtection.getConsentState()),e.mergeToGlobal()},loadConsentSettings:function(e){var n=t.dataProtection.consentSettings;n.setStorage("local"),n.mergeFromGlobal();var s=n.getElement("useConsent");"useConsent"===s&&(s=t.dataProtection.getUseConsent());var a=n.getElement("consentState");"consentState"===a&&(a=t.dataProtection.getConsentState()),t.setObjectPath(e,"dataProtection.useConsent",t.toBoolean(s)),t.setObjectPath(e,"dataProtection.consentState",t.toBoolean(a))}},t.support.register({name:"dataProtection",objectType:"core",loaded:!0,active:!0,dependency:["core.dictionary","core.chains"]}),n(),T(e.klevu)?(C.console.type.general&&xe("KlevuLib - library was loaded on the page. Fire reinitialising chain. Fire global klevuInit "),e.klevu=t,t.reInitialize(),"function"==typeof e.klevuInit&&klevuInit()):(C.console.type.general&&ke("KlevuLib - library already loaded on the page, stopping the redefinition of it . Fire reinitialising chain."),t.reInitialize());t.support.register({name:"lib",objectType:"core",loaded:!0,active:!0,dependency:[]})}(e)}("undefined"!=typeof window?window:this)}catch(e){(new Image).src="//stats.ksearchnet.com/error-log?type=jsv2&c=initError&m="+encodeURIComponent('{"error":"LOAD","extra": {"name":"'+e.name+'","line":"'+(e.lineNumber||e.line)+'","script":"'+(e.fileName||e.sourceURL||e.script)+'","stack":"'+(e.stackTrace||e.stack)+'","namespace":"kLib","message":"'+e.message+'"}}'),console.log(e)}klevu.settings.chains.initChain.add({name:"dataProtectionLoad",fire:function(e,t){klevu.getObjectPath(e,"flags.dataProtection.loaded",!1)||(klevu.dataProtection.loadConsentSettings(e),klevu.setObjectPath(e,"flags.dataProtection.loaded",!0))}}),klevu.settings.chains.initChain.add({name:"dataProtectionCheck",fire:function(e,t){var n=klevu.getObjectPath(e,"dataProtection.useConsent");klevu.isUndefined(n)||klevu.toBoolean(n)===klevu.toBoolean(klevu.dataProtection.getUseConsentStorage())||klevu.dataProtection.setUseConsent(n,e);var s=klevu.getObjectPath(e,"dataProtection.consentState");klevu.isUndefined(s)||klevu.toBoolean(s)===klevu.toBoolean(klevu.dataProtection.getConsentStateStorage())||klevu.dataProtection.setConsentState(s,e)}}),klevu({flags:{global:{libLoaded:!0}}}),klevu.event.webhook.runForScopeList({data:{},scope:{},settings:{name:"framework",object:"core",scope:"all",action:"init",singleRun:!0}}),klevu.interactive((function(){klevu({flags:{global:{libInteractive:!0}}})})),function(e){var t={markAllResourcesLoaded:function(){e.search.modules.kmcInputs.hasAllResourcesLoadedJson=!0,e.getGlobalSetting("console.type.kmc")&&e.logDebug("KMC - Data ready to be used"),"function"==typeof klevu_processKMCInputData&&klevu_processKMCInputData();e({kmc:{loaded:!0}})},loadCallBack:function(t,n){var s=e.getObjectPath(e.search,"modules.kmcInputs.kmcDictionary"),a=s.getElement(n.apiKey);if(e.isUndefined(t.klevu_banner)||(t.klevu_banner=e.search.modules.kmcInputs.base.removeIneligibleBanners(t.klevu_banner)),e.isUndefined(t.klevu_autoCorrectMap)||(t.klevu_autoCorrectMap=e.search.modules.kmcInputs.base.sortAutocorrectMap(t.klevu_autoCorrectMap)),(a=a===n.apiKey?t:e.extend(!0,JSON.parse(a),t)).timeOfLoad=e.time.timestamp(),s.addElement(n.apiKey,JSON.stringify(a)),s.overrideGlobal(),e.search.modules.kmcInputs.loadCounter===n.totalToLoad){var i=e.getObjectPath(e.search,"modules.kmcInputs.kmcData");e.isUndefined(i)&&(e.search.modules.kmcInputs.kmcData=JSON.parse(s.getElement(n.apiKey))),e.search.modules.kmcInputs.base.markAllResourcesLoaded()}},loadKmcData:function(t){e.search.modules.kmcInputs.resourceLoadInitiatedJson=!0,e.search.modules.kmcInputs.loadCounter=0;var n=e.getObjectPath(e.search,"modules.kmcInputs.kmcDictionary");n.removeElement(t),n.overrideGlobal();var s=e.getSetting(e.settings,"settings.url.kmcData");s&&s.length||(s="https://js.klevu.com/klevu-js-v1/klevu-js-api/");var a=[{id:t,src:s+t+".json"},{id:t+"-banner",src:s+t+"-banner.json"},{id:t+"-maps",src:s+t+"-maps.json"}];a.forEach((function(n){var s={url:n.src,type:"json",mimeType:"application/json",apiKey:t,totalToLoad:a.length},i={success:function(t,n,s,a){e.search.modules.kmcInputs.loadCounter++,e.search.modules.kmcInputs.base.loadCallBack(t,n)},error:function(t,n,s,a){e.search.modules.kmcInputs.loadCounter++,e.search.modules.kmcInputs.base.loadCallBack(t,n)},options:s},o={url:s.url,type:"FETCH",method:"GET",mimeType:s.mimeType,crossDomain:!0,success:function(e,t,n,s){t.success(e,t.options,n,s)},error:function(e,t,n){e.error({},e.options,t,n)}};e.request(o,i)}))},removeIneligibleBanners:function(e){if(e.length>0){var t,n,s=new Date,a=!1;s.setHours(0,0,0,0);for(var i=0;i<e.length;i++)t=new Date(e[i].startDate),a=!1,void 0!==e[i].endDate&&e[i].endDate?(n=new Date(e[i].endDate),a=t>s||n<s):a=t>s,a&&(e.splice(i,1),i--)}return e},sortAutocorrectMap:function(e){var t,n,s=0,a=0,i=0,o=0,c=0;for(a=0,t=e.length;a<t;a++)for(s=e[a].keyword.length,c=a+1,i=e.length;c<i;c++)s<(o=e[c].keyword.length)&&(s=o,n=e[a],e[a]=e[c],e[c]=n);return e},getDataPath:function(t){var n,s=e.getObjectPath(e.search,"modules.kmcInputs.kmcData."+t);return window&&(n=e.getInterfaceObjectPath(window,t)),e.isUndefined(n)?s:n},getBannerList:function(){var t=e.getObjectPath(e.search,"modules.kmcInputs.kmcData.klevu_banner",[]);return"undefined"==typeof klevu_banner||e.isEmptyObject(klevu_banner)?t:klevu_banner},getKeywordUrlMap:function(){var t=e.getObjectPath(e.search,"modules.kmcInputs.kmcData.klevu_keywordUrlMap",{});return"undefined"==typeof klevu_keywordUrlMap||e.isEmptyObject(klevu_keywordUrlMap)?t:klevu_keywordUrlMap},getMaxNumberOfAutoSuggestions:function(){var t=e.getObjectPath(e.search,"modules.kmcInputs.kmcData.klevu_maxSuggestionsToShow",5);return"undefined"!=typeof klevu_maxSuggestionsToShow&&klevu_maxSuggestionsToShow?klevu_maxSuggestionsToShow:t},getMaxNumberOfQuickSearchCategories:function(){var t=e.getObjectPath(e.search,"modules.kmcInputs.kmcData.klevu_maxCategoriesToShow",3);return"undefined"!=typeof klevu_maxCategoriesToShow&&klevu_maxCategoriesToShow?klevu_maxCategoriesToShow:t},getMaxNumberOfProductSuggestions:function(){var t=e.getObjectPath(e.search,"modules.kmcInputs.kmcData.klevu_productsToShowInSlimLayout",3);return"undefined"!=typeof klevu_productsToShowInSlimLayout?klevu_productsToShowInSlimLayout:t},getColorSwatchesEnableValue:function(){var t=e.getObjectPath(e.search,"modules.kmcInputs.kmcData.klevu_uc_userOptions.showProductSwatches",!1);return"undefined"!=typeof klevu_uc_userOptions&&void 0!==klevu_uc_userOptions.showProductSwatches?klevu_uc_userOptions.showProductSwatches:t},getFiltersEnableValue:function(){var t=e.getObjectPath(e.search,"modules.kmcInputs.kmcData.klevu_filtersEnabled",!0);return"undefined"!=typeof klevu_filtersEnabled?klevu_filtersEnabled:t},getLandingFilterPosition:function(){var t=e.getObjectPath(e.search,"modules.kmcInputs.kmcData.klevu_uc_userOptions.landingFilterPosition","left");return"undefined"!=typeof klevu_uc_userOptions&&void 0!==klevu_uc_userOptions.landingFilterPosition?klevu_uc_userOptions.landingFilterPosition:t},getFilterMultiSelectValue:function(){var t=e.getObjectPath(e.search,"modules.kmcInputs.kmcData.klevu_multiSelectFilters",!0);return"undefined"!=typeof klevu_multiSelectFilters?klevu_multiSelectFilters:t},getShowOutOfStockValue:function(){var t=e.getObjectPath(e.search,"modules.kmcInputs.kmcData.klevu_showOutOfStock",!1);return"undefined"!=typeof klevu_showOutOfStock?klevu_showOutOfStock:t},getOutOfStockCaptionValue:function(){var t=e.getObjectPath(e.search,"modules.kmcInputs.kmcData.klevu_uc_userOptions.outOfStockCaption","");return"undefined"!=typeof klevu_uc_userOptions&&void 0!==klevu_uc_userOptions.outOfStockCaption&&klevu_uc_userOptions.outOfStockCaption.length?klevu_uc_userOptions.outOfStockCaption:t},getShowPopularSearchesValue:function(){var t=e.getObjectPath(e.search,"modules.kmcInputs.kmcData.klevu_showPopularSearches",!1);return"undefined"!=typeof klevu_showPopularSearches?klevu_showPopularSearches:t},getShowRecentSearchesValue:function(){var t=e.getObjectPath(e.search,"modules.kmcInputs.kmcData.klevu_showRecentSerches",!1);return"undefined"!=typeof klevu_showRecentSerches?klevu_showRecentSerches:t},getWebstorePopularTermsValue:function(){var t=e.getObjectPath(e.search,"modules.kmcInputs.kmcData.klevu_webstorePopularTerms",[]);return"undefined"!=typeof klevu_webstorePopularTerms&&klevu_webstorePopularTerms.length?klevu_webstorePopularTerms:t},getCmsEnabledValue:function(){var t=e.getObjectPath(e.search,"modules.kmcInputs.kmcData.klevu_cmsEnabled",!1);return"undefined"!=typeof klevu_cmsEnabled?klevu_cmsEnabled:t},getAddToCartEnableValue:function(){var t=e.getObjectPath(e.search,"modules.kmcInputs.kmcData.klevu_addToCartEnabled",!1);return"undefined"!=typeof klevu_addToCartEnabled?klevu_addToCartEnabled:t},getAddToCartButtonCaption:function(){var t=e.getObjectPath(e.search,"modules.kmcInputs.kmcData.klevu_uc_userOptions.addToCartButton","Add to cart");return"undefined"!=typeof klevu_uc_userOptions&&void 0!==klevu_uc_userOptions.addToCartButton?klevu_uc_userOptions.addToCartButton:t},getNoResultsFoundObject:function(){var t=e.getObjectPath(e.search,"modules.kmcInputs.kmcData.klevu_uc_userOptions.noResultsOptions",{});return"undefined"!=typeof klevu_uc_userOptions&&void 0!==klevu_uc_userOptions.noResultsOptions?klevu_uc_userOptions.noResultsOptions:t},getShowSearchOnLandingPageEnableValue:function(){var t=e.getObjectPath(e.search,"modules.kmcInputs.kmcData.klevu_uc_userOptions.showSearchBoxOnLandingPage",!1);return"undefined"!=typeof klevu_uc_userOptions&&void 0!==klevu_uc_userOptions.showSearchBoxOnLandingPage?klevu_uc_userOptions.showSearchBoxOnLandingPage:t},getSkuOnPageEnableValue:function(){var t=e.getObjectPath(e.search,"modules.kmcInputs.kmcData.klevu_showProductCode",!1);return"undefined"!=typeof klevu_showProductCode&&"boolean"==typeof klevu_showProductCode?klevu_showProductCode:t},getKMCUserOptionsNoImageUrl:function(){var t=e.getObjectPath(e.search,"modules.kmcInputs.kmcData.klevu_uc_userOptions.noImageUrl","/klevu-js-v1/img-1-1/place-holder.jpg");return e.getObjectPath(e.search,"modules.kmcInputs.kmcData.klevu_uc_userOptions.isFullImageUrlProvided",!1)||(t=e.settings.url.protocol+"//"+e.getObjectPath(e.search,"modules.kmcInputs.kmcData.klevu_userJavascriptDomain","js.klevu.com")+t),"undefined"!=typeof klevu_uc_userOptions&&void 0!==klevu_uc_userOptions.noImageUrl?klevu_uc_userOptions.noImageUrl:t},getShowRolloverImageValue:function(){var t=e.getObjectPath(e.search,"modules.kmcInputs.kmcData.klevu_uc_userOptions.showRolloverImage",!1);return"undefined"!=typeof klevu_uc_userOptions&&void 0!==klevu_uc_userOptions.showRolloverImage?klevu_uc_userOptions.showRolloverImage:t},getVatCaption:function(){var t=e.getObjectPath(e.search,"modules.kmcInputs.kmcData.klevu_uc_userOptions.vatCaption",!1);return"undefined"!=typeof klevu_uc_userOptions&&void 0!==klevu_uc_userOptions.vatCaption?klevu_uc_userOptions.vatCaption:t},getShowPrices:function(){var t=e.getObjectPath(e.search,"modules.kmcInputs.kmcData.klevu_showPrices",!1);return"undefined"!=typeof klevu_showPrices&&"boolean"==typeof klevu_showPrices?klevu_showPrices:t},getShowPriceSlider:function(){var t=e.getObjectPath(e.search,"modules.kmcInputs.kmcData.klevu_showPriceSlider",!1);return"undefined"!=typeof klevu_showPriceSlider&&"boolean"==typeof klevu_showPriceSlider?klevu_showPriceSlider:t},getPriceIntervalValue:function(){var t=e.getObjectPath(e.search,"modules.kmcInputs.kmcData.klevu_uc_userOptions.priceInterval",500);return"undefined"!=typeof klevu_uc_userOptions&&void 0!==klevu_uc_userOptions.priceInterval?klevu_uc_userOptions.priceInterval:t},getFacetRangeFilterSettings:function(){var t=!1,n=e.search.modules.kmcInputs.base.getShowPrices(),s=e.search.modules.kmcInputs.base.getShowPriceSlider(),a=e.search.modules.kmcInputs.base.getPriceIntervalValue();return n&&(t={key:"klevu_price"},s?t.minMax="true":t.rangeInterval=a),t},getPriceFormatterObject:function(t){var n={},s=e.getObjectPath(e.search,"modules.kmcInputs.kmcData.klevu_uc_userOptions.priceFormatter",void 0),a="undefined"!=typeof klevu_uc_userOptions&&klevu_uc_userOptions.priceFormatter?klevu_uc_userOptions.priceFormatter:s;if(void 0===a||"object"!=typeof a){if("undefined"==typeof klevu_priceFormatters||!klevu_priceFormatters[t])return n={string:t,format:"%s %s"};a=klevu_priceFormatters[t]}else if("undefined"!=typeof klevu_priceFormatters&&klevu_priceFormatters[t]){var i=klevu_priceFormatters[t];a=e.extend(!0,i,a)}return void 0!==a.decimalPlaces&&""!==a.decimalPlaces&&(n.precision=a.decimalPlaces),void 0!==a.thousandSeparator&&(n.thousand=a.thousandSeparator),void 0!==a.decimalSeparator&&""!==a.decimalSeparator&&(n.decimal=a.decimalSeparator),void 0!==a.currencySymbol&&""!==a.currencySymbol&&(n.string=a.currencySymbol),void 0!==a.appendCurrencyAtLast&&""!==a.appendCurrencyAtLast&&(n.atEnd=a.appendCurrencyAtLast),void 0!==a.format&&""!==a.format?n.format=a.format:n.format="%s %s",n},getEnablePersonalisationInSearch:function(){var t=e.getObjectPath(e.search,"modules.kmcInputs.kmcData.klevu_uc_userOptions.enablePersonalisationInSearch",!1);return"undefined"!=typeof klevu_uc_userOptions&&void 0!==klevu_uc_userOptions.enablePersonalisationInSearch?klevu_uc_userOptions.enablePersonalisationInSearch:t},getEnablePersonalisationInCatNav:function(){var t=e.getObjectPath(e.search,"modules.kmcInputs.kmcData.klevu_uc_userOptions.enablePersonalisationInCatNav",!1);return"undefined"!=typeof klevu_uc_userOptions&&void 0!==klevu_uc_userOptions.enablePersonalisationInCatNav?klevu_uc_userOptions.enablePersonalisationInCatNav:t},getShowRecentlyViewedItemsValue:function(){var t={showRecentlyViewedItems:e.getObjectPath(e.search,"modules.kmcInputs.kmcData.klevu_uc_userOptions.showRecentlyViewedItems",!1),showRecentlyViewedItemsLimit:e.getObjectPath(e.search,"modules.kmcInputs.kmcData.klevu_uc_userOptions.showRecentlyViewedItemsLimit",10),showRecentlyViewedItemsCaption:e.getObjectPath(e.search,"modules.kmcInputs.kmcData.klevu_uc_userOptions.showRecentlyViewedItemsCaption","")};return"undefined"!=typeof klevu_uc_userOptions&&(void 0!==klevu_uc_userOptions.showRecentlyViewedItems&&(t.showRecentlyViewedItems=klevu_uc_userOptions.showRecentlyViewedItems),void 0!==klevu_uc_userOptions.showRecentlyViewedItemsCaption&&(t.showRecentlyViewedItemsCaption=klevu_uc_userOptions.showRecentlyViewedItemsCaption),void 0!==klevu_uc_userOptions.showRecentlyViewedItemsLimit&&(t.showRecentlyViewedItemsLimit=klevu_uc_userOptions.showRecentlyViewedItemsLimit)),t},getShowTrendingProductsValue:function(){var t={showTrendingProducts:e.getObjectPath(e.search,"modules.kmcInputs.kmcData.klevu_uc_userOptions.showTrendingProducts",!1),showTrendingProductsLimit:e.getObjectPath(e.search,"modules.kmcInputs.kmcData.klevu_uc_userOptions.showTrendingProductsLimit",10),showTrendingProductsCaption:e.getObjectPath(e.search,"modules.kmcInputs.kmcData.klevu_uc_userOptions.showTrendingProductsCaption","")};return"undefined"!=typeof klevu_uc_userOptions&&(void 0!==klevu_uc_userOptions.showTrendingProducts&&(t.showTrendingProducts=klevu_uc_userOptions.showTrendingProducts),void 0!==klevu_uc_userOptions.showTrendingProductsCaption&&(t.showTrendingProductsCaption=klevu_uc_userOptions.showTrendingProductsCaption),void 0!==klevu_uc_userOptions.showTrendingProductsLimit&&(t.showTrendingProductsLimit=klevu_uc_userOptions.showTrendingProductsLimit)),t},getQuickSearchLayoutType:function(){var t=e.getObjectPath(e.search,"modules.kmcInputs.kmcData.klevu_layoutType","slim");return"undefined"!=typeof klevu_layoutType&&""!==klevu_layoutType?klevu_layoutType:t},getQuickSearchLayoutView:function(){var t=e.getObjectPath(e.search,"modules.kmcInputs.kmcData.klevu_layoutView","grid");return"undefined"!=typeof klevu_layoutView&&""!==klevu_layoutView?klevu_layoutView:t},isQuickFacetedLayoutFilterOnLeft:function(){var t=e.getObjectPath(e.search,"modules.kmcInputs.kmcData.klevu_filtersOnLeft",!0);return"undefined"!=typeof klevu_filtersOnLeft?klevu_filtersOnLeft:t},showProductRatingQuick:function(){var t=e.getObjectPath(e.search,"modules.kmcInputs.kmcData.klevu_uc_userOptions.showRatingsOnQuickSearches",!0);return"undefined"!=typeof klevu_uc_userOptions&&void 0!==klevu_uc_userOptions.showRatingsOnQuickSearches?klevu_uc_userOptions.showRatingsOnQuickSearches:t},showProductRatingLanding:function(){var t=e.getObjectPath(e.search,"modules.kmcInputs.kmcData.klevu_uc_userOptions.showRatingsOnSearchResultsLandingPage",!0);return"undefined"!=typeof klevu_uc_userOptions&&void 0!==klevu_uc_userOptions.showRatingsOnSearchResultsLandingPage?klevu_uc_userOptions.showRatingsOnSearchResultsLandingPage:t},showProductRatingCatnav:function(){var t=e.getObjectPath(e.search,"modules.kmcInputs.kmcData.klevu_uc_userOptions.showRatingsOnCategoryPage",!0);return"undefined"!=typeof klevu_uc_userOptions&&void 0!==klevu_uc_userOptions.showRatingsOnCategoryPage?klevu_uc_userOptions.showRatingsOnCategoryPage:t},showProductRatingCountQuick:function(){var t=e.getObjectPath(e.search,"modules.kmcInputs.kmcData.klevu_uc_userOptions.showRatingsCountOnQuickSearches",!1);return"undefined"!=typeof klevu_uc_userOptions&&void 0!==klevu_uc_userOptions.showRatingsCountOnQuickSearches?klevu_uc_userOptions.showRatingsCountOnQuickSearches:t},showProductRatingCountLanding:function(){var t=e.getObjectPath(e.search,"modules.kmcInputs.kmcData.klevu_uc_userOptions.showRatingsCountOnSearchResultsLandingPage",!1);return"undefined"!=typeof klevu_uc_userOptions&&void 0!==klevu_uc_userOptions.showRatingsCountOnSearchResultsLandingPage?klevu_uc_userOptions.showRatingsCountOnSearchResultsLandingPage:t},showProductRatingCountCatnav:function(){var t=e.getObjectPath(e.search,"modules.kmcInputs.kmcData.klevu_uc_userOptions.showRatingsCountOnCategoryPage",!1);return"undefined"!=typeof klevu_uc_userOptions&&void 0!==klevu_uc_userOptions.showRatingsCountOnCategoryPage?klevu_uc_userOptions.showRatingsCountOnCategoryPage:t}};e.extend(!0,e,{search:{modules:{kmcInputs:{base:t,build:!0,hasAllResourcesLoadedJson:!1,resourceLoadInitiatedJson:!1}}}});e({}),e.support.register({name:"kmc",loaded:!0,active:!0,dependency:["core.lib"]})}(klevu),klevu.settings.chains.initChain.add({name:"kmcPowerUp",fire:function(e,t){var n=klevu.getGlobalSetting("search.apiKey",klevu.getGlobalSetting("global.apiKey"));if(!klevu.isUndefined(n)){var s=klevu.getGlobalSetting("powerUp.kmc");if(!klevu.isUndefined(s)&&!1===s)return;var a=klevu.getObjectPath(klevu.search,"modules.kmcInputs.hasAllResourcesLoadedJson");if(!klevu.isUndefined(a)&&!0===a)return;var i=klevu.getGlobalSetting("kmc.loaded");if(!klevu.isUndefined(a)&&!0===i)return;if(!klevu.getObjectPath(e,"constants.COOKIE_KLEVU_RCP",!1)){var o=n.replace(new RegExp("-","g"),"_");klevu.setObjectPath(e,"constants.COOKIE_KLEVU_RCP","klevu_rcp_"+o),klevu.getGlobalSetting("console.type.kmc")&&klevu.logDebug("KMC - Cookie constant set")}klevu.getGlobalSetting("console.type.kmc")&&klevu.logDebug("KMC - Api key found , Starting KMC powerUp");var c=klevu.getObjectPath(klevu.search,"modules.kmcInputs.kmcDictionary");klevu.isUndefined(c)&&((c=klevu.dictionary("kmcData")).setStorage("local"),c.mergeFromGlobal(),klevu.setObjectPath(klevu.search,"modules.kmcInputs.kmcDictionary",c),klevu.getGlobalSetting("console.type.kmc")&&klevu.logDebug("KMC - dictionary set"));var r=c.getElement(n),l=!0;if(n!==r)(r=JSON.parse(r)).timeOfLoad+parseInt(klevu.getGlobalSetting("kmc.invalidateInterval",600))>klevu.time.timestamp()&&(l=!1),klevu.setObjectPath(klevu.search,"modules.kmcInputs.kmcData",r),klevu.getGlobalSetting("console.type.kmc")&&klevu.logDebug("KMC - KMC data set from localStorage");if(l){var u=klevu.getObjectPath(klevu.search,"modules.kmcInputs.resourceLoadInitiatedJson");(klevu.isUndefined(u)||!1===u)&&(klevu.search.modules.kmcInputs.base.loadKmcData(n),klevu.getGlobalSetting("console.type.kmc")&&klevu.logDebug("KMC - File loading started"))}else klevu.getGlobalSetting("console.type.kmc")&&klevu.logDebug("KMC - File loading skipped"),klevu.search.modules.kmcInputs.base.markAllResourcesLoaded()}}}),function(e){e.extend({searchEvents:{functions:{}}}),e.extend(!0,e.searchEvents,{general:{documentClick:function(t){if(t=t||window.event,e.isUndefined(t.target)||!e.isUndefined(t.target.kObject))return t;e.settings.console.type.event&&(e.logDebug("Event - documentClick"),e.logDebug(t));var n={event:t,preventDefault:!1};return e.event.fireChain(e.settings.chains,"documentClick",this,n,t),t},documentScroll:function(t){if(t=t||window.event,e.isUndefined(t.target)||!e.isUndefined(t.target.kObject))return t;var n={event:t,preventDefault:!1};return e.event.fireChain(e.settings.chains,"documentScroll",this,n,t),t}},functions:{bindAllExtraEvents:{name:"interactive-search-extra-events",fire:function(){e.event.detach(document,"click",e.searchEvents.general.documentClick),e.event.attach(document,"click",e.searchEvents.general.documentClick);var t=e.getSetting(e.settings,"settings.search.fullPageLayoutEnabled",!1);!e.isUndefined(t)&&t&&(e.settings.chains.documentScroll=e.chain({stopOnFalse:!0}),e.event.detach(window,"scroll",e.searchEvents.general.documentScroll),e.event.attach(window,"scroll",e.searchEvents.general.documentScroll))}}}}),e.extend(!0,e.searchEvents,{box:{focus:function(t){return t=t||window.event,e.settings.console.type.event&&(e.logDebug("Event - FocusEvent"),e.logDebug(t)),this.kScope.data=this.kObject.resetData(this),this.kScope.data.context.keyCode=0,this.kScope.data.context.eventObject=t,this.kScope.data.context.event="focus",this.kScope.data.context.preventDefault=!1,e.search.active=this.kObject,e.event.fireChain(this.kScope,"chains.events.focus",this,this.kScope.data,t),t},keyUp:function(t){return t=t||window.event,e.settings.console.type.event&&(e.logDebug("Event - KeyUp"),e.logDebug(t)),this.kScope.data=this.kObject.resetData(this),this.kScope.data.context.keyCode=t.keyCode?t.keyCode:t.which,this.kScope.data.context.eventObject=t,this.kScope.data.context.event="keyUp",this.kScope.data.context.preventDefault=!1,e.event.fireChain(this.kScope,"chains.events.keyUp",this,this.kScope.data,t),t},submit:function(t){return t=t||window.event,e.settings.console.type.event&&(e.logDebug("Event - SubmitEvent"),e.logDebug(t)),this.kScope.data=this.kObject.resetData(this),this.kScope.data.context.keyCode=0,this.kScope.data.context.eventObject=null,this.kScope.data.context.event="focus",this.kScope.data.context.preventDefault=!1,e.search.active=this.kObject,e.event.fireChain(this.kScope,"chains.events.focus",this,this.kScope.data,null),this.kScope.data=this.kObject.resetData(this),this.kScope.data.context.keyCode=13,this.kScope.data.context.eventObject=t,this.kScope.data.context.event="submit",this.kScope.data.context.preventDefault=!1,e.event.fireChain(this.kScope,"chains.events.submit",this,this.kScope.data,t),t}},functions:{bindAllSearchBoxes:{name:"interactive-search-boxes-activate",fire:function(){e.search.active=null;var t=e.getSetting(e.settings,"settings.search.searchBoxSelector",e.randomId()),n=e.dom.find(t);e.each(n,(function(t,n){if("text"===n.type||"search"===n.type||"input"===n.type){if(!e.isUndefined(n.kObject))return!0;var s=e.searchObjectClone(e.search.base);s.setWebhookSettings({scope:"all,input,quick"}),s.setElement(n),e.getSetting(e.settings,"settings.search.searchBoxTarget",!1)||(e.dom.helpers.addElementToParent(null,"div",{id:n.kScope.id,class:"klevu-fluid"}),e.setSetting(n.kScope.settings,"settings.search.searchBoxTarget",document.getElementById(n.kScope.id))),s.setTarget(e.getSetting(n.kScope.settings,"settings.search.searchBoxTarget",!1)),e.event.attach(s.getScope().element,"focus",e.searchEvents.box.focus,!0),e.event.attach(s.getScope().element,"keyup",e.searchEvents.box.keyUp,!0),e.event.attach(s.getScope().element,"paste",(function(t){setTimeout((function(){e.searchEvents.box.keyUp.call(t.target,t)}),10)}),!0),n.form&&(s.setLinkObjectsToElement(n.form),e.event.attach(s.getScope().element.form,"submit",e.searchEvents.box.submit,!0)),s.getScope().element.setAttribute("autocomplete","off");var a=e.getSetting(n.kScope.settings,"settings.search.maxChars",128);return s.getScope().element.setAttribute("maxlength",a),e.isUndefined(e.search.quick)&&e.extend(!0,e.search,{quick:s}),e.search.extraSearchBox.push(s),!0}}))}}}}),e.settings.chains.documentClick=e.chain({stopOnFalse:!0}),e.coreEvent.build({name:"buildSearch",fire:function(){return!(!e.isInteractive||e.isUndefined(e.search)||e.isUndefined(e.search.build)||!e.getSetting(e.settings,"settings.localSettings",!1))}}),e.coreEvent.attach("buildSearch",e.extend(!0,{},e.searchEvents.functions.bindAllSearchBoxes)),e.coreEvent.attach("buildSearch",e.extend(!0,{},e.searchEvents.functions.bindAllExtraEvents)),e.extend({searchObjectChains:{build:e.chain({stopOnFalse:!0})},searchObjectBuild:function(){var t={cache:e.cache(),settings:{},webhookSettings:{run:!0,object:"search",scope:"all"}};function n(){e.setObjectPath(t,"translator",t.template.getTranslator()),e.setObjectPath(t,"currency",t.translator.getCurrencyObject())}function s(){var e={context:{landingUrl:null,term:null,termOriginal:null,keyCode:0,eventObject:null,event:null,eventAction:"",preventDefault:!1,status:null,isSuccess:!1,doRequest:!0},request:{settings:{url:null,object:{}},last:{},current:{context:{},suggestions:[],recordQueries:[]}},response:{ajax:{object:{},data:{}},current:{meta:{},suggestionResults:[],queryResults:[]}},localOverrides:{suggestion:{},query:{}},template:{settings:null,suggestions:{},query:{}}};return e.template.settings=e.context,e}e.setObjectPath(t,"id",e.randomId()),e.setObjectPath(t,"template",e.template()),t.template.setWebhookSettings({run:t.webhookSettings.run,object:t.webhookSettings.object,scope:t.webhookSettings.scope}),n(),e.setObjectPath(t,"chains.actions.doSearch",e.chain({stopOnFalse:!0,webhook:{name:"chains.actions.doSearch"}})),e.setObjectPath(t,"chains.events.focus",e.chain({stopOnFalse:!0,webhook:{name:"chains.events.focus"}})),e.setObjectPath(t,"chains.events.keyUp",e.chain({stopOnFalse:!0,webhook:{name:"chains.events.keyUp"}})),e.setObjectPath(t,"chains.events.submit",e.chain({stopOnFalse:!0,webhook:{name:"chains.events.submit"}})),e.setObjectPath(t,"chains.processors.inputString",e.chain({stopOnFalse:!0,webhook:{name:"chains.processors.inputString"}})),e.setObjectPath(t,"chains.request.control",e.chain({stopOnFalse:!0,webhook:{name:"chains.request.control"}})),e.setObjectPath(t,"chains.request.build",e.chain({stopOnFalse:!0,webhook:{name:"chains.request.build"}})),e.setObjectPath(t,"chains.request.send",e.chain({stopOnFalse:!0,webhook:{name:"chains.request.send"}})),e.setObjectPath(t,"chains.request.ajax.send",e.chain({stopOnFalse:!0,webhook:{name:"chains.request.ajax.send"}})),e.setObjectPath(t,"chains.request.fetch.send",e.chain({stopOnFalse:!0,webhook:{name:"chains.request.fetch.send"}})),e.setObjectPath(t,"chains.response.success",e.chain({stopOnFalse:!0,webhook:{name:"chains.response.success"}})),e.setObjectPath(t,"chains.response.done",e.chain({stopOnFalse:!0,webhook:{name:"chains.response.done"}})),e.setObjectPath(t,"chains.response.fail",e.chain({stopOnFalse:!0,webhook:{name:"chains.response.fail"}})),e.setObjectPath(t,"chains.response.ajax.success",e.chain({stopOnFalse:!0,webhook:{name:"chains.response.fail"}})),e.setObjectPath(t,"chains.response.ajax.done",e.chain({stopOnFalse:!0,webhook:{name:"chains.response.fail"}})),e.setObjectPath(t,"chains.response.ajax.fail",e.chain({stopOnFalse:!0,webhook:{name:"chains.response.fail"}})),e.setObjectPath(t,"chains.template.process.success",e.chain({stopOnFalse:!0,webhook:{name:"chains.template.process.success"}})),e.setObjectPath(t,"chains.template.handleError",e.chain({stopOnFalse:!0,webhook:{name:"chains.template.handleError"}})),e.setObjectPath(t,"chains.template.render",e.chain({stopOnFalse:!0,webhook:{name:"chains.template.render"}})),e.setObjectPath(t,"chains.template.events",e.chain({stopOnFalse:!0,webhook:{name:"chains.template.events"}})),t.data=s();var a=e.getObjectPath(e.searchObjectChains,"build");return e.isUndefined(a)||0===a.list().length||(a.setScope(t),a.setData(t.data),a.fire()),{init:function(){},resetData:function(e){var t=s();return e.kScope.data.context.termOriginal!==e.kElem.value&&(e.kScope.data.localOverrides=t.localOverrides),e.kScope.data.context=t.context,e.kScope.data.context.term=e.kElem.value,e.kScope.data.context.termOriginal=e.kElem.value,e.kScope.data.request.current=t.request.current,e.kScope.data.response.current=t.response.current,e.kScope.data.template.suggestions=t.template.suggestions,e.kScope.data.template.query=t.template.query,e.kScope.data.template.settings=e.kScope.data.context,e.kScope.data.request.settings.object={},e.kScope.data.response.ajax.object={},e.kScope.data.response.ajax.data={},e.kScope.data.response.data={},e.kScope.data.response.object={},e.kScope.data.scope=null,e.kScope.data},buildData:s,setTarget:function(t){e.setSetting(this.getScope().settings,"settings.search.searchBoxTarget",t),t.kObject=this,t.kScope=this.getScope(),t.kElem=this.getScope().element.kElem,t.classList.add("klevuTarget"),t.webhookSettings=this.getScope().webhookSettings},setElement:function(e){this.getScope().element=e,e.kObject=this,e.kScope=this.getScope(),e.kElem=this.getScope().element,e.webhookSettings=this.getScope().webhookSettings},setLinkObjectsToElement:function(e){e.kObject=this,e.kScope=this.getScope(),e.kElem=this.getScope().element,e.webhookSettings=this.getScope().webhookSettings},setScope:function(e){return t=e},getScope:function(){return t},getCache:function(){return t.cache},setWebhookSettings:function(n){return n&&(t.webhookSettings=e.extend(!0,t.webhookSettings,n),t.template.setWebhookSettings({run:t.webhookSettings.run,object:t.webhookSettings.object,scope:t.webhookSettings.scope})),this},getWebhookSettings:function(){return t.webhookSettings},resetTranslator:n}},searchObjectClone:function(t){var n=e.searchObjectBuild();return n.setScope(e.extend(!0,{},t.getScope())),n.getScope().element=document.createElement("INPUT"),n.getScope().data=n.buildData(),n.getScope().id=e.randomId(),n.getScope().template=e.templateClone(n.getScope().template),n.resetTranslator(),n.getScope().element.kObject=n,n.getScope().element.kScope=n.getScope(),n.getScope().element.kElem=n.getScope().element,n.getScope().element.webhookSettings=n.getScope().webhookSettings,n}});e({search:{searchBoxSelector:"input#klevu-search",searchBoxTarget:!1,minChars:3,placeholder:"Search",showQuickOnEnter:!1,fullPageLayoutEnabled:!1,personalisation:!1,redirects:[],map:{recordQuery:{id:"",typeOfRequest:"",isFallbackQuery:!1,isBoostQuery:!1,settings:{query:{term:"",context:{recentTerms:[],recentObjects:[],includeIds:[],excludeIds:[]}},typeOfRecords:["KLEVU_PRODUCT"],groupBy:"",fields:[],offset:0,limit:0,typeOfSearch:"",searchPrefs:[],sort:"",priceFieldSuffix:"",fallbackWhenCountLessThan:0,fallbackQueryId:"",personalisation:{enablePersonalisation:!1}},filters:{filtersToReturn:{enabled:!1,options:{order:"",limit:0,minCount:0},include:[],exclude:[],rangeFilterSettings:[{key:"",minMax:!1,rangeInterval:0}]},applyFilters:{filters:[{key:"",values:[],settings:{singleSelect:!1}}]}},boost:{filters:[{key:"",values:[],weight:0}],keywords:[{phrase:"",weight:0}],records:[{id:"",weight:0}],boostQueryId:""}},suggestions:{id:"",query:"",typeOfRequest:"",limit:0,includeFilters:!1,filterLimit:0,applyFilters:[]}}}}),e.getObjectPath(e.support,"webhook",!1)&&(e.event.webhook.attach({object:"search",scope:"all",name:"mainObject",action:"build",fire:function(t,n){let s=e.getObjectPath(n.kObject.getWebhookSettings(),"scope",!1);if(s){s=s.split(",");let t=e.getGlobalSetting("theme.setTemplates",!1);t&&e.each(t,(function(t,a){let i=e.getObjectPath(a,"scope",!1);i&&(i=i.split(","),e.each(i,(function(t,i){if(-1!==e.inArray(i.trim(),s))try{let t=e.getObjectPath(a,"listBefore",!1),s=e.getObjectPath(a,"listAfter",!1),i=e.getObjectPath(a,"list",a.name);t?(t=t.split(":"),e.isUndefined(t[1])||e.isEmptyObject(t[1])?(i=t[0],t=t[0]):(i=t[0],t=t[1])):s&&(s=s.split(":"),e.isUndefined(s[1])||e.isEmptyObject(s[1])?(i=s[0],s=s[0]):(i=s[0],s=s[1])),n.kScope.template.setTemplate({template:e.dom.helpers.getHTML(a.selector),name:a.name,decoded:!0,list:i,before:t,after:s})}catch(t){e.getGlobalSetting("console.type.webhook",!1)&&e.logError("KLEVU: While trying to add template '"+a.name+"' we encounted an error",t)}})))}))}}}),e.event.webhook.attach({object:"search",scope:"all",name:"mainObject",action:"build",fire:function(t,n){let s=e.getObjectPath(n.kObject.getWebhookSettings(),"scope",!1);if(s){s=s.split(",");let t=e.getGlobalSetting("theme.setHelpers",!1);t&&e.each(t,(function(t,a){let i=t;i&&(i=i.split(","),e.each(i,(function(t,i){-1!==e.inArray(i.trim(),s)&&e.each(a,(function(e,t){n.kScope.template.setHelper(e,t)}))})))}))}}}))}(klevu),function(e){var t=e.searchObjectBuild();t.getScope().chains.events.focus.add({name:"check-placeholder",fire:function(t,n){var s=e.getSetting(n.kScope.settings,"settings.search.placeholder");if(t.context.term.toLowerCase()===s.toLowerCase())return n.value="",!1}}),t.getScope().chains.events.keyUp.add({name:"isCharacterNotAllowed",fire:function(t,n){if((t.context.keyCode>=9&&t.context.keyCode<=45||t.context.keyCode>=91&&t.context.keyCode<=93||t.context.keyCode>=112&&t.context.keyCode<=123)&&13!==t.context.keyCode&&32!==t.context.keyCode)return!1;if(null!==t.context.eventObject){if(!e.isUndefined(t.context.eventObject.ctrlKey)&&!0===t.context.eventObject.ctrlKey)return!1;if(!e.isUndefined(t.context.eventObject.altKey)&&!0===t.context.eventObject.altKey)return!1}}}),t.getScope().chains.events.keyUp.add({name:"scrollToTop",fire:function(t,n){e.getSetting(n.kScope.settings,"settings.search.fullPageLayoutEnabled",!1)&&(document.body.scrollTop=document.documentElement.scrollTop=0)}}),t.getScope().chains.events.keyUp.add({name:"doSearch",fire:function(t,n){var s=e.getObjectPath(n.kScope,"chains.actions.doSearch");if(e.isUndefined(s)||0===s.list().length||(s.setScope(n.kElem),s.setData(t),s.fire()),n.kScope.data=t,!0===t.context.preventDefault)return!1}}),t.getScope().chains.events.submit.add({name:"checkRedirect",fire:function(t,n){var s=e.getSetting(n.kScope.settings,"settings.search.redirects",{});if(s&&!e.isUndefined(t.context.term)&&s.hasOwnProperty(t.context.term.trim().toLowerCase())&&(t.context.preventDefault=!0,t.context.eventObject.preventDefault(),document.location=s[t.context.term.trim().toLowerCase()]),!0===t.context.preventDefault)return!1}}),t.getScope().chains.events.submit.add({name:"doSearch",fire:function(t,n){var s=e.getObjectPath(n.kScope,"chains.actions.doSearch");if(e.isUndefined(s)||0===s.list().length||(s.setScope(n.kElem),s.setData(t),s.fire()),n.kScope.data=t,!0===t.context.preventDefault)return!1}}),t.getScope().chains.actions.doSearch.add({name:"showQuickOnEnter",fire:function(t,n){var s=e.getSetting(n.kScope.settings,"settings.search.showQuickOnEnter",!1);13===t.context.keyCode&&s&&"submit"===t.context.event&&t.context.eventObject.preventDefault()}}),t.getScope().chains.actions.doSearch.add({name:"checkInput",fire:function(t,n){var s=e.getObjectPath(n.kScope,"chains.processors.inputString");if(e.isUndefined(s)||0===s.list().length||(s.setScope(n.kElem),s.setData(t),s.fire()),n.kScope.data=t,!0===t.context.preventDefault)return!1}}),t.getScope().chains.actions.doSearch.add({name:"doRequest",fire:function(t,n){t.context.doSearch=!1;var s=e.getObjectPath(n.kScope,"chains.request.control");if(e.isUndefined(s)||0===s.list().length)return t.context.preventDefault=!0,n.kScope.data=t,!1;s.setScope(n.kElem),s.setData(t),s.fire(),n.kScope.data=t}}),t.getScope().chains.processors.inputString.add({name:"checkDefined",fire:function(t,n){if(e.isUndefined(t.context.term)){t.context.preventDefault=!0;var s=e.getObjectPath(n.kScope,"chains.template.handleError");return e.isUndefined(s)||0===s.list().length||(s.setScope(n.kElem),s.setData({section:"inputString",sector:"checkDefined"}),s.fire()),!1}}}),t.getScope().chains.processors.inputString.add({name:"trim",fire:function(e,t){e.context.term=e.context.term.replace(/\s{2,}/g," ").trim()}}),t.getScope().chains.processors.inputString.add({name:"cleanDuplicatedSpaces",fire:function(e,t){e.context.term=e.context.term.replace(/\s\s+/g," ")}}),t.getScope().chains.processors.inputString.add({name:"checkLengthMin",fire:function(t,n){var s=e.getSetting(n.kScope.settings,"settings.search.minChars",0);if(t.context.term.length<s){var a=e.getObjectPath(n.kScope,"chains.template.handleError");return e.isUndefined(a)||0===a.list().length||(a.setScope(n.kElem),a.setData({section:"inputString",sector:"checkLength"}),a.fire()),t.context.preventDefault=!0,!1}}}),t.getScope().chains.processors.inputString.add({name:"checkLengthMax",fire:function(t,n){var s=e.getSetting(n.kScope.settings,"settings.search.maxChars",128);if(t.context.term.length>s){var a=e.getObjectPath(n.kScope,"chains.template.handleError");return e.isUndefined(a)||0===a.list().length||(a.setScope(n.kElem),a.setData({section:"inputString",sector:"checkLength"}),a.fire()),t.context.preventDefault=!0,!1}}}),t.getScope().chains.processors.inputString.add({name:"lowercase",fire:function(e,t){e.context.term=e.context.term.toLowerCase()}}),t.getScope().chains.processors.inputString.add({name:"checkPlaceholder",fire:function(t,n){var s=e.getSetting(n.kScope.settings,"settings.search.placeholder","");if(t.context.term.toLowerCase()===s.toLowerCase()){t.context.preventDefault=!0;var a=e.getObjectPath(n.kScope,"chains.template.handleError");return e.isUndefined(a)||0===a.list().length||(a.setScope(n.kElem),a.setData({section:"inputString",sector:"checkPlaceholder"}),a.fire()),!1}}}),t.getScope().chains.request.ajax.send.add({name:"sendRequest",fire:function(t,n){"searchAjax"===t.context.eventAction&&(t.scope=n,t.context.doSearch?(t.context.requestObject={url:t.request.settings.url,type:"AJAX",method:"POST",mimeType:"application/json; charset=UTF-8",contentType:"application/json; charset=utf-8",dataType:"json",crossDomain:!0,success:function(t){var n=e.getObjectPath(t.requestDetails.scope.kScope,"chains.response.success");e.isUndefined(n)||0===n.list().length||(n.setScope(t.requestDetails.scope.kElem),e.setObjectPath(t.requestDetails,"response.data",t.responseObj.data),e.setObjectPath(t.requestDetails,"context.status",t.status),e.setObjectPath(t.requestDetails,"context.isSuccess",t.isSuccess),n.setData(t.requestDetails),n.fire())},done:function(t){var n=e.getObjectPath(t.requestDetails.scope.kScope,"chains.response.done");e.isUndefined(n)||0===n.list().length||(n.setScope(t.requestDetails.scope.kElem),e.setObjectPath(t.requestDetails,"response.data",t.responseObj.data),e.setObjectPath(t.requestDetails,"context.status",t.status),e.setObjectPath(t.requestDetails,"context.isSuccess",t.isSuccess),n.setData(t.requestDetails),n.fire())},error:function(t){var n=e.getObjectPath(t.requestDetails.scope.kScope,"chains.response.fail");e.isUndefined(n)||0===n.list().length||(n.setScope(t.requestDetails.scope.kElem),e.setObjectPath(t.requestDetails,"response.data",{}),e.setObjectPath(t.requestDetails,"context.status",t.status),e.setObjectPath(t.requestDetails,"context.isSuccess",t.isSuccess),n.setData(t.requestDetails),n.fire())},data:JSON.stringify(t.request.settings.object)},t.context.requestDetails=e.extend(!0,{},t)):e.settings.console.type.ajax&&(e.logError("chains.actions.doSearch - makeRequest - Request object is not present or request was forced stopped."),e.logDebug("chains.actions.doSearch - makeRequest - Data:"),e.logDebug(t)))}}),t.getScope().chains.request.fetch.send.add({name:"sendRequest",fire:function(t,n){"searchAjax"!==t.context.eventAction&&(t.scope=n,t.context.doSearch?(t.context.requestObject={url:t.request.settings.url,type:"FETCH",method:"POST",mimeType:"application/json; charset=UTF-8",contentType:"application/json; charset=utf-8",dataType:"json",crossDomain:!0,success:function(t,n,s,a){var i=e.getObjectPath(n.scope.kScope,"chains.response.success");e.isUndefined(i)||0===i.list().length||(i.setScope(n.scope.kElem),e.setObjectPath(n,"response.data",t),e.setObjectPath(n,"context.status",s),e.setObjectPath(n,"context.isSuccess",a),i.setData(n),i.fire())},error:function(t,n,s){var a=e.getObjectPath(t.scope.kScope,"chains.response.fail");e.isUndefined(a)||0===a.list().length||(a.setScope(t.scope.kElem),e.setObjectPath(t,"response.data",{}),e.setObjectPath(t,"context.status",n),e.setObjectPath(t,"context.isSuccess",s),a.setData(t),a.fire())},data:JSON.stringify(t.request.settings.object)},t.context.requestDetails=e.extend(!0,{},t)):e.settings.console.type.ajax&&(e.logError("chains.actions.doSearch - makeRequest - Request object is not present or request was forced stopped."),e.logDebug("chains.actions.doSearch - makeRequest - Data:"),e.logDebug(t)))}}),t.getScope().chains.request.control.add({name:"initRequest",fire:function(t,n){t.context.doSearch=!1,t.request.original={};var s=e.getObjectPath(n.kScope,"chains.request.build");return e.isUndefined(s)||0===s.list().length?(t.context.preventDefault=!0,n.kScope.data=t,!1):(s.setScope(n.kElem),s.setData(t),s.fire(),n.kScope.data=t,!1!==t.context.doSearch&&void 0)}}),t.getScope().chains.request.control.add({name:"setLocalOverrides",fire:function(t,n){var s=e.getObjectPath(t.localOverrides,"query");e.isUndefined(s)||e.each(s,(function(n,s){var a=t.request.current.recordQueries.filter((function(e){return e.id==n}));a.length>0&&(a=e.extend(!0,a[0],s))}))}}),t.getScope().chains.request.control.add({name:"storeOriginSuggestions",fire:function(t,n){var s=e.getObjectPath(t,"request.current.suggestions");e.setObjectPath(t,"request.original.suggestions",e.extend([],s))}}),t.getScope().chains.request.control.add({name:"storeOriginRecordQueries",fire:function(t,n){var s=e.getObjectPath(t,"request.current.recordQueries");e.setObjectPath(t,"request.original.recordQueries",e.extend([],s))}}),t.getScope().chains.request.control.add({name:"sanitiseRequestSuggestions",fire:function(t,n){var s=e.clean(t.request.current);t.response.current.suggestionResults=[],t.request.last.suggestionRequest={};var a=e.getObjectPath(s,"suggestions");t.request.original.suggestionResults=e.extend(!0,{},a),e.isUndefined(a)||e.each(a,(function(e,s){var i=n.kScope.cache.getCache(s);i?(t.response.current.suggestionResults.push(i),a[e]={}):t.request.last.suggestionRequest[s.id]=s})),t.request.settings.object=s}}),t.getScope().chains.request.control.add({name:"sanitiseRequestQuery",fire:function(t,n){var s=e.clean(t.request.current);t.response.current.queryResults=[],t.request.last.queryRequest={};var a=e.getObjectPath(s,"recordQueries");if(t.request.original.queryRequest=e.extend(!0,{},a),!e.isUndefined(a)){var i=0;e.each(a,(function(e,s){var o=n.kScope.cache.getCache(s);o?(t.response.current.queryResults.push(o),a[e]={}):("true"!=s.isFallbackQuery&&!0!==s.isFallbackQuery||(i+=1),t.request.last.queryRequest[s.id]=s)})),s=e.clean(s),a=e.getObjectPath(s,"recordQueries"),e.isUndefined(a)||a.length!==i||e.setObjectPath(s,"recordQueries",[])}t.request.settings.object=s}}),t.getScope().chains.request.control.add({name:"sanitiseRequestCheckIfAllCache",fire:function(t,n){var s=e.clean(t.request.current);if(t.request.settings.object=s,e.isUndefined(s.recordQueries)&&e.isUndefined(s.suggestions)){t.context.isSuccess=!0,t.context.doSearch=!1,t.context.status=304;var a=e.getObjectPath(n.kScope,"chains.response.success");if(!e.isUndefined(a)&&0!==a.list().length&&(a.setScope(n.kElem),a.setData(t),a.fire(),n.kScope.data=t,!1===t.context.doSearch))return!1}}}),t.getScope().chains.request.control.add({name:"generateURL",fire:function(t,n){var s=e.getSetting(n.kScope.settings,"settings.url.search",!1);s&&(t.request.settings.url=s)}}),t.getScope().chains.request.control.add({name:"makeRequest",fire:function(t,n){var s=e.getObjectPath(n.kScope,"chains.request.send");if(!e.isUndefined(s)&&0!==s.list().length)return s.setScope(n.kElem),s.setData(t),s.fire(),n.kScope.data=t,!1}}),t.getScope().chains.request.build.add({name:"buildMap",fire:function(t,n){t.context.status=null,t.context.isSuccess=!1,t.context.landingUrl=e.getSetting(n.kScope.settings,"settings.url.landing",!1),t.request.current.context.apiKeys=[e.getSetting(n.kScope.settings,"settings.search.apiKey",e.getGlobalSetting("search.apiKey",e.getGlobalSetting("global.apiKey")))],t.request.requestObject={}}}),t.getScope().chains.request.send.add({name:"checkFetch",fire:function(e,t){window.fetch?e.context.eventAction="searchFetch":e.context.eventAction="searchAjax"}}),t.getScope().chains.request.send.add({name:"requestTypeAjax",fire:function(t,n){if("searchAjax"===t.context.eventAction){var s=e.getObjectPath(n.kScope,"chains.request.ajax.send");e.isUndefined(s)||0===s.list().length||(s.setScope(n.kElem),s.setData(t),s.fire(),n.kScope.data=t)}}}),t.getScope().chains.request.send.add({name:"requestTypeFetch",fire:function(t,n){if("searchAjax"!==t.context.eventAction){var s=e.getObjectPath(n.kScope,"chains.request.fetch.send");e.isUndefined(s)||0===s.list().length||(s.setScope(n.kElem),s.setData(t),s.fire(),n.kScope.data=t)}}}),t.getScope().chains.request.send.add({name:"requestSend",fire:function(t,n){e.request(t.context.requestObject,t.context.requestDetails)}}),t.getScope().chains.response.success.add({name:"checkForSuccess",fire:function(e,t){if(t.kElem.data=e,!1===e.context.isSuccess)return!1}}),t.getScope().chains.response.success.add({name:"executeAjaxResponseProcessor",fire:function(t,n){var s=e.getObjectPath(n.kScope,"chains.response.ajax.success");e.isUndefined(s)||0===s.list().length||(s.setScope(n.kElem),s.setData(t),s.fire()),n.kScope.data=t}}),t.getScope().chains.response.success.add({name:"addResponseDataSuggestion",fire:function(t,n){var s=e.getObjectPath(t.response.data,"suggestionResults");e.isUndefined(s)&&(s=[]),s.length>0&&e.each(s,(function(s,a){e.isUndefined(t.request.last.suggestionRequest[a.id])||n.kScope.cache.setCache(t.request.last.suggestionRequest[a.id],a)})),t.response.current.suggestionResults=e.extend(!0,t.response.current.suggestionResults,t.response.current.suggestionResults.concat(s))}}),t.getScope().chains.response.success.add({name:"addResponseDataQuery",fire:function(t,n){var s=e.getObjectPath(t.response.data,"queryResults");e.isUndefined(s)&&(s=[]),s.length>0&&e.each(s,(function(s,a){e.isUndefined(t.request.last.queryRequest[a.id])||n.kScope.cache.setCache(t.request.last.queryRequest[a.id],a)})),t.response.current.queryResults=e.extend(!0,t.response.current.queryResults,t.response.current.queryResults.concat(s))}}),t.getScope().chains.response.success.add({name:"processSuggestions",fire:function(t,n){var s=e.getObjectPath(t.response.current,"suggestionResults");if(e.isUndefined(s))s={};else{var a={};e.each(s,(function(e,t){a[t.id]=t.suggestions})),s=a}t.template.suggestions=s,n.kScope.data=t}}),t.getScope().chains.response.success.add({name:"processQuery",fire:function(t,n){var s=e.getObjectPath(t.response.current,"queryResults");if(e.isUndefined(s))s={};else{var a={};e.each(s,(function(n,s){a[s.id]={meta:s.meta,filters:s.filters,result:s.records},e.setObjectPath(t,"localOverrides.query."+s.id+".settings.typeOfSearch",s.meta.typeOfSearch)})),s=a}t.template.query=s,n.kScope.data=t}}),t.getScope().chains.response.success.add({name:"executeTemplateResponseProcessor",fire:function(t,n){var s=e.getObjectPath(n.kScope,"chains.template.process.success");e.isUndefined(s)||0===s.list().length||(s.setScope(n.kElem),s.setData(t),s.fire()),n.kScope.data=t}}),t.getScope().chains.response.success.add({name:"renderTemplate",fire:function(t,n){var s=e.getObjectPath(n.kScope,"chains.template.render");e.isUndefined(s)||0===s.list().length||(s.setScope(n.kElem),s.setData(t),s.fire()),n.kScope.data=t}}),t.getScope().chains.response.success.add({name:"addEvents",fire:function(t,n){var s=e.getObjectPath(n.kScope,"chains.template.events");e.isUndefined(s)||0===s.list().length||(s.setScope(n.kElem),s.setData(t),s.fire()),n.kScope.data=t}}),t.getScope().chains.template.handleError.add({name:"renderError",fire:function(e,t){return!1}});var n=document.createElement("INPUT");n.value="*",n.kObject=t,n.kScope=n.kObject.getScope(),t.getScope().element=n,n.kElem=n.kObject.getScope().element,e.extend(!0,e,{search:{extraSearchBox:[],base:t,modules:{}}});var s=e.searchObjectClone(t);s.setWebhookSettings({scope:"all,full_page,landing"}),e.extend(!0,e.search,{landing:s}),e.search.build=!0}(klevu),klevu.support.register({name:"search",loaded:!0,active:!0,dependency:["core.lib"]}),function(e){e.isUndefined(e.pageMeta)&&(e.extend({pageMeta:{}}),e.extend(!0,e.pageMeta,{settings:{},oldSettings:{},build:function(){return e.isUndefined(window.klevu_page_meta)||e.pageMeta.update(klevu_page_meta,1),e.isUndefined(window.klevu_meta)||e.pageMeta.update(klevu_meta,2),e.pageMeta.getAllSettings()},updateFromV1:function(t){if(e.pageMeta.setData("page.pageType",e.getObjectPath(t,"pageType","")),e.pageMeta.setData("page.dataType",[e.getObjectPath(t,"pageType","")]),e.getObjectPath(t,"apiKey",!1)&&e({global:{apiKey:e.getObjectPath(t,"apiKey")}}),e.pageMeta.hasPageType())switch(e.pageMeta.getPageType()){case"category":e.pageMeta.setData("page.category.categoryUrl",e.getObjectPath(t,"categoryUrl","")),e.pageMeta.setData("page.category.categoryName",e.getObjectPath(t,"categoryName","")),e.pageMeta.setData("page.category.categoryPath",e.getObjectPath(t,"categoryPath",e.getObjectPath(t,"categoryName",""))),e.pageMeta.setData("page.category.products",e.getObjectPath(t,"categoryProducts",[]));break;case"srlp":e.pageMeta.setData("page.srlp.searchTerm",e.getObjectPath(t,"searchTerm","")),e.pageMeta.setData("page.srlp.searchUrl",e.getObjectPath(t,"searchUrl","")),e.pageMeta.setData("page.srlp.products",e.getObjectPath(t,"products",[]));break;case"pdp":let n={itemName:e.getObjectPath(t,"itemName",""),itemUrl:e.getObjectPath(t,"itemUrl",""),itemId:e.getObjectPath(t,"itemId",""),itemGroupId:e.getObjectPath(t,"itemGroupId",""),itemSalePrice:e.getObjectPath(t,"itemSalePrice",0),itemCurrency:e.getObjectPath(t,"itemCurrency","")};e.pageMeta.setData("page.pdp.products",[n]);break;case"cart":e.pageMeta.setData("page.cart.products",e.getObjectPath(t,"cartRecords",[]));break;case"checkout":e.pageMeta.setData("page.checkout.products",e.getObjectPath(t,"orderItems",[]))}},updateFromV2:function(t){e.pageMeta.setData("page",e.extend(!0,e.pageMeta.getData("page",{}),e.getObjectPath(t,"page",{}))),e.pageMeta.setData("system",e.extend(!0,e.pageMeta.getData("system",{}),e.getObjectPath(t,"system",{})))},getAllSettings:function(){return e.pageMeta.settings},getOldSettings:function(){return e.pageMeta.oldSettings},hasData:function(t){return!!e.getObjectPath(e.pageMeta.settings,t,!1)},getData:function(t,n){return e.isUndefined(n)&&(n=!1),e.getObjectPath(e.pageMeta.settings,t,n)},setData:function(t,n){return e.setObjectPath(e.pageMeta.oldSettings,t,e.getObjectPath(e.pageMeta.settings,t)),e.setObjectPath(e.pageMeta.settings,t,n),e.pageMeta.settings},hasPageType:function(){return e.pageMeta.hasData("page.pageType",!1)},getPageType:function(){return e.pageMeta.getData("page.pageType",!1)},getApiKey:function(){return e.getGlobalSetting("global.apiKey",e.getGlobalSetting("search.apiKey",e.getGlobalSetting("analytics.apiKey")))},getUserProfile:function(){return e.pageMeta.getData("user",!1)},getItems:function(t){return e.isUndefined(t)&&(t=e.pageMeta.getPageType()),e.pageMeta.hasData("page."+t+".products")?e.pageMeta.getData("page."+t+".products",[]):[]},hasItems:function(t){e.isUndefined(t)&&(t=e.pageMeta.getPageType());let n=e.pageMeta.getItems(t);return!!(!e.isUndefined(n)&&e.isArrayLike(n)&&n.length>0)},update:function(t,n){if(e.isUndefined(n)&&(n=2),2===n)e.pageMeta.updateFromV2(t);else e.pageMeta.updateFromV1(t);var s={settings:e.pageMeta.getAllSettings(),oldSettings:e.pageMeta.getOldSettings()},a=e.pageMeta.chains.events;return e.isUndefined(a)||0===a.list().length||(a.setScope(this),a.setData(s),a.fire()),e.pageMeta.getAllSettings()},send:function(){var t={settings:e.pageMeta.getAllSettings(),oldSettings:e.pageMeta.getOldSettings()},n=e.pageMeta.chains.send;e.isUndefined(n)||0===n.list().length||(n.setScope(this),n.setData(t),n.fire())},chains:{send:e.chain({stopOnFalse:!0}),events:e.chain({stopOnFalse:!0})}})),e.support.register({name:"pageMeta",loaded:!0,active:!0,dependency:["core.lib"]}),e.pageMeta.chains.events.add({name:"checkCheckout",fire:function(t,n){if("checkout"===e.pageMeta.getPageType()&&e.pageMeta.hasItems()){var s={payload:{event_version:"1.0.0",event:"order_purchase",event_apikey:e.pageMeta.getApiKey(),user_profile:e.pageMeta.getUserProfile(),event_data:{items:e.pageMeta.getItems()}},type:"collect",url:e.getGlobalSetting("url.analyticsCollect",!1),key:"checkout_order_"+e.randomId(),override:!0};window._klvAnalyticsCollect=window._klvAnalyticsCollect||[],window._klvAnalyticsCollect.push(s)}}}),e.settings.chains.initChain.add({name:"pageMetaBuild",fire:function(t,n){var s=e.getGlobalSetting("powerUp.pageMeta");!e.isUndefined(s)&&!1===s||!e.isInteractive&&e.isUndefined(window.klevu_page_meta)||e.getObjectPath(t,"flags.pageMeta.build",!1)||(e.setObjectPath(t,"flags.pageMeta.build",!0),e.pageMeta.build())}})}(klevu),function(e){e.extend({analyticsEvents:{}}),e.extend(!0,e.analyticsEvents,{term:function(t,n){e.settings.console.type.event&&e.logDebug("Event - Analytics - Term"),e.isEmptyObject(n)&&(n=e.analytics.base);var s=n.getScope();return s.data=n.resetData(),s.data.context.eventAction="term",e.isUndefined(t.callbacks)?(s.data.request.analytics=t,s.data.context.callbacks=!1):(s.data.request.analytics=t.toSend.payload,s.data.context.callbacks=t.callbacks),s.data.context.preventDefault=!1,e.event.fireChain(s,"chains.events.term",s.element,s.data,null),n},click:function(t,n){e.settings.console.type.event&&e.logDebug("Event - Analytics - Click"),e.isEmptyObject(n)&&(n=e.analytics.base);var s=n.getScope();return s.data=n.resetData(),s.data.context.eventAction="click",e.isUndefined(t.callbacks)?(s.data.request.analytics=t,s.data.context.callbacks=!1):(s.data.request.analytics=t.toSend.payload,s.data.context.callbacks=t.callbacks),s.data.request.analytics.klevu_type="clicked",s.data.context.preventDefault=!1,e.event.fireChain(s,"chains.events.click",s.element,s.data,null),n},buy:function(t,n){e.settings.console.type.event&&e.logDebug("Event - Analytics - Buy"),e.isEmptyObject(n)&&(n=e.analytics.base);var s=n.getScope();return s.data=n.resetData(),s.data.context.eventAction="buy",e.isUndefined(t.callbacks)?(s.data.request.analytics=t,s.data.context.callbacks=!1):(s.data.request.analytics=t.toSend.payload,s.data.context.callbacks=t.callbacks),s.data.request.analytics.klevu_type="checkout",s.data.context.preventDefault=!1,e.event.fireChain(s,"chains.events.buy",s.element,s.data,null),n},catclick:function(t,n){e.settings.console.type.event&&e.logDebug("Event - Analytics - Category Click"),e.isEmptyObject(n)&&(n=e.analytics.base);var s=n.getScope();return s.data=n.resetData(),s.data.context.eventAction="catclick",e.isUndefined(t.callbacks)?(s.data.request.analytics=t,s.data.context.callbacks=!1):(s.data.request.analytics=t.toSend.payload,s.data.context.callbacks=t.callbacks),s.data.context.preventDefault=!1,e.event.fireChain(s,"chains.events.catclick",s.element,s.data,null),n},catview:function(t,n){e.settings.console.type.event&&e.logDebug("Event - Analytics - Category View"),e.isEmptyObject(n)&&(n=e.analytics.base);var s=n.getScope();return s.data=n.resetData(),s.data.context.eventAction="catview",e.isUndefined(t.callbacks)?(s.data.request.analytics=t,s.data.context.callbacks=!1):(s.data.request.analytics=t.toSend.payload,s.data.context.callbacks=t.callbacks),s.data.context.preventDefault=!1,e.event.fireChain(s,"chains.events.catview",s.element,s.data,null),n},collect:function(t){e.settings.console.type.event&&e.logDebug("Event - Analytics - Collection");var n=e.analytics.base,s=n.getScope();return s.data=n.resetData(),s.data.context.eventAction="collect",s.data.request.collect=t.toSend.payload,s.data.context.collectStorage=t.toSend,s.data.context.preventDefault=!1,e.isUndefined(t.callbacks)?s.data.context.callbacks=!1:s.data.context.callbacks=t.callbacks,e.event.fireChain(s,"chains.events.collect",s.element,s.data,null),n}}),e.extend({analyticsObjectBuild:function(){var t={settings:{}};function n(e){t.element=document.createElement("input"),t.element.kObject=e,t.element.kScope=t,t.element.kElem=t.element}function s(){return{context:{event:null,eventAction:"",preventDefault:!1,status:null,isSuccess:!1,doRequest:!0},request:{analytics:{}},response:{ajax:{object:{},data:{}},current:{}},scope:{}}}e.setObjectPath(t,"id",e.randomId()),e.setObjectPath(t,"chains.actions.doAnalytics",e.chain({stopOnFalse:!0})),e.setObjectPath(t,"chains.actions.finalise",e.chain({stopOnFalse:!0})),e.setObjectPath(t,"chains.events.term",e.chain({stopOnFalse:!0})),e.setObjectPath(t,"chains.events.click",e.chain({stopOnFalse:!0})),e.setObjectPath(t,"chains.events.buy",e.chain({stopOnFalse:!0})),e.setObjectPath(t,"chains.events.catview",e.chain({stopOnFalse:!0})),e.setObjectPath(t,"chains.events.catclick",e.chain({stopOnFalse:!0})),e.setObjectPath(t,"chains.events.collect",e.chain({stopOnFalse:!0})),e.setObjectPath(t,"chains.request.control",e.chain({stopOnFalse:!0})),e.setObjectPath(t,"chains.request.build",e.chain({stopOnFalse:!0})),e.setObjectPath(t,"chains.request.send",e.chain({stopOnFalse:!0})),e.setObjectPath(t,"chains.request.ajax.send",e.chain({stopOnFalse:!0})),e.setObjectPath(t,"chains.request.fetch.send",e.chain({stopOnFalse:!0})),e.setObjectPath(t,"chains.response.ajax.success",e.chain({stopOnFalse:!0})),e.setObjectPath(t,"chains.response.ajax.done",e.chain({stopOnFalse:!0})),e.setObjectPath(t,"chains.response.ajax.fail",e.chain({stopOnFalse:!0})),e.setObjectPath(t,"chains.response.success",e.chain({stopOnFalse:!0})),e.setObjectPath(t,"chains.response.done",e.chain({stopOnFalse:!0})),e.setObjectPath(t,"chains.response.fail",e.chain({stopOnFalse:!0})),t.data={context:{event:null,eventAction:"",preventDefault:!1,status:null,isSuccess:!1,doRequest:!0},request:{analytics:{}},response:{ajax:{object:{},data:{}},current:{}},scope:{}};var a={init:n,resetData:function(){var e=s();return t.data.context=e.context,t.data.request=e.request,t.data.response=e.response,t.data.scope=null,t.data},buildData:s,setScope:function(e){return t=e},getScope:function(){return t}};return n(a),a}});var t={analytics:{url:{term:"n-search/search",click:"productTracking",buy:"productTracking",catclick:"categoryProductClickTracking",catview:"categoryProductViewTracking",collect:"collect"}},url:{analytics:e.settings.url.protocol+"//stats.klevu.com/analytics/",analyticsCat:e.settings.url.protocol+"//stats.ksearchnet.com/analytics/",analyticsCollect:e.settings.url.protocol+"//stats.ksearchnet.com/analytics/"}};e(t),function(e){e.extend(!0,e,{analyticsUtil:{base:{storage:{dictionary:"analytics-util",term:"termList",click:"clickList",categoryClick:"categoryClickList",collect:"analyticsEvents"},sendAnalyticsEventsFromStorage:function(t,n){var s=e.dictionary(t);s.setStorage("local"),s.mergeFromGlobal();var a=s.getElement(n);a&&a!=n&&(a=JSON.parse(a),e.each(a,(function(t,s){delete s.filters,n==e.analyticsUtil.base.storage.click?e.analyticsEvents.click(s):n==e.analyticsUtil.base.storage.categoryClick||e.analyticsEvents.term(s)})),s.addElement(n,""),s.mergeToGlobal())}}}})}(e)}(klevu),function(e){e.support.hook(["core.constructors"],(function(){e.constructors.isLoaded("analytics.collect")||(e.constructors.add({name:"analytics.collect",create:function(){let t={general:{apiKey:!1,scope:document.createElement("div"),flags:{build:!1,init:!1},dictionary:{collect:"analyticsEvents"},supportedTypes:[]}},n={getDictionary:function(e){return this.getSetting("general.dictionary."+e,"analyticsEvents")},getDictionaryData:function(t,n){e.isUndefined(n)&&(n=e.getGlobalSetting("core.dictionary.defaultStorageType","local"));let s=e.dictionary(t);return s.setStorage(n),s.mergeFromGlobal(),s},chains:e.constructors.get("analytics.collect").chains,addSupportedType:function(t){let n=this.getSetting("general.supportedTypes",[]);n.push(t.name),this.setSetting("general.supportedTypes",n);let s=e.getObjectPath(this,"chains.sendType");e.isUndefined(s)||s.add({name:"send"+t.name,fire:t.fire})},sendAnalyticsEventsFromStorage:function(t){var n=this;e.isUndefined(t)&&(t=this.getDictionary("collect"));var s=this.getDictionaryData(t),a=s.getElements();e.each(a,(function(a,i){if(s.mergeFromGlobal(),i=s.getElement(a),i=JSON.parse(i),void 0!==e.getObjectPath(i,"type")){if("timestamp"in i)if(e.time.timestamp()-parseInt(i.timestamp)>e.getGlobalSetting("analytics.maxRetryTime",21600))return void n.removeAnalyticsEventsFromStorage(t,a);if(n.getSetting("general.supportedTypes",[]).includes(e.getObjectPath(i,"type"))){if("pending"===e.getObjectPath(i,"status","new")){if(e.time.timestamp()-e.getObjectPath(i,"statusTime",e.time.timestamp())<e.getGlobalSetting("analytics.maxStatusLockTime",30))return;n.changeAnalyticsEventsStatus(t,a,"new",!0)}n.changeAnalyticsEventsStatus(t,a,"pending");var o={value:i,dictionary:t,key:a},c=e.getObjectPath(n,"chains.sendType");e.isUndefined(c)||0===c.list().length||(c.setScope(n),c.setData(o),c.fire())}}else n.removeAnalyticsEventsFromStorage(t,a)}))},removeAnalyticsEventsFromStorage:function(t,n){var s=e.analytics.utility.getDictionaryData(t);s.removeElement(n),s.overrideGlobal()},addAnalyticsEventsToStorage:function(t){var n=e.isUndefined(t.dictionary)?this.getDictionary("collect"):t.dictionary,s=this.getDictionaryData(n);if(t.timestamp=e.time.timestamp(),s.getElement(t.key)===t.key)e.isUndefined(t.status)&&(t.status="new"),s.addElement(t.key,JSON.stringify(t));else if(!e.isUndefined(t.override)&&t.override){var a=s.getElement(t.key);a=JSON.parse(a),!e.isUndefined(t.forced)&&t.forced?(e.isUndefined(t.status)&&(t.status="new"),s.addElement(t.key,JSON.stringify(t))):"new"===e.getObjectPath(a,"status","new")?s.addElement(t.key,JSON.stringify(t)):(e.isUndefined(t.status)&&(t.status="new"),s.addElement(t.key+e.time.timestamp(),JSON.stringify(t)))}s.mergeToGlobal()},changeAnalyticsEventsStatus:function(t,n,s,a){t=e.isUndefined(t)?this.getDictionary("collect"):t;e.isUndefined(a)&&(a=!1);var i=this.getDictionaryData(t).getElement(n);(i=JSON.parse(i)).status=s,i.statusTime=e.time.timestamp(),i.key=n,i.override=!0,a&&(i.forced=a),this.addAnalyticsEventsToStorage(i)},hasAnalyticsEventByName:function(t,n){return n=e.isUndefined(n)?this.getDictionary("collect"):n,t!==this.getDictionaryData(n).getElement(t)},getAnalyticsEventByName:function(t,n){n=e.isUndefined(n)?this.getDictionary("collect"):n;let s=this.getDictionaryData(n).getElement(t);return t!==s?JSON.parse(s):{}},setWebhookSettings:function(t){return e.event.webhook.helpers.setWebhookSettingsForScope(t,this),this},getWebhookSettings:function(){return e.event.webhook.helpers.getWebhookSettingsForScope(this)},setApiKey:function(t){if(this.setSetting("general.apiKey",t),!this.getSetting("general.flags.init",!1)){let t=this.chains.init;e.isUndefined(t)||0===t.list().length||(t.setScope(this),t.setData(this.getAllSettings()),t.fire())}return this},getApiKey:function(){return this.getSetting("general.apiKey")},hasSetting:function(n){return!!e.getObjectPath(t,n,!1)},getSetting:function(n,s){return e.isUndefined(s)&&(s=!1),e.getObjectPath(t,n,s)},setSetting:function(n,s){return e.setObjectPath(t,n,s),this},getAllSettings:function(){return t},webhookSettings:{run:!0,object:"analytics",scope:"collect"}},s=n.chains.build;return e.isUndefined(s)||0===s.list().length||(s.setScope(n),s.setData(n.getAllSettings()),s.fire()),n},chains:{build:e.chain({stopOnFalse:!0,webhook:{name:"chains.build"}}),init:e.chain({stopOnFalse:!0,webhook:{name:"chains.init"}}),sendType:e.chain({stopOnFalse:!0,webhook:{name:"chains.sendType"}}),analyticsClick:e.chain({stopOnFalse:!0,webhook:{name:"chains.analyticsClick"}}),prodBuy:e.chain({stopOnFalse:!0,webhook:{name:"chains.prodBuy"}}),prodClick:e.chain({stopOnFalse:!0,webhook:{name:"chains.prodClick"}}),prodView:e.chain({stopOnFalse:!0,webhook:{name:"chains.prodView"}}),catClick:e.chain({stopOnFalse:!0,webhook:{name:"chains.catClick"}}),catView:e.chain({stopOnFalse:!0,webhook:{name:"chains.catView"}}),recsClick:e.chain({stopOnFalse:!0,webhook:{name:"chains.recsClick"}}),recsView:e.chain({stopOnFalse:!0,webhook:{name:"chains.recsView"}})}}),e.constructors.get("analytics.collect").chains.build.add({name:"beforeBuild",fire:function(t,n){e.event.webhook.helpers.fireEventForScope({webhookSettings:n.webhookSettings,name:"mainObject",action:"beforeBuild",data:n.getAllSettings(),scope:n})}}),e.constructors.get("analytics.collect").chains.build.add({name:"setBuildFlag",fire:function(e,t){t.setSetting("general.flags.build",!0)}}),e.constructors.get("analytics.collect").chains.build.add({name:"beforeBuild",fire:function(t,n){e.event.webhook.helpers.fireEventForScope({webhookSettings:n.webhookSettings,name:"mainObject",action:"afterBuild",data:n.getAllSettings(),scope:n})}}),e.constructors.get("analytics.collect").chains.init.add({name:"addCollectSupportedType",fire:function(t,n){n.addSupportedType({name:"collect",fire:function(t,n){if("collect"===t.value.type){var s=[];s.push({fire:n.removeAnalyticsEventsFromStorage,params:[t.dictionary,t.key]}),e.analyticsEvents.collect({toSend:t.value,callbacks:s})}}})}}),e.constructors.get("analytics.collect").chains.init.add({name:"addTermSupportedType",fire:function(t,n){n.addSupportedType({name:"search_term",fire:function(t,n){if("search_term"===t.value.type){var s=[];s.push({fire:n.removeAnalyticsEventsFromStorage,params:[t.dictionary,t.key]}),e.analyticsEvents.term({toSend:t.value,callbacks:s})}}})}}),e.constructors.get("analytics.collect").chains.init.add({name:"addSearchClickSupportedType",fire:function(t,n){n.addSupportedType({name:"search_product_click",fire:function(t,n){if("search_product_click"===t.value.type){var s=[];s.push({fire:n.removeAnalyticsEventsFromStorage,params:[t.dictionary,t.key]}),e.analyticsEvents.click({toSend:t.value,callbacks:s})}}})}}),e.constructors.get("analytics.collect").chains.init.add({name:"addSeachBuySupportedType",fire:function(t,n){n.addSupportedType({name:"search_product_buy",fire:function(t,n){if("search_product_buy"===t.value.type){var s=[];s.push({fire:n.removeAnalyticsEventsFromStorage,params:[t.dictionary,t.key]}),e.analyticsEvents.buy({toSend:t.value,callbacks:s})}}})}}),e.constructors.get("analytics.collect").chains.init.add({name:"addCatnavClickSupportedType",fire:function(t,n){n.addSupportedType({name:"catnav_product_click",fire:function(t,n){if("catnav_product_click"===t.value.type){var s=[];s.push({fire:n.removeAnalyticsEventsFromStorage,params:[t.dictionary,t.key]}),e.analyticsEvents.catclick({toSend:t.value,callbacks:s})}}})}}),e.constructors.get("analytics.collect").chains.init.add({name:"addCatnavViewSupportedType",fire:function(t,n){n.addSupportedType({name:"catnav_view",fire:function(t,n){if("catnav_view"===t.value.type){var s=[];s.push({fire:n.removeAnalyticsEventsFromStorage,params:[t.dictionary,t.key]}),e.analyticsEvents.catview({toSend:t.value,callbacks:s})}}})}}),e.constructors.get("analytics.collect").chains.init.add({name:"initGlobalCollector",fire:function(t,n){let s=n.getSetting("general.apiKey",!1);e.isUndefined(s)||!1===s||(e.event.eventList.build({name:"_klvAnalyticsCollect",global:!0}),_klvAnalyticsCollect.chain.add({name:"moveToEvents",fire:function(t,n){if(t.element.length>0){var s=[];e.each(t.element,(function(t,n){var a={type:e.getObjectPath(n,"type","custom"),url:e.getObjectPath(n,"url",!1),apiKey:e.getObjectPath(n,"apiKey",e.getGlobalSetting("analytics.apiKey",e.getGlobalSetting("global.apiKey",!1))),key:e.getObjectPath(n,"key","customEvent-"+e.randomId()),override:e.getObjectPath(n,"override",!0),payload:e.getObjectPath(n,"payload",{})};a.payload.apiKey=e.getObjectPath(n,"payload.apiKey",e.getGlobalSetting("analytics.apiKey",e.getGlobalSetting("global.apiKey",!1))),e.analytics.utility.addAnalyticsEventsToStorage(a),s.push(n)})),s.length>0&&(e.each(s,(function(e,n){t.element.remove(n)})),e.analytics.utility.sendAnalyticsEventsFromStorage())}}}),_klvAnalyticsCollect.run())}}),e.constructors.get("analytics.collect").chains.init.add({name:"sendStoredEvents",fire:function(e,t){t.sendAnalyticsEventsFromStorage("analyticsEvents")}}),e.constructors.get("analytics.collect").chains.init.add({name:"setInitFlag",fire:function(e,t){t.setSetting("general.flags.init",!0)}}))})),e.support.hook(["analytics.utility"],(function(){e.settings.chains.initChain.add({name:"analyticsCollect",fire:function(t,n){var s=e.getGlobalSetting("analytics.apiKey",e.getGlobalSetting("search.apiKey",e.getGlobalSetting("global.apiKey")));if(!e.isUndefined(s)){var a=e.getGlobalSetting("powerUp.analyticsCollect");if(!e.isUndefined(a)&&!1===a)return;if(e.getObjectPath(t,"flags.analyticsCollect.build",!1))return;if(e.isUndefined(e.analytics)||e.isUndefined(e.analytics.build)||e.isUndefined(e.analytics.utility))return;e.setObjectPath(t,"flags.analyticsCollect.build",!0),e.analytics.utility.setApiKey(s)}}})})),e.support.isActive("analytics.utility")||(e.extend(!0,e,{analytics:{utility:e.constructors.construct("analytics.collect")}}),e.support.register({name:"analytics.utility",loaded:!0,active:!0,dependency:["core.constructors","core.lib"]}))}(klevu),function(e){var t=e.analyticsObjectBuild();t.getScope().chains.events.term.add({name:"termRequestCheck",fire:function(t,n){e.clean(t.request.analytics);var s=t.request.analytics;try{var a=!1,i="";if(e.isUndefined(s.klevu_term)?(a=!0,i="klevu_term"):e.isUndefined(s.klevu_totalResults)?(a=!0,i="klevu_totalResults"):e.isUndefined(s.klevu_typeOfQuery)&&(a=!0,i="klevu_typeOfQuery"),a)throw new Error(i+" parameter is missing from the term analytics request!")}catch(t){return e.settings.console.type.event&&(e.logError("chains.events.term - termRequestCheck - check paramaters."),e.logError("chains.events.term - termRequestCheck - error:"),e.logError(t)),!1}}}),t.getScope().chains.events.term.add({name:"generateURL",fire:function(t,n){var s=e.getSetting(n.kScope.settings,"settings.url.analytics",!1);if(!s)return!1;t.context.url=s+e.getSetting(n.kScope.settings,"settings.analytics.url.term",!1)}}),t.getScope().chains.events.term.add({name:"addApiKey",fire:function(t,n){t.request.analytics.klevu_apiKey=e.getSetting(n.kScope.settings,"settings.analytics.apiKey",e.getGlobalSetting("analytics.apiKey",e.getGlobalSetting("global.apiKey")))}}),t.getScope().chains.events.term.add({name:"doAnalytics",fire:function(t,n){var s=e.getObjectPath(n.kScope,"chains.actions.doAnalytics");if(e.isUndefined(s)||0===s.list().length||(s.setScope(n.kElem),s.setData(t),s.fire()),n.kScope.data=t,!0===t.context.preventDefault)return!1}}),t.getScope().chains.events.click.add({name:"clickRequestCheck",fire:function(t,n){e.clean(t.request.analytics);var s=t.request.analytics;try{var a=!1,i="";if(e.isUndefined(s.klevu_keywords)?(a=!0,i="klevu_keywords"):e.isUndefined(s.klevu_productId)?(a=!0,i="klevu_productId"):e.isUndefined(s.klevu_productName)?(a=!0,i="klevu_productName"):e.isUndefined(s.klevu_productUrl)&&(a=!0,i="klevu_productUrl"),a)throw new Error(i+" parameter is missing from the click analytics request!")}catch(t){return e.settings.console.type.event&&(e.logError("chains.events.click - clickRequestCheck - check paramaters."),e.logError("chains.events.click - clickRequestCheck - error:"),e.logError(t)),!1}}}),t.getScope().chains.events.click.add({name:"generateURL",fire:function(t,n){var s=e.getSetting(n.kScope.settings,"settings.url.analytics",!1);if(!s)return!1;t.context.url=s+e.getSetting(n.kScope.settings,"settings.analytics.url.click",!1)}}),t.getScope().chains.events.click.add({name:"addApiKey",fire:function(t,n){t.request.analytics.klevu_apiKey=e.getSetting(n.kScope.settings,"settings.analytics.apiKey",e.getGlobalSetting("analytics.apiKey",e.getGlobalSetting("global.apiKey")))}}),t.getScope().chains.events.click.add({name:"doAnalytics",fire:function(t,n){var s=e.getObjectPath(n.kScope,"chains.actions.doAnalytics");if(e.isUndefined(s)||0===s.list().length||(s.setScope(n.kElem),s.setData(t),s.fire()),n.kScope.data=t,!0===t.context.preventDefault)return!1}}),t.getScope().chains.events.buy.add({name:"buyRequestCheck",fire:function(t,n){e.clean(t.request.analytics);var s=t.request.analytics;try{var a=!1,i="";if(e.isUndefined(s.klevu_productId)?(a=!0,i="klevu_productId"):e.isUndefined(s.klevu_unit)?(a=!0,i="klevu_unit"):e.isUndefined(s.klevu_salePrice)?(a=!0,i="klevu_salePrice"):e.isUndefined(s.klevu_currency)&&(a=!0,i="klevu_currency"),a)throw new Error(i+" parameter is missing from the buy analytics request!")}catch(t){return e.settings.console.type.event&&(e.logError("chains.events.buy - buyRequestCheck - check paramaters."),e.logError("chains.events.buy - buyRequestCheck - error:"),e.logError(t)),!1}}}),t.getScope().chains.events.buy.add({name:"generateURL",fire:function(t,n){var s=e.getSetting(n.kScope.settings,"settings.url.analytics",!1);if(!s)return!1;t.context.url=s+e.getSetting(n.kScope.settings,"settings.analytics.url.buy",!1)}}),t.getScope().chains.events.buy.add({name:"addApiKey",fire:function(t,n){t.request.analytics.klevu_apiKey=e.getSetting(n.kScope.settings,"settings.analytics.apiKey",e.getGlobalSetting("analytics.apiKey",e.getGlobalSetting("global.apiKey")))}}),t.getScope().chains.events.buy.add({name:"doAnalytics",fire:function(t,n){var s=e.getObjectPath(n.kScope,"chains.actions.doAnalytics");if(e.isUndefined(s)||0===s.list().length||(s.setScope(n.kElem),s.setData(t),s.fire()),n.kScope.data=t,!0===t.context.preventDefault)return!1}}),t.getScope().chains.events.catclick.add({name:"clickRequestCheck",fire:function(t,n){e.clean(t.request.analytics);var s=t.request.analytics;try{var a=!1,i="";if(e.isUndefined(s.klevu_categoryName)?(a=!0,i="klevu_categoryName"):e.isUndefined(s.klevu_categoryPath)?(a=!0,i="klevu_categoryPath"):e.isUndefined(s.klevu_productId)?(a=!0,i="klevu_productId"):e.isUndefined(s.klevu_productName)?(a=!0,i="klevu_productName"):e.isUndefined(s.klevu_productUrl)&&(a=!0,i="klevu_productUrl"),a)throw new Error(i+" parameter is missing from the click analytics request!")}catch(t){return e.settings.console.type.event&&(e.logError("chains.events.catclick - clickRequestCheck - check paramaters."),e.logError("chains.events.catclick - clickRequestCheck - error:"),e.logError(t)),!1}}}),t.getScope().chains.events.catclick.add({name:"generateURL",fire:function(t,n){var s=e.getSetting(n.kScope.settings,"settings.url.analyticsCat",!1);if(!s)return!1;t.context.url=s+e.getSetting(n.kScope.settings,"settings.analytics.url.catclick",!1)}}),t.getScope().chains.events.catclick.add({name:"addApiKey",fire:function(t,n){t.request.analytics.klevu_apiKey=e.getSetting(n.kScope.settings,"settings.analytics.apiKey",e.getGlobalSetting("analytics.apiKey",e.getGlobalSetting("global.apiKey")))}}),t.getScope().chains.events.catclick.add({name:"doAnalytics",fire:function(t,n){var s=e.getObjectPath(n.kScope,"chains.actions.doAnalytics");if(e.isUndefined(s)||0===s.list().length||(s.setScope(n.kElem),s.setData(t),s.fire()),n.kScope.data=t,!0===t.context.preventDefault)return!1}}),t.getScope().chains.events.catview.add({name:"viewRequestCheck",fire:function(t,n){e.clean(t.request.analytics);var s=t.request.analytics;try{var a=!1,i="";if(e.isUndefined(s.klevu_categoryName)?(a=!0,i="klevu_categoryName"):e.isUndefined(s.klevu_categoryPath)?(a=!0,i="klevu_categoryPath"):e.isUndefined(s.klevu_productIds)&&(a=!0,i="klevu_productIds"),a)throw new Error(i+" parameter is missing from the term analytics request!")}catch(t){return e.settings.console.type.event&&(e.logError("chains.events.catview - viewRequestCheck - check paramaters."),e.logError("chains.events.catview - viewRequestCheck - error:"),e.logError(t)),!1}}}),t.getScope().chains.events.catview.add({name:"generateURL",fire:function(t,n){var s=e.getSetting(n.kScope.settings,"settings.url.analyticsCat",!1);if(!s)return!1;t.context.url=s+e.getSetting(n.kScope.settings,"settings.analytics.url.catview",!1)}}),t.getScope().chains.events.catview.add({name:"addApiKey",fire:function(t,n){t.request.analytics.klevu_apiKey=e.getSetting(n.kScope.settings,"settings.analytics.apiKey",e.getGlobalSetting("analytics.apiKey",e.getGlobalSetting("global.apiKey")))}}),t.getScope().chains.events.catview.add({name:"doAnalytics",fire:function(t,n){var s=e.getObjectPath(n.kScope,"chains.actions.doAnalytics");if(e.isUndefined(s)||0===s.list().length||(s.setScope(n.kElem),s.setData(t),s.fire()),n.kScope.data=t,!0===t.context.preventDefault)return!1}}),t.getScope().chains.events.collect.add({name:"collectRequestClean",fire:function(t,n){e.clean(t.request.collect)}}),t.getScope().chains.events.collect.add({name:"generateURL",fire:function(t,n){if(e.getObjectPath(n.kScope,"data.context.collectStorage.url",!1))t.context.url=e.getObjectPath(n.kScope,"data.context.collectStorage.url")+e.getSetting(n.kScope.settings,"settings.analytics.url.collect",!1);else{var s=e.getSetting(n.kScope.settings,"settings.url.analyticsCollect",!1);if(!s)return!1;t.context.url=s+e.getSetting(n.kScope.settings,"settings.analytics.url.collect",!1)}}}),t.getScope().chains.events.collect.add({name:"doAnalytics",fire:function(t,n){var s=e.getObjectPath(n.kScope,"chains.actions.doAnalytics");if(e.isUndefined(s)||0===s.list().length||(s.setScope(n.kElem),s.setData(t),s.fire()),n.kScope.data=t,!0===t.context.preventDefault)return!1}}),t.getScope().chains.actions.doAnalytics.add({name:"doRequest",fire:function(t,n){t.context.doRequest=!1;var s=e.getObjectPath(n.kScope,"chains.request.control");if(e.isUndefined(s)||0===s.list().length)return t.context.preventDefault=!0,n.kScope.data=t,!1;s.setScope(n.kElem),s.setData(t),s.fire(),n.kScope.data=t}}),t.getScope().chains.request.ajax.send.add({name:"sendRequest",fire:function(t,n){"analyticsAjaxV1"===t.context.eventAction&&(t.scope=n,t.context.doRequest?e.ajax(t.context.url,{method:"GET",data:e.queryString(t.request.analytics),dataType:"xml",crossDomain:!0,success:function(t){var n=e.getObjectPath(t.requestDetails.scope.kScope,"chains.response.ajax.success");e.isUndefined(n)||0===n.list().length||(n.setScope(t.requestDetails.scope.kElem),t.requestDetails.response.ajax.object=t,t.requestDetails.response.ajax.data=t.responseObj.data,t.requestDetails.context.status=t.status,t.requestDetails.context.isSuccess=t.isSuccess,n.setData(t.requestDetails),n.fire())},done:function(t){var n=e.getObjectPath(t.requestDetails.scope.kScope,"chains.response.ajax.done");e.isUndefined(n)||0===n.list().length||(n.setScope(t.requestDetails.scope.kElem),t.requestDetails.response.ajax.object=t,t.requestDetails.response.ajax.data=t.responseObj.data,t.requestDetails.context.status=t.status,t.requestDetails.context.isSuccess=t.isSuccess,n.setData(t.requestDetails),n.fire())},error:function(t){var n=e.getObjectPath(t.requestDetails.scope.kScope,"chains.response.ajax.fail");e.isUndefined(n)||0===n.list().length||(n.setScope(t.requestDetails.scope.kElem),t.requestDetails.response.ajax.object=t,t.requestDetails.response.ajax.data={},t.requestDetails.context.status=t.status,t.requestDetails.context.isSuccess=t.isSuccess,n.setData(t.requestDetails),n.fire())},requestDetails:t}):e.settings.console.type.ajax&&(e.logError("chains.request.ajax.send - sendRequest - Request object is not present or request was forced stopped."),e.logDebug("chains.request.ajax.send - sendRequest - Data:"),e.logDebug(t)))}}),t.getScope().chains.request.fetch.send.add({name:"sendRequest",fire:function(t,n){"analyticsFetchV1"===t.context.eventAction&&(t.scope=n,t.context.requestObject={url:t.context.url,type:"FETCH",method:"POST",mimeType:"application/json; charset=UTF-8",contentType:"application/json; charset=utf-8",crossDomain:!0,success:function(t,n,s,a){var i=e.getObjectPath(n.scope.kScope,"chains.response.success");e.isUndefined(i)||0===i.list().length||(i.setScope(n.scope.kElem),e.setObjectPath(n,"response.data",t),e.setObjectPath(n,"context.status",s),e.setObjectPath(n,"context.isSuccess",a),i.setData(n),i.fire())},error:function(t,n,s){var a=e.getObjectPath(t.scope.kScope,"chains.response.fail");e.isUndefined(a)||0===a.list().length||(a.setScope(t.scope.kElem),e.setObjectPath(t,"response.data",{}),e.setObjectPath(t,"context.status",n),e.setObjectPath(t,"context.isSuccess",s),a.setData(t),a.fire())},data:"["+JSON.stringify(t.request.collect)+"]"},t.context.requestDetails=e.extend(!0,{},t))}}),t.getScope().chains.request.control.add({name:"initRequest",fire:function(t,n){t.context.doRequest=!1;var s=e.getObjectPath(n.kScope,"chains.request.build");return e.isUndefined(s)||0===s.list().length?(t.context.preventDefault=!0,n.kScope.data=t,!1):(s.setScope(n.kElem),s.setData(t),s.fire(),n.kScope.data=t,!1!==t.context.doRequest&&void 0)}}),t.getScope().chains.request.control.add({name:"makeRequest",fire:function(t,n){var s=e.getObjectPath(n.kScope,"chains.request.send");if(!e.isUndefined(s)&&0!==s.list().length)return s.setScope(n.kElem),s.setData(t),s.fire(),n.kScope.data=t,!1}}),t.getScope().chains.request.build.add({name:"buildMap",fire:function(e,t){e.context.status=null,e.context.isSuccess=!1,e.context.doRequest=!0}}),t.getScope().chains.request.send.add({name:"requestTypeAjaxV1",fire:function(e,t){"term"!==e.context.eventAction&&"click"!==e.context.eventAction&&"buy"!==e.context.eventAction&&"catclick"!==e.context.eventAction&&"catview"!==e.context.eventAction||(e.context.eventAction="analyticsAjaxV1")}}),t.getScope().chains.request.send.add({name:"requestTypeFetchV1",fire:function(e,t){"collect"===e.context.eventAction&&(e.context.eventAction="analyticsFetchV1")}}),t.getScope().chains.request.send.addAfter("requestTypeAjaxV1",{name:"requestEncodeAjaxV1",fire:function(e,t){if("analyticsAjaxV1"===e.context.eventAction){var n=e.request.analytics.klevu_term;n&&(e.request.analytics.klevu_term=encodeURIComponent(n));var s=e.request.analytics.klevu_keywords;s&&(e.request.analytics.klevu_keywords=encodeURIComponent(s))}}}),t.getScope().chains.request.send.add({name:"requestTypeAjaxSendV1",fire:function(t,n){if("analyticsAjaxV1"===t.context.eventAction){var s=e.getObjectPath(n.kScope,"chains.request.ajax.send");if(!e.isUndefined(s)&&0!==s.list().length)return s.setScope(n.kElem),s.setData(t),s.fire(),n.kScope.data=t,!1}}}),t.getScope().chains.request.send.add({name:"requestTypeFetchSendV1",fire:function(t,n){if("analyticsFetchV1"===t.context.eventAction){var s=e.getObjectPath(n.kScope,"chains.request.fetch.send");e.isUndefined(s)||0===s.list().length||(s.setScope(n.kElem),s.setData(t),s.fire(),n.kScope.data=t)}}}),t.getScope().chains.request.send.add({name:"requestSend",fire:function(t,n){"analyticsFetchV1"===t.context.eventAction&&e.request(t.context.requestObject,t.context.requestDetails)}}),t.getScope().chains.response.ajax.success.add({name:"checkForSuccess",fire:function(t,n){if(n.kScope.data=t,!1===t.context.isSuccess)return e.settings.console.type.ajax&&(e.logError("chains.response.ajax.success - checkForSuccess - Request was not successful."),e.logDebug("chains.response.ajax.success - checkForSuccess - success:"),e.logDebug(t)),!1;t.response.current=t.response.ajax.data,e.settings.console.type.ajax&&(e.logError("chains.response.ajax.success - checkForSuccess - Request was successful."),e.logDebug("chains.response.ajax.success - checkForSuccess - success:"),e.logDebug(t))}}),t.getScope().chains.response.ajax.success.add({name:"removeFromDictionary",fire:function(t,n){e.isUndefined(t.context.callbacks)||!1===t.context.callbacks||e.each(t.context.callbacks,(function(e,t){t.fire.apply(this,t.params)}))}}),t.getScope().chains.response.success.add({name:"checkForSuccess",fire:function(e,t){if(t.kScope.data=e,!1===e.context.isSuccess)return!1;e.response.current=e.response.ajax.data}}),t.getScope().chains.response.success.add({name:"removeFromDictionary",fire:function(t,n){!1!==t.context.callbacks&&e.each(t.context.callbacks,(function(e,t){t.fire.apply(this,t.params)}))}}),t.getScope().chains.response.fail.add({name:"removeFromDictionary",fire:function(t,n){!1!==t.context.callbacks&&e.each(t.context.callbacks,(function(e,t){t.fire.apply(this,t.params)}))}}),e.extend(!0,e,{analytics:{base:t,build:!0}}),e.support.register({name:"analytics.base",loaded:!0,active:!0,dependency:["core.lib"]})}(klevu),function(e){e.support.hook(["core.constructors"],(function(){e.constructors.isLoaded("analytics.collector")||(e.constructors.add({name:"analytics.collector",create:function(){let t={events:{list:[],observers:{},types:[],counters:{}},general:{apiKey:!1,scope:document.createElement("div"),eventTypeLimit:10,flags:{build:!1,init:!1}}},n={webhookSettings:{run:!0,object:"analytics",scope:"collector"},getAllSettings:function(){return t},getScope:function(){return this},addEvent:function(t){let n=this.chains.addEvent;e.isUndefined(n)||0===n.list().length||(n.setScope(this),n.setData(t),n.fire())},hasEventType(t){return e.inArray(t,this.getSetting("events.types",[]))>=0},addEventType:function(t){e.inArray(t,this.getSetting("events.types",[]))<0&&(this.getAllSettings().events.types.push(t),this.getSetting("events.observers."+t,!1)||this.setSetting("events.observers."+t,{}),this.setSetting("events.counters."+t,0))},clearEventTypes:function(t,n){let s={eventTypes:t,limit:n},a=this.chains.clearEvent;e.isUndefined(a)||0===a.list().length||(a.setScope(this),a.setData(s),a.fire())},clearAllEvents:function(){let e=this.getSetting("events.types",[]);e.length>0&&this.clearEventTypes(e,0)},registerObserver:function(t){let n=this.chains.registerObserver;e.isUndefined(n)||0===n.list().length||(n.setScope(this),n.setData(t),n.fire())},runObserverForOldEvents:function(t,s){e.each(this.getSetting("events.list",[]),(function(a,i){e.inArray(i.type,s)>=0&&n.runObserversForEvent(i,t)}))},runObserversForEvent:function(t,n){let s={eventData:t,observerName:n},a=this.chains.runObservers;e.isUndefined(a)||0===a.list().length||(a.setScope(this),a.setData(s),a.fire())},setApiKey:function(t){if(this.setSetting("general.apiKey",t),!this.getSetting("general.flags.init",!1)){let t=this.chains.init;e.isUndefined(t)||0===t.list().length||(t.setScope(this),t.setData(this.getAllSettings()),t.fire())}return this},getApiKey:function(){return this.getSetting("general.apiKey")},setEventTypeLimit:function(e){return this.setSetting("general.eventTypeLimit",e),this},setWebhookSettings:function(t){return e.event.webhook.helpers.setWebhookSettingsForScope(t,this),this},getWebhookSettings:function(){return e.event.webhook.helpers.getWebhookSettingsForScope(this)},hasSetting:function(n){return!!e.getObjectPath(t,n,!1)},getSetting:function(n,s){return e.isUndefined(s)&&(s=!1),e.getObjectPath(t,n,s)},setSetting:function(n,s){return e.setObjectPath(t,n,s),this},chains:e.constructors.get("analytics.collector").chains},s=n.chains.build;return e.isUndefined(s)||0===s.list().length||(s.setScope(n),s.setData(n.getAllSettings()),s.fire()),n},chains:{build:e.chain({stopOnFalse:!0,webhook:{name:"chains.build"}}),init:e.chain({stopOnFalse:!0,webhook:{name:"chains.init"}}),addEvent:e.chain({stopOnFalse:!0,webhook:{name:"chains.addEvent"}}),clearEvent:e.chain({stopOnFalse:!0,webhook:{name:"chains.clearEvent"}}),registerObserver:e.chain({stopOnFalse:!0,webhook:{name:"chains.registerObserver"}}),runObservers:e.chain({stopOnFalse:!0,webhook:{name:"chains.runObservers"}})}}),e.constructors.get("analytics.collector").chains.build.add({name:"beforeBuild",fire:function(t,n){e.event.webhook.helpers.fireEventForScope({webhookSettings:n.webhookSettings,name:"mainObject",action:"beforeBuild",data:n.getAllSettings(),scope:n})}}),e.constructors.get("analytics.collector").chains.build.add({name:"setBuildFlag",fire:function(e,t){t.setSetting("general.flags.build",!0)}}),e.constructors.get("analytics.collector").chains.build.add({name:"afterBuild",fire:function(t,n){e.event.webhook.helpers.fireEventForScope({webhookSettings:n.webhookSettings,name:"mainObject",action:"afterBuild",data:t,scope:n})}}),e.constructors.get("analytics.collector").chains.init.add({name:"initGlobalCollector",fire:function(t,n){e.event.eventList.build({name:"_klvAnalyticsEvent",global:!0}),_klvAnalyticsEvent.chain.add({name:"moveToCollector",fire:function(t,n){if(t.element.length>0){let n=[];e.each(t.element,(function(t,s){if(!e.getObjectPath(s,"type",!1))return void(e.getGlobalSetting("console.type.analyticsCollector",!1)&&e.logDebug("Analytics - Collector - _klvAnalyticsEvent - event_type not defined"));let a=e.extend(!0,{},s);e.analytics.collector.addEvent(a),n.push(s)})),n.length>0&&e.eachReverse(n,(function(e,n){t.element.remove(n)}))}}}),_klvAnalyticsEvent.run()}}),e.constructors.get("analytics.collector").chains.init.add({name:"setInitFlag",fire:function(e,t){t.setSetting("general.flags.init",!0)}}),e.constructors.get("analytics.collector").chains.addEvent.add({name:"checkForEventType",fire:function(e,t){t.hasEventType(e.type)||t.addEventType(e.type)}}),e.constructors.get("analytics.collector").chains.addEvent.add({name:"beforeSaveEvent",fire:function(t,n){e.event.webhook.helpers.fireEventForScope({webhookSettings:n.webhookSettings,name:"addEvent",action:"before",data:t,scope:n})}}),e.constructors.get("analytics.collector").chains.addEvent.add({name:"addEventToList",fire:function(e,t){t.getSetting("events.list").push(e);let n=t.getSetting("general.eventTypeLimit"),s=t.getSetting("events.counters."+e.type,0)+1;t.setSetting("events.counters."+e.type,s),s>n&&t.clearEventTypes(e.type,n)}}),e.constructors.get("analytics.collector").chains.addEvent.add({name:"runObserversForEvent",fire:function(e,t){t.runObserversForEvent(e)}}),e.constructors.get("analytics.collector").chains.addEvent.add({name:"afterSaveEvent",fire:function(t,n){e.event.webhook.helpers.fireEventForScope({webhookSettings:n.webhookSettings,name:"addEvent",action:"after",data:t,scope:n})}}),e.constructors.get("analytics.collector").chains.clearEvent.add({name:"clearEvent",fire:function(t,n){e.isString(t.eventTypes)&&("all"===t.eventTypes?t.eventTypes=n.getSetting("events.types",[]):t.eventTypes=[t.eventTypes]);let s=[];if(0===t.eventTypes.length)return e.getGlobalSetting("console.type.analyticsCollector",!1)&&e.logDebug("Analytics - Collector - clearEventTypes - no event types to clean up"),!0;if(e.each(t.eventTypes,(function(e,a){let i=n.getSetting("events.counters."+a,!1);i&&i>t.limit&&s.push(a)})),s.length>0){let a={},i=n.getSetting("events.list",[]);return e.eachReverse(i,(function(n,o){e.inArray(o.type,s)>=0&&(e.getObjectPath(a,o.type,0)>=t.limit?i.splice(n,1):e.setObjectPath(a,o.type,e.getObjectPath(a,o.type,0)+1))})),e.each(a,(function(e,t){n.setSetting("events.counters."+e,t)})),n.setSetting("events.list",i),e.getGlobalSetting("console.type.analyticsCollector",!1)&&e.logDebug("Analytics - Collector - clearEventTypes - EventTypes "+i.join(",")+" clean up"),!0}return e.getGlobalSetting("console.type.analyticsCollector",!1)&&e.logDebug("Analytics - Collector - clearEventTypes - No EventTypes clean up as none are over limit"),!0}}),e.constructors.get("analytics.collector").chains.registerObserver.add({name:"addObserver",fire:function(t,n){return e.isUndefined(t.name)&&(t.name=e.randomFunctionName()),e.isUndefined(t.processor)?(e.getGlobalSetting("console.type.analyticsCollector",!1)&&e.logDebug("Analytics - Collector - registerObserver - processor not defined"),!1):e.isUndefined(t.eventTypes)||!e.isArray(t.eventTypes)?(e.getGlobalSetting("console.type.analyticsCollector",!1)&&e.logDebug("Analytics - Collector - registerObserver - eventTypes not defined"),!1):(e.isUndefined(t.processOld)&&(t.processOld=!1),e.each(t.eventTypes,(function(e,s){n.getSetting("events.observers."+s,!1)||n.setSetting("events.observers."+s,{}),n.getSetting("events.observers."+s+"."+t.name,!1)||n.setSetting("events.observers."+s+"."+t.name,t.processor)})),t.processOld&&n.runObserverForOldEvents(t.name,t.eventTypes),!0)}}),e.constructors.get("analytics.collector").chains.runObservers.add({name:"runObservers",fire:function(t,n){let s=function(e,t){let s=n.getSetting("events.observers."+e.type+"."+t,!1);return!!s&&(s(e),!0)};if(!e.isUndefined(t.observerName))return s(t.eventData,t.observerName);e.each(n.getSetting("events.observers."+t.eventData.type,{}),(function(e,n){s(t.eventData,e)}))}}))})),e.support.hook(["analytics.collector"],(function(){e.settings.chains.initChain.add({name:"analyticsCollector",fire:function(t,n){var s=e.getGlobalSetting("analytics.apiKey",e.getGlobalSetting("search.apiKey",e.getGlobalSetting("global.apiKey")));if(!e.isUndefined(s)){var a=e.getGlobalSetting("powerUp.analyticsCollector");if(!e.isUndefined(a)&&!1===a)return;if(e.getObjectPath(t,"flags.analyticsCollector.build",!1))return;e.setObjectPath(t,"flags.analyticsCollector.build",!0),e.analytics.collector.setApiKey(s)}}})})),e.support.isActive("analytics.collector")||(e.extend(!0,e,{analytics:{collector:e.constructors.construct("analytics.collector")}}),e.support.register({name:"analytics.collector",loaded:!0,active:!0,dependency:["core.constructors","core.lib"]}))}(klevu),function(e){e.support.hook(["analytics.collector"],(function(){e.support.isActive("analytics.dataExtract")||(e.extend(!0,e.analytics,{dataExtract:{processors:{product:{variantId:function(t){return e.isUndefined(t.variantId)?t.id:t.variantId},itemGroupId:function(t){return e.isUndefined(t.itemGroupId)||""===t.itemGroupId?t.id:t.itemGroupId},type:function(e){return e.typeOfRecord},position:function(e){return e.key}}},addProcessor:function(t,n,s){let a={};e.setObjectPath(a,t+"."+n,s),e.extend(!0,e.analytics.dataExtract.processors,a)},getProcessor:function(t,n){let s=new Function("item","return item['"+n+"'];");return e.getObjectPath(e.analytics.dataExtract.processors,t+"."+n,s)},search:{product:function(t){let n={},s=["id","variantId","itemGroupId","name","salePrice","price","startPrice","toPrice","basePrice","currency","brand","category","klevu_category","position","url","sku","rating","typeOfRecord"];return s=e.toUniqueArray(e.makeArray(e.getGlobalSetting("analytics.product.fields",[]),s)),e.each(s,(function(s,a){n[a]=e.analytics.dataExtract.getProcessor("product",a)(t)})),n},item:function(t){let n=!1;if("KLEVU_PRODUCT"===t.typeOfRecord)n=e.analytics.dataExtract.search.product(t);return n},queryFromScope:function(t,n){let s={foundRequest:!1,foundResponse:!1,request:{},response:{}};if(e.isUndefined(n)&&(n=e.getObjectPath(t.data,"context.section",!1)),!n)return s;var a=e.getObjectPath(t.data,"request.current.recordQueries",!1);if(a||(a=e.getObjectPath(t.data,"request.original.recordQueries")),a){let e=a.filter((function(e){return e.id===n}))[0];e&&(s.foundRequest=!0,s.request=e)}var i=e.getObjectPath(t.data,"response.current.queryResults",!1);if(i){let e=i.filter((function(e){return e.id===n}))[0];e&&(s.foundResponse=!0,s.response=e)}return s},itemsFromScope:function(t){let n=e.analytics.dataExtract.search.queryFromScope(t),s=[];if(n.foundResponse){let t=e.getObjectPath(n,"response.meta.offset",0);e.each(e.getObjectPath(n,"response.records",[]),(function(n,a){a.key=n+1,a.offset=t;let i=e.analytics.dataExtract.search.item(a);i&&s.push(i)}))}return s},itemByIdFromScope:function(t,n){let s=e.analytics.dataExtract.search.queryFromScope(n),a=[];if(s.foundResponse){let n=e.getObjectPath(s,"response.meta.offset",0);e.each(e.getObjectPath(s,"response.records",[]),(function(s,i){if(i.key=s+1,i.offset=n,i.id===t){let t=e.analytics.dataExtract.search.item(i);t&&a.push(t)}}))}return a},metaFromScope:function(t){let n={searchedTerm:e.getObjectPath(t.data,"context.termOriginal",""),categoryName:"",categoryPath:"",pageNumber:"",pageStartsFrom:"",src:"",limit:"",sort:"",totalResults:"0",typeOfQuery:"WILDCARD_AND",isPersonalised:!1},s=e.analytics.dataExtract.search.queryFromScope(t);if(s.foundRequest){if(n.categoryName=e.getObjectPath(s.request,"settings.query.categoryPath",""),n.limit=e.getObjectPath(s.request,"settings.limit",""),n.sort=e.getObjectPath(s.request,"settings.sort",""),n.src="[[typeOfRecord:"+e.getObjectPath(s.request,"settings.typeOfRecords.0","KLEVU_PRODUCT")+"]]",n.typeOfRecords=e.getObjectPath(s.request,"settings.typeOfRecords",["KLEVU_PRODUCT"]).join(","),""!==n.categoryName){let t=e.getObjectPath(e.extensions,"abTest.catnav."+n.categoryName.toLowerCase(),!1);t&&(n.abTestId=t.abTestId,n.abTestVariantId=t.abTestVariantId,n.abTestSource=t.sourceId.toLowerCase()),n.categoryPath=n.categoryName,n.categoryName=n.categoryName?n.categoryName.split(";").pop():""}n.isPersonalised=e.getObjectPath(s.request,"settings.personalisation.enablePersonalisation",!1)}return s.foundResponse&&(n.totalResults=e.getObjectPath(s.response,"meta.totalResultsFound","0"),n.typeOfQuery=e.getObjectPath(s.response,"meta.typeOfSearch","WILDCARD_AND"),n.pageNumber=Math.ceil(e.getObjectPath(s.response,"meta.offset",0)/e.getObjectPath(s.response,"meta.noOfResults",1))+1,""!==n.categoryName&&(n.pageStartsFrom=e.getObjectPath(s.response,"meta.offset",0))),n},filtersFromScope:function(t){let n=e.analytics.dataExtract.search.queryFromScope(t),s={activeFilters:!1,activeFiltersString:"",allFilters:[]};if(n.foundResponse){s.allFilters=e.getObjectPath(n.response,"filters",[]);let t="",a=!1;e.each(s.allFilters,(function(n,s){"SLIDER"==s.type?null!==s.start&&void 0!==s.start&&null!==s.end&&void 0!==s.end&&(s.start==s.min&&s.end==s.max||(a&&(t+=";;"),a=!0,t+=s.key+":"+s.start+" - "+s.end)):e.each(s.options,(function(e,n){n.selected&&(a&&(t+=";;"),a=!0,t+=s.key+":"+n.name)}))})),t+="",a&&(s.activeFilters=!0,s.activeFiltersString=t)}return s}},general:{bannerClick:function(e){}}}}),e.support.register({name:"analytics.dataExtract",loaded:!0,active:!0,dependency:["analytics.collector"]}))}))}(klevu),function(e){e.support.hook(["analytics.collector","analytics.utility","core.loader"],(function(){e.modules.loader.addModule({name:"analyticsProcessor",src:e.getGlobalSetting("modules.analyticsProcessor.url","https://statsjs.klevu.com/v2/")+"analytics.js"})}))}(klevu),function(e){var t={listOfModules:e.chain({stopOnFalse:!0}),addProcessors:function(){var t=e.assets.getProcessors();e.isUndefined(t.jsKmcModule)&&e.assets.addProcessor({type:"jsKmcModule",fire:function(t,n){e.extensions.kmcModulesLoader.loadCounter++;var s=e.assets.getProcessors().js(t,n);return e.extensions.kmcModulesLoader.loadCounter===n.totalToLoad&&(e.extensions.kmcModulesLoader.resourcesLoaded=!0),s}})},loadKmcModules:function(t){e.extensions.kmcModulesLoader.addProcessors(),e.extensions.kmcModulesLoader.resourceLoadInitiated=!0,e.extensions.kmcModulesLoader.loadCounter=0;var n={scriptList:[],apiKey:t},s=e.extensions.kmcModulesLoader.listOfModules;e.isUndefined(s)||0===s.list().length||(s.setScope({makeRequests:!0}),s.setData(n),s.fire()),n.scriptList.forEach((function(t){e.assets.getFile({url:t.src,type:"jsKmcModule",totalToLoad:n.scriptList.length})}))},build:!0,resourcesLoaded:!1,resourceLoadInitiated:!1};e.extend(!0,e,{extensions:{kmcModulesLoader:t}}),e.extensions.kmcModulesLoader.listOfModules.add({name:"klaviyoScript",fire:function(t,n){if(e.search.modules.kmcInputs.base.getDataPath("klevu_connectors.klaviyo.enabled",!1)){var s=e.getGlobalSetting("modules.klaviyoComponent.url",!1),a={src:(s||"https://klaviyo.klevu.com/v2/")+"klaviyo.js"};t.scriptList.push(a)}}}),e.extensions.kmcModulesLoader.listOfModules.add({name:"klaviyoUserScript",fire:function(t,n){if(e.search.modules.kmcInputs.base.getDataPath("klevu_connectors.klaviyo.segmentEnabled",!1)){var s=e.getGlobalSetting("modules.klaviyoComponent.url",!1),a={src:(s||"https://klaviyo.klevu.com/v2/")+"segments.js"};t.scriptList.push(a)}}}),e.extensions.kmcModulesLoader.listOfModules.add({name:"shopifyScript",fire:function(t,n){var s=e.search.modules.kmcInputs.base.getDataPath("klevu_connectors.shopify.enabled",!1);if(e.isUndefined(window.Shopify)||(s=!0),s){var a=e.getGlobalSetting("url.componentUrl",!1),i={src:(a||"https://js.klevu.com/components/")+"shopify/v2/shopify.js"};t.scriptList.push(i)}}}),e.extensions.kmcModulesLoader.listOfModules.add({name:"gtmScript",fire:function(t,n){if(e.search.modules.kmcInputs.base.getDataPath("klevu_connectors.gtm.enabled",!1)){var s=e.getGlobalSetting("url.componentUrl",!1),a={src:(s||"https://js.klevu.com/components/")+"gtm/v2/gtm.js"};t.scriptList.push(a)}}})}(klevu),klevu.settings.chains.initChain.add({name:"kmcModulesLoaderKmcCheck",fire:function(e,t){var n=klevu.getGlobalSetting("powerUp.kmcModulesLoader");if(klevu.isUndefined(n)||!1!==n){var s=klevu.getGlobalSetting("kmc.loaded");klevu.isUndefined(s)||!0!==s||klevu.setObjectPath(e,"powerUp.kmcModulesLoader",!0)}}}),klevu.settings.chains.initChain.add({name:"kmcModulesLoaderPowerUp",fire:function(e,t){var n=klevu.getGlobalSetting("search.apiKey",klevu.getGlobalSetting("global.apiKey"));if(!klevu.isUndefined(n)){var s=klevu.getGlobalSetting("powerUp.kmcModulesLoader");if(!klevu.isUndefined(s)&&!1===s)return;if(!0!==s)return;klevu.setObjectPath(e,"powerUp.kmcModulesLoader",!1);var a=klevu.getObjectPath(klevu.extensions,"kmcModulesLoader.resourcesLoaded");if(!klevu.isUndefined(a)&&!0===a)return;klevu.extensions.kmcModulesLoader.loadKmcModules(n)}}}),klevu.support.register({name:"kmcModulesLoader",loaded:!0,active:!0,dependency:["kmc"]}),function(e){e.extend({moiEvents:{}}),e.extend(!0,e.moiEvents,{filters:{moiFiltersClick:function(t,n){e.event.attach(t,"click",(function(t){var s={elem:this,event:t=t||window.event},a=e.moiEvents.chains.filters.clickChain;e.isUndefined(a)||0===a.list().length||(a.setScope(n),a.setData(s),a.fire())}))}},product:{moiProductIntent:function(t,n){e.event.attach(t,"click",(function(t){var s={elem:this,event:t=t||window.event},a=e.moiEvents.chains.product.intentChain;e.isUndefined(a)||0===a.list().length||(a.setScope(n),a.setData(s),a.fire())}))},moiProductClick:function(t,n){e.event.attach(t,"click",(function(t){var s={elem:this,event:t=t||window.event},a=e.moiEvents.chains.product.clickChain;e.isUndefined(a)||0===a.list().length||(a.setScope(n),a.setData(s),a.fire())}))}},menu:{moiMenuClick:function(t,n){e.event.attach(t,"click",(function(t){var s={elem:this,event:t=t||window.event},a=e.moiEvents.chains.menu.clickChain;e.isUndefined(a)||0===a.list().length||(a.setScope(n),a.setData(s),a.fire())}))},toggleMoiMenu:function(t){(t=t||window.event).preventDefault(),this.classList.contains(e.getSetting(this.moiScope.settings,"settings.moi.activeClass"))?e.moiEvents.menu.closeMoiMenu(this):e.moiEvents.menu.openMoiMenu(this)},openMoiMenu:function(t){var n={elem:this},s=e.moiEvents.chains.menu.openChain;e.isUndefined(s)||0===s.list().length||(s.setScope(t),s.setData(n),s.fire())},closeMoiMenu:function(t){var n={elem:this},s=e.moiEvents.chains.menu.closeChain;e.isUndefined(s)||0===s.list().length||(s.setScope(t),s.setData(n),s.fire())}},buttons:{moiButtonsClick:function(t,n){e.event.attach(t,"click",(function(t){var s={elem:this,event:t=t||window.event},a=e.moiEvents.chains.menu.clickChain;e.isUndefined(a)||0===a.list().length||(a.setScope(n),a.setData(s),a.fire())}))}},forms:{moiFormSubmit:function(t,n){e.event.attach(t,"submit",(function(t){var s={elem:this,event:t=t||window.event},a=e.moiEvents.chains.forms.submitChain;e.isUndefined(a)||0===a.list().length||(a.setScope(n),a.setData(s),a.fire())}))}},display:{fixView:function(t){var n=e.moiEvents.chains.display.fixViewChain;e.isUndefined(n)||0===n.list().length||(n.setScope(t),n.setData({resize:!0}),n.fire())},executeChain:function(t,n,s){let a=e.getObjectPath(e.moiEvents,t);e.isUndefined(a)||0===a.list().length||(a.setScope(s),a.setData(n),a.fire())},scrollToBottom:function(t){let n=e.dom.getFirst(e.getSetting(e.getGlobalSetting("moi.box",e.moi.base).getScope().settings,"settings.moi.chatList")+"[data-chat='"+e.getGlobalSetting("moi.box",e.moi.base).getScope().mode.mode+"']",e.getGlobalSetting("moi.box",e.moi.base).getScope().target),s=e.dom.helpers.getClosest(n,".ksMoiScrollableContent");s.scrollTop=s.scrollHeight},openMoi:function(t){let n={event:t=t||window.event,flags:{initHistoryOnOpen:!0}},s=this.moiScope.element;e.moiEvents.display.executeChain("chains.navigation.openChain",n,s)},forceOpenMoi:function(){let t=e.getGlobalSetting("moi.container").moiScope.element;e.moiEvents.display.executeChain("chains.navigation.openChain",{flags:{initHistoryOnOpen:!0,dispatchEventFocus:!0,setState:!0,setOverrideFocus:!0,maximiseChat:!0}},t)},closeMoi:function(t){let n={event:t=t||window.event},s=this.moiScope.target;e.moiEvents.display.executeChain("chains.navigation.closeChain",n,s)},forceCloseMoi:function(){let t=e.getGlobalSetting("moi.container").moiScope.element;e.moiEvents.display.executeChain("chains.navigation.closeChain",{flags:{setState:!0,setOverrideFocus:!0}},t)},safeCloseMoi:function(){let t=e.getGlobalSetting("moi.container").moiScope.element;e.moiEvents.display.executeChain("chains.navigation.closeChain",{flags:{setState:!0}},t)},minimiseToggleChat:function(t){let n=e.getGlobalSetting("moi.container").moiScope.element;e.moiEvents.display.executeChain("chains.navigation.toggleChain",{flags:{toggle:!0}},n)},minimiseChat:function(t){let n=e.getGlobalSetting("moi.container").moiScope.element;e.moiEvents.display.executeChain("chains.navigation.toggleChain",{flags:{minimize:!0}},n)},maximiseChat:function(t){let n=e.getGlobalSetting("moi.container").moiScope.element;e.moiEvents.display.executeChain("chains.navigation.toggleChain",{flags:{maximize:!0}},n)},activateChat:function(t,n){var s=e.moiEvents.chains.display.activateChatChain;e.isUndefined(s)||0===s.list().length||(s.setScope(n),s.setData(t),s.fire())},activateGeneralChat:function(){let t=e.getGlobalSetting("moi.box",e.moi.base).getScope().target;e.moiEvents.display.activateChat({mode:"general"},t)}},overlay:{init:function(t,n,s){n=e.extend(!0,n,{settings:{imageLocation:e.getGlobalSetting("moi.imageLocation","https://js.klevu.com/components/moi/v2/images")}}),"product"==t&&(e.moiEvents.overlay.renderProduct(n,s),e.isUndefined(e.moiEvents.overlay.productShortDesc)||e.moiEvents.overlay.productShortDesc(s)),"customerSupport"==t&&e.moiEvents.overlay.renderCustomerSupport(n,s),"feedback"==t&&e.moiEvents.overlay.renderFeedback(n,s),e.isUndefined(e.moiEvents)||e.isUndefined(e.moiEvents.overlay)||e.moiEvents.overlay.cancelLink(s),e.isUndefined(e.moiEvents)||e.isUndefined(e.moiEvents.overlay)||e.moiEvents.overlay.show(s)},renderProduct:function(t,n){var s=e.dom.getFirst(e.getSetting(n.moiScope.settings,"settings.moi.productBlockContent"),t);n.moiScope.template.setData({product:t.dataset.id});var a=n.moiScope.template.convertTemplate(n.moiScope.template.render("productOverlay"));e.dom.getFirst(e.getSetting(n.moiScope.settings,"settings.moi.overlayProductBlock"),a).innerHTML=s.innerHTML,e.dom.getFirst(e.getSetting(n.moiScope.settings,"settings.moi.overlayContent"),n.moiScope.target).innerHTML=a.innerHTML,e.each(e.dom.find(e.getSetting(n.moiScope.settings,"settings.moi.productDirectLink"),e.dom.getFirst(e.getSetting(n.moiScope.settings,"settings.moi.overlayContent"),n.moiScope.target)),(function(t,s){e.isUndefined(e.moiEvents)||e.isUndefined(e.moiEvents.product)||e.moiEvents.product.moiProductClick(s,n)}))},renderCustomerSupport:function(t,n){n.moiScope.template.setData(t);var s=n.moiScope.template.convertTemplate(n.moiScope.template.render("customerSupportOverlay"));e.dom.getFirst(e.getSetting(n.moiScope.settings,"settings.moi.overlayContent"),n.moiScope.target).innerHTML=s.innerHTML,e.each(e.dom.find(e.getSetting(n.moiScope.settings,"settings.moi.overlayForm"),e.dom.getFirst(e.getSetting(n.moiScope.settings,"settings.moi.overlayContent"),n.moiScope.target)),(function(t,s){e.isUndefined(e.moiEvents)||e.isUndefined(e.moiEvents.forms)||e.moiEvents.forms.moiFormSubmit(s,n)}))},renderFeedback:function(t,n){n.moiScope.template.setData(t);var s=n.moiScope.template.convertTemplate(n.moiScope.template.render("feedbackOverlay"));e.dom.getFirst(e.getSetting(n.moiScope.settings,"settings.moi.overlayContent"),n.moiScope.target).innerHTML=s.innerHTML,e.each(e.dom.find(e.getSetting(n.moiScope.settings,"settings.moi.overlayForm"),e.dom.getFirst(e.getSetting(n.moiScope.settings,"settings.moi.overlayContent"),n.moiScope.target)),(function(t,s){e.isUndefined(e.moiEvents)||e.isUndefined(e.moiEvents.forms)||e.moiEvents.forms.moiFormSubmit(s,n)}))},cancelLink:function(t){e.each(e.dom.find(e.getSetting(t.moiScope.settings,"settings.moi.overlayClose"),e.dom.getFirst(e.getSetting(t.moiScope.settings,"settings.moi.overlay"),t.moiScope.target)),(function(n,s){e.event.attach(s,"click",(function(n){n.preventDefault(),e.isUndefined(e.moiEvents)||e.isUndefined(e.moiEvents.overlay)||e.moiEvents.overlay.hide(t)}))}))},hide:function(t){e.dom.getFirst(e.getSetting(t.moiScope.settings,"settings.moi.overlay"),t.moiScope.target).style.display="none"},show:function(t){e.dom.getFirst(e.getSetting(t.moiScope.settings,"settings.moi.overlay"),t.moiScope.target).style.display="block"}},message:{openCloseExplain:function(t,n){e.event.attach(t,"click",(function(t){var s={elem:this,event:t=t||window.event},a=e.moiEvents.chains.message.toggleExplainChain;e.isUndefined(a)||0===a.list().length||(a.setScope(n),a.setData(s),a.fire())}))},submitMessage:function(t){t=t||window.event;var n={elem:e.dom.getFirst(".ksMoiInputField[data-chat='"+this.moiScope.mode.mode+"']",this),event:t},s=e.moiEvents.chains.message.submitMessageChain;e.isUndefined(s)||0===s.list().length||(s.setScope(this.moiScope.element),s.setData(n),s.fire())},keyUp:function(t){var n={elem:this,event:t=t||window.event},s=e.moiEvents.chains.message.keyUpChain;e.isUndefined(s)||0===s.list().length||(s.setScope(this.moiScope.element),s.setData(n),s.fire())}},init:{setState:function(t){e({component:{moi:{state:t}}}),e.moiEvents.init.saveStateToStorage(t)},setOverrideFocus:function(t){e({component:{moi:{overrideFocus:t}}}),e.moiEvents.init.saveOverrideFocusToStorage(t)},getState:function(){return e.getGlobalSetting("component.moi.state",!1)},getOverrideFocus:function(){return e.getGlobalSetting("component.moi.overrideFocus",!1)},loadDataFromStorage:function(){var t=e.dictionary("moiData");return t.setStorage("session"),t.mergeFromGlobal(),t},saveStateToStorage:function(t){var n=e.moiEvents.init.loadDataFromStorage();n.addElement("state",t),n.overrideGlobal()},saveOverrideFocusToStorage:function(t){var n=e.moiEvents.init.loadDataFromStorage();n.addElement("overrideFocus",t),n.overrideGlobal()},bindTyping:function(t){var n=t.getScope().element;e.event.attach(n,"focus",e.moiEvents.display.scrollToBottom,!0),e.event.attach(n,"blur",e.moiEvents.display.scrollToBottom,!0),n.form&&(n.form.moiObject=t,n.form.moiScope=n.form.moiObject.getScope(),n.form.moiElem=n.form.moiObject.getScope().element,e.event.attach(t.getScope().element.form,"submit",e.moiEvents.message.submitMessage,!0),e.moiEvents.init.initChatHistory(t,!0))},reInitCache:function(t){var n=e.getGlobalSetting("moi.apiKey",e.getGlobalSetting("global.apiKey"));t.getScope().history=e.dictionary("moiCache_"+n),t.getScope().history.setStorage("session"),t.getScope().history.mergeFromGlobal(),"sessionId"!==t.getScope().history.getElement("sessionId")&&e.setSetting(t.getScope().settings,"settings.moi.sessionId",t.getScope().history.getElement("sessionId"))},initChatHistory:function(t,n){if(n){if(!e.getSetting(t.getScope().settings,"settings.moi.initOnPageLoad",!1)||e.getGlobalSetting("flags.moi.initChat",!1))return!1}else if(e.getGlobalSetting("flags.moi.initChat",!1))return!1;e.moiEvents.init.reInitCache(t);var s=t.getScope().history.getElement("chat");if(0===(s="chat"===s?new Array:JSON.parse(s)).length)e.event.fireChain(t.getScope().element.moiScope,"chains.events.send",t.getScope().element,t.getScope().element.moiScope.data,null);else{var a=e.getObjectPath(t.getScope().element.moiScope,"chains.process.processLine"),i=e.getObjectPath(t.getScope().element.moiScope,"chains.process.display"),o=e.getObjectPath(t.getScope().element.moiScope,"chains.process.events");e.isUndefined(a)||0===a.list().length||(a.setScope(t.getScope().element),i.setScope(t.getScope().element),o.setScope(t.getScope().element),e.each(s,(function(t,n){if("message"===n.type){var s=n.data;if(s.fromHistory=!0,e.isUndefined(i)||0===i.list().length||(i.setData(s),i.fire()),!e.isUndefined(o)&&0!==o.list().length){var c={eventType:"message",message:s.message,note:s.note,explain:s.explain,tpl:s.tpl};o.setData(c),o.fire()}}else if("filter"===n.type||"products"===n.type){n.data.fromHistory=!0;var r=n.data;a.setData(r),a.fire()}})));var c=t.getScope().history.getElement("menuOptions");if("menuOptions"!==c){(c=JSON.parse(c)).line.fromHistory=!0;var r=c;a.setData(r),a.fire()}var l=t.getScope().history.getElement("genericOptions");if("genericOptions"!==l){(l=JSON.parse(l)).line.fromHistory=!0;r=l;a.setData(r),a.fire()}}e({flags:{moi:{initChat:!0}}})}}}),e.extend(!0,e.moiEvents,{chains:{filters:{clickChain:e.chain({stopOnFalse:!0,webhook:{name:"chains.filters.click"}})},product:{intentChain:e.chain({stopOnFalse:!0,webhook:{name:"chains.product.intent"}}),clickChain:e.chain({stopOnFalse:!0,webhook:{name:"chains.product.click"}})},menu:{clickChain:e.chain({stopOnFalse:!0,webhook:{name:"chains.menu.click"}}),openChain:e.chain({stopOnFalse:!0,webhook:{name:"chains.menu.open"}}),closeChain:e.chain({stopOnFalse:!0,webhook:{name:"chains.menu.close"}})},buttons:{clickChain:e.chain({stopOnFalse:!0,webhook:{name:"chains.buttons.click"}})},forms:{submitChain:e.chain({stopOnFalse:!0,webhook:{name:"chains.forms.submit"}})},display:{fixViewChain:e.chain({stopOnFalse:!0,webhook:{name:"chains.display.fixView"}}),activateChatChain:e.chain({stopOnFalse:!0,webhook:{name:"chains.display.activateChat"}})},message:{toggleExplainChain:e.chain({stopOnFalse:!0,webhook:{name:"chains.message.toggleExplain"}}),submitMessageChain:e.chain({stopOnFalse:!0,webhook:{name:"chains.message.submitMessage"}}),keyUpChain:e.chain({stopOnFalse:!0,webhook:{name:"chains.message.keyUp"}})},navigation:{openChain:e.chain({stopOnFalse:!0,webhook:{name:"chains.navigation.open"}}),closeChain:e.chain({stopOnFalse:!0,webhook:{name:"chains.navigation.close"}}),toggleChain:e.chain({stopOnFalse:!0,webhook:{name:"chains.navigation.toggle"}})}}}),e.moiEvents.chains.message.toggleExplainChain.add({name:"preventDefaultSubmission",fire:function(e,t){e.event.preventDefault()}}),e.moiEvents.chains.message.toggleExplainChain.add({name:"preventDefaultSubmission",fire:function(t,n){e.dom.helpers.getClosest(t.elem,".kumoimsgContent").classList.toggle("kumoiExplainOpen")}}),e.moiEvents.chains.filters.clickChain.add({name:"preventDefaultSubmission",fire:function(e,t){e.event.preventDefault()}}),e.moiEvents.chains.filters.clickChain.add({name:"activateFilter",fire:function(t,n){t.elem.classList.toggle(e.getSetting(n.moiScope.settings,"settings.moi.activeClass"))}}),e.moiEvents.chains.filters.clickChain.add({name:"collectData",fire:function(t,n){n.moiScope.data=n.moiObject.resetData();var s=[],a=[];e.each(e.dom.find(e.getSetting(n.moiScope.settings,"settings.moi.filterAction")+".active",e.dom.helpers.getClosest(t.elem,e.getSetting(n.moiScope.settings,"settings.moi.filters"))),(function(e,t){s.push(t.dataset.value),a.push(t.innerHTML)})),n.moiScope.data.request.filter.value=s.join(";"),n.moiScope.data.request.filter.value?n.moiScope.data.request.message=e.dom.helpers.getClosest(t.elem,e.getSetting(n.moiScope.settings,"settings.moi.filters")).dataset.chat.replace(e.getSetting(n.moiScope.settings,"settings.moi.filterSearchReplace"),a.join(e.getSetting(n.moiScope.settings,"settings.moi.filterDelimiterWord"))):n.moiScope.data.request.message=e.dom.helpers.getClosest(t.elem,e.getSetting(n.moiScope.settings,"settings.moi.filters")).dataset.chatEmpty,n.moiScope.data.context.preventDefault=!1}}),e.moiEvents.chains.filters.clickChain.add({name:"printMessage",fire:function(t,n){var s={displayType:"message",type:e.getSetting(n.moiScope.settings,"settings.moi.rightClass"),message:n.moiScope.data.request.message,tpl:null};e.event.fireChain(n.moiScope,"chains.process.display",n.moiScope.element,s,t.event)}}),e.moiEvents.chains.filters.clickChain.add({name:"addLoading",fire:function(t,n){var s={displayType:"loading",type:e.getSetting(n.moiScope.settings,"settings.moi.leftClass"),message:"loading",tpl:null};e.event.fireChain(n.moiScope,"chains.process.display",n.moiScope.element,s,t.event)}}),e.moiEvents.chains.filters.clickChain.add({name:"send",fire:function(t,n){e.event.fireChain(n.moiScope,"chains.events.send",n.moiScope.element,n.moiScope.data,t.event)}}),e.moiEvents.chains.product.intentChain.add({name:"preverntDefaultSubmission",fire:function(e,t){e.event.preventDefault()}}),e.moiEvents.chains.product.intentChain.add({name:"quickviewIntent",fire:function(t,n){if("quick-view"===t.elem.dataset.intent)return e.isUndefined(e.moiEvents)||e.isUndefined(e.moiEvents.overlay)||e.moiEvents.overlay.init("product",e.dom.helpers.getClosest(t.elem,e.getSetting(n.moiScope.settings,"settings.moi.productBlock")),n),!1}}),e.moiEvents.chains.product.intentChain.add({name:"subChatIntent",fire:function(t,n){if("product-specific-question"===t.elem.dataset.intent){let s={mode:"product-specific-question",className:"Product",url:e.dom.getFirst(e.getSetting(n.moiScope.settings,"settings.moi.productDirectLink"),e.dom.helpers.getClosest(t.elem,e.getSetting(n.moiScope.settings,"settings.moi.productBlock"))).getAttribute("href"),id:e.dom.helpers.getClosest(t.elem,e.getSetting(n.moiScope.settings,"settings.moi.productBlock")).dataset.id,image:e.dom.getFirst(e.getSetting(n.moiScope.settings,"settings.moi.productImage",".ksMoiProductImage"),e.dom.helpers.getClosest(t.elem,e.getSetting(n.moiScope.settings,"settings.moi.productBlock"))).getAttribute("src"),name:e.dom.getFirst(e.getSetting(n.moiScope.settings,"settings.moi.productName",".ksMoiProductName"),e.dom.helpers.getClosest(t.elem,e.getSetting(n.moiScope.settings,"settings.moi.productBlock"))).innerHTML,price:e.dom.getFirst(e.getSetting(n.moiScope.settings,"settings.moi.productPrice",".ksMoiProductPrice"),e.dom.helpers.getClosest(t.elem,e.getSetting(n.moiScope.settings,"settings.moi.productBlock"))).innerHTML,title:t.elem.dataset.chat};return e.moiEvents.display.activateChat(s,n),!1}}}),e.moiEvents.chains.product.intentChain.add({name:"collectData",fire:function(t,n){n.moiScope.data=n.moiObject.resetData(),n.moiScope.data.request.message=t.elem.dataset.chat;var s=e.dom.getFirst(e.getSetting(n.moiScope.settings,"settings.moi.productDirectLink"),e.dom.helpers.getClosest(t.elem,e.getSetting(n.moiScope.settings,"settings.moi.productBlock"))),a=e.dom.helpers.getClosest(t.elem,e.getSetting(n.moiScope.settings,"settings.moi.productBlock"));n.moiScope.data.request.product={id:a.dataset.id,intent:t.elem.dataset.intent,context:{url:s.getAttribute("href")}},n.moiScope.data.context.preventDefault=!1}}),e.moiEvents.chains.product.intentChain.add({name:"printMessage",fire:function(t,n){var s={displayType:"message",type:e.getSetting(n.moiScope.settings,"settings.moi.rightClass"),message:n.moiScope.data.request.message,tpl:null};e.event.fireChain(n.moiScope,"chains.process.display",n.moiScope.element,s,t.event)}}),e.moiEvents.chains.product.intentChain.add({name:"addLoading",fire:function(t,n){var s={displayType:"loading",type:e.getSetting(n.moiScope.settings,"settings.moi.leftClass"),message:"loading",tpl:null};e.event.fireChain(n.moiScope,"chains.process.display",n.moiScope.element,s,t.event)}}),e.moiEvents.chains.product.intentChain.add({name:"send",fire:function(t,n){e.event.fireChain(n.moiScope,"chains.events.send",n.moiScope.element,n.moiScope.data,t.event)}}),e.moiEvents.chains.product.clickChain.add({name:"preverntDefaultSubmission",fire:function(e,t){e.event.preventDefault()}}),e.moiEvents.chains.product.clickChain.add({name:"collectData",fire:function(t,n){n.moiScope.data=n.moiObject.resetData();var s=e.dom.getFirst(e.getSetting(n.moiScope.settings,"settings.moi.productDirectLink"),e.dom.helpers.getClosest(t.elem,e.getSetting(n.moiScope.settings,"settings.moi.productBlock"))),a=e.dom.helpers.getClosest(t.elem,e.getSetting(n.moiScope.settings,"settings.moi.productBlock"));n.moiScope.data.request.product={id:a.dataset.id,intent:"redirect",context:{url:s.getAttribute("href")}},n.moiScope.data.context.preventDefault=!1}}),e.moiEvents.chains.product.clickChain.add({name:"overlayClose",fire:function(t,n){e.isUndefined(e.moiEvents)||e.isUndefined(e.moiEvents.overlay)||e.moiEvents.overlay.hide(n)}}),e.moiEvents.chains.product.clickChain.add({name:"send",fire:function(t,n){e.event.fireChain(n.moiScope,"chains.events.send",n.moiScope.element,n.moiScope.data,t.event)}}),e.moiEvents.chains.buttons.clickChain.add({name:"preverntDefaultSubmission",fire:function(e,t){e.event.preventDefault()}}),e.moiEvents.chains.buttons.clickChain.add({name:"collectData",fire:function(e,t){t.moiScope.data=t.moiObject.resetData(),t.moiScope.data.request.message=e.elem.dataset.chat,t.moiScope.data.context.preventDefault=!1}}),e.moiEvents.chains.buttons.clickChain.add({name:"printMessage",fire:function(t,n){var s={displayType:"message",type:e.getSetting(n.moiScope.settings,"settings.moi.rightClass"),message:n.moiScope.data.request.message,tpl:null};e.event.fireChain(n.moiScope,"chains.process.display",n.moiScope.element,s,t.event)}}),e.moiEvents.chains.buttons.clickChain.add({name:"message",fire:function(t,n){"message"===t.elem.dataset.action&&e.event.fireChain(n.moiScope,"chains.events.send",n.moiScope.element,n.moiScope.data,t.event)}}),e.moiEvents.chains.buttons.clickChain.add({name:"clearChat",fire:function(t,n){if("clearChat"===t.elem.dataset.action){var s=e.getObjectPath(n.moiScope,"chains.process.actions");if(!e.isUndefined(s)&&0!==s.list().length){s.setScope(n.moiElem);s.setData({type:"clearChat",context:{value:!0}}),s.fire()}}}}),e.moiEvents.chains.forms.submitChain.add({name:"preverntDefaultSubmission",fire:function(e,t){e.event.preventDefault()}}),e.moiEvents.chains.forms.submitChain.add({name:"validation",fire:function(t,n){var s=!0;if(e.each(e.dom.find(e.getSetting(n.moiScope.settings,"settings.moi.overlayFormItem"),t.elem),(function(t,a){if(a.classList.remove(e.getSetting(n.moiScope.settings,"settings.moi.overlayFormInvalid")),""!==a.dataset.validations){var i=a.dataset.validations.split("");e.each(i,(function(t,i){switch(i){case"R":""===a.value&&(a.classList.add(e.getSetting(n.moiScope.settings,"settings.moi.overlayFormInvalid")),s=!1);break;case"N":e.isNumeric(a.value)||(a.classList.add(e.getSetting(n.moiScope.settings,"settings.moi.overlayFormInvalid")),s=!1);break;case"E":/\S+@\S+\.\S+/.test(a.value)||(a.classList.add(e.getSetting(n.moiScope.settings,"settings.moi.overlayFormInvalid")),s=!1)}}))}})),!s)return!1}}),e.moiEvents.chains.forms.submitChain.add({name:"collectData",fire:function(t,n){n.moiScope.data=n.moiObject.resetData();var s={type:t.elem.dataset.type,params:[]};e.each(e.dom.find(e.getSetting(n.moiScope.settings,"settings.moi.overlayFormItem"),t.elem),(function(e,t){var n=!0;"radio"==t.type&&!1===t.checked&&(n=!1),n&&s.params.push({key:t.name,value:t.value})})),n.moiScope.data.request.form=s,n.moiScope.data.context.preventDefault=!1}}),e.moiEvents.chains.forms.submitChain.add({name:"closeOverlay",fire:function(t,n){e.isUndefined(e.moiEvents)||e.isUndefined(e.moiEvents.overlay)||e.moiEvents.overlay.hide(n)}}),e.moiEvents.chains.forms.submitChain.add({name:"closeMoiMenu",fire:function(t,n){e.isUndefined(e.moiEvents)||e.isUndefined(e.moiEvents.menu)||e.moiEvents.menu.closeMoiMenu(n)}}),e.moiEvents.chains.forms.submitChain.add({name:"send",fire:function(t,n){e.event.fireChain(n.moiScope,"chains.events.send",n.moiScope.element,n.moiScope.data,event)}}),e.moiEvents.chains.menu.clickChain.add({name:"preverntDefaultSubmission",fire:function(e,t){e.event.preventDefault()}}),e.moiEvents.chains.menu.clickChain.add({name:"message",fire:function(t,n){if("message"===t.elem.dataset.action){n.moiScope.data=n.moiObject.resetData(),n.moiScope.data.request.message=t.elem.dataset.chat,n.moiScope.data.context.preventDefault=!1;var s={displayType:"message",type:e.getSetting(n.moiScope.settings,"settings.moi.rightClass"),message:n.moiScope.data.request.message,tpl:null};e.event.fireChain(n.moiScope,"chains.process.display",n.moiScope.element,s,t.event);var a={displayType:"loading",type:e.getSetting(n.moiScope.settings,"settings.moi.leftClass"),message:n.moiScope.data.request.message,tpl:null};e.event.fireChain(n.moiScope,"chains.process.display",n.moiScope.element,a,t.event),e.event.fireChain(n.moiScope,"chains.events.send",n.moiScope.element,n.moiScope.data,t.event)}}}),e.moiEvents.chains.menu.clickChain.add({name:"clearChat",fire:function(t,n){if("clearChat"===t.elem.dataset.action){n.moiScope.data=n.moiObject.resetData(),n.moiScope.data.request.message=t.elem.dataset.chat;var s=e.getObjectPath(n.moiScope,"chains.process.actions");if(!e.isUndefined(s)&&0!==s.list().length){s.setScope(n.moiElem);s.setData({type:"clearChat",context:{value:!0}}),s.fire()}}}}),e.moiEvents.chains.menu.clickChain.add({name:"customerSupport",fire:function(t,n){if("customerSupport"===t.elem.dataset.action){var s=JSON.parse(decodeURIComponent(t.elem.dataset.options)),a={chat:t.elem.dataset.chat,type:t.elem.dataset.action};e.isArray(s)&&s.length>0&&(e.each(s,(function(e,t){t.key&&(a[t.key]={value:t.value,validations:t.validations,key:t.key})})),e.isUndefined(e.moiEvents)||e.isUndefined(e.moiEvents.overlay)||e.moiEvents.overlay.init("customerSupport",a,n))}}}),e.moiEvents.chains.menu.clickChain.add({name:"feedback",fire:function(t,n){if("feedback"===t.elem.dataset.action){var s=JSON.parse(decodeURIComponent(t.elem.dataset.options)),a={chat:t.elem.dataset.chat,type:t.elem.dataset.action};e.isArray(s)&&s.length>0&&(e.each(s,(function(e,t){t.key&&(a[t.key]={value:t.value,validations:t.validations,key:t.key})})),e.isUndefined(e.moiEvents)||e.isUndefined(e.moiEvents.overlay)||e.moiEvents.overlay.init("feedback",a,n))}}}),e.moiEvents.chains.menu.clickChain.add({name:"closeMenu",fire:function(t,n){"feedback"!==t.elem.dataset.action&&"customerSupport"!==t.elem.dataset.action&&(e.isUndefined(e.moiEvents)||e.isUndefined(e.moiEvents.menu)||e.moiEvents.menu.closeMoiMenu(n))}}),e.moiEvents.chains.menu.openChain.add({name:"openMoiMenu",fire:function(t,n){var s=e.dom.getFirst(e.getSetting(n.moiScope.settings,"settings.moi.menuBox"),n.moiScope.target),a=e.dom.getFirst(e.getSetting(n.moiScope.settings,"settings.moi.menuBoxButton"),n.moiScope.target);s.classList.add(e.getSetting(n.moiScope.settings,"settings.moi.activeClass")),a.classList.add(e.getSetting(n.moiScope.settings,"settings.moi.activeClass"))}}),e.moiEvents.chains.menu.closeChain.add({name:"closeMoiMenu",fire:function(t,n){var s=e.dom.getFirst(e.getSetting(n.moiScope.settings,"settings.moi.menuBox"),n.moiScope.target),a=e.dom.getFirst(e.getSetting(n.moiScope.settings,"settings.moi.menuBoxButton"),n.moiScope.target);s.classList.remove(e.getSetting(n.moiScope.settings,"settings.moi.activeClass")),a.classList.remove(e.getSetting(n.moiScope.settings,"settings.moi.activeClass"))}}),e.moiEvents.chains.display.fixViewChain.add({name:"resizeChat",fire:function(t,n){e.moiEvents.display.scrollToBottom()}}),e.moiEvents.chains.display.activateChatChain.add({name:"toggleChat",fire:function(t,n){e.each(e.dom.find(".ksMoiChatWraper",n.target),(function(e,t){t.classList.remove("active")})),e.dom.getFirst(".ksMoiChatWraper[data-chat='"+t.mode+"']",n.target).classList.add("active")}}),e.moiEvents.chains.display.activateChatChain.add({name:"checkIfChatIsProduct",fire:function(t,n){if("product-specific-question"===t.mode){n.moiScope.mode.url=t.url,n.moiScope.mode.id=t.id,n.moiScope.mode.mode=t.mode,n.moiScope.template.setData(t);let a=n.moiScope.template.convertTemplate(n.moiScope.template.render("secondChatHeader"));e.dom.getFirst(".ksMoiChatWraper[data-chat='"+t.mode+"'] .kumoi"+t.className+"ChatHeader"+t.className,n.target).innerHTML=a.innerHTML;let i=e.dom.getFirst(".ksMoiChatWraper[data-chat='"+t.mode+"'] .ksMoiInputField[data-chat='"+t.mode+"']",n.target);i.placeholder=i.dataset.placeholder,e.dom.getFirst(".ksMoiChatWraper[data-chat='"+t.mode+"'] .kumoi"+t.className+"ChatHeaderTitle",n.target).innerHTML=t.title;var s=e.dom.find(e.getSetting(n.moiScope.settings,"settings.moi.chatList")+"[data-chat='"+n.moiScope.mode.mode+"']> div",n.moiScope.target);e.each(s,(function(e,t){t.parentNode.removeChild(t)}))}}}),e.moiEvents.chains.display.activateChatChain.add({name:"checkIfChatIsGeneral",fire:function(e,t){"general"===e.mode&&(delete t.moiScope.mode.url,delete t.moiScope.mode.id,t.moiScope.mode.mode="general")}}),e.moiEvents.chains.message.submitMessageChain.add({name:"preverntDefaultSubmission",fire:function(e,t){e.event.preventDefault()}}),e.moiEvents.chains.message.submitMessageChain.add({name:"closeOverlay",fire:function(t,n){e.isUndefined(e.moiEvents)||e.isUndefined(e.moiEvents.overlay)||e.moiEvents.overlay.hide(n)}}),e.moiEvents.chains.message.submitMessageChain.add({name:"checkForEmpty",fire:function(e,t){if(""===e.elem.value)return!1}}),e.moiEvents.chains.message.submitMessageChain.add({name:"collectData",fire:function(e,t){t.moiScope.data=t.moiObject.resetData(),t.moiScope.data.request.message=e.elem.value,t.moiScope.data.context.preventDefault=!1,e.elem.value=""}}),e.moiEvents.chains.message.submitMessageChain.add({name:"checkForMode",fire:function(e,t){t.moiScope.data.context.mode=e.elem.dataset.chat,"product-specific-question"===t.moiScope.data.context.mode&&(t.moiScope.data.context.id=t.moiScope.mode.id,t.moiScope.data.context.productUrl=t.moiScope.mode.url)}}),e.moiEvents.chains.message.submitMessageChain.add({name:"printMessage",fire:function(t,n){var s={displayType:"message",type:e.getSetting(n.moiScope.settings,"settings.moi.rightClass"),message:n.moiScope.data.request.message,tpl:null};e.event.fireChain(n.moiScope,"chains.process.display",n.moiScope.element,s,t.event)}}),e.moiEvents.chains.message.submitMessageChain.add({name:"addLoading",fire:function(t,n){var s={displayType:"loading",type:e.getSetting(n.moiScope.settings,"settings.moi.leftClass"),message:"loading",tpl:null};e.event.fireChain(n.moiScope,"chains.process.display",n.moiScope.element,s,t.event)}}),e.moiEvents.chains.message.submitMessageChain.add({name:"send",fire:function(t,n){e.event.fireChain(n.moiScope,"chains.events.send",n.moiScope.element,n.moiScope.data,t.event)}}),e.moiEvents.chains.navigation.openChain.add({name:"eventPrevent",fire:function(t,n){e.getObjectPath(t,"event",!1)&&t.event.preventDefault()}}),e.moiEvents.chains.navigation.openChain.add({name:"initChatHistory",fire:function(t,n){e.getObjectPath(t,"flags.initHistoryOnOpen",!0)&&e.moiEvents.init.initChatHistory(n.moiObject,!1)}}),e.moiEvents.chains.navigation.openChain.add({name:"addActiveClass",fire:function(t,n){n.moiScope.target.classList.add(e.getSetting(n.moiScope.settings,"settings.moi.activeClass"))}}),e.moiEvents.chains.navigation.openChain.add({name:"fixView",fire:function(t,n){e.getObjectPath(e.moiEvents,"display.fixView",!1)&&e.moiEvents.display.fixView(n.moiScope.element)}}),e.moiEvents.chains.navigation.openChain.add({name:"dispatchEventFocus",fire:function(t,n){if(e.getObjectPath(t,"flags.dispatchEventFocus",!0)){let t,s=n.moiScope.target,a="onfocusin"in s?"focusin":"focus",i="onfocusin"in s;"createEvent"in document?(t=document.createEvent("Event"),t.initEvent(a,i,!0)):"Event"in window&&(t=new Event(a,{bubbles:i,cancelable:!0})),e.getSetting(n.moiScope.settings,"settings.moi.focusOnActive",!1)&&(e.dom.getFirst("#message",s).focus(),e.dom.getFirst("#message",s).dispatchEvent(t))}}}),e.moiEvents.chains.navigation.openChain.add({name:"setState",fire:function(t,n){e.getObjectPath(t,"flags.setState",!0)&&e.moiEvents.init.setState(!0)}}),e.moiEvents.chains.navigation.openChain.add({name:"setOverrideFocus",fire:function(t,n){e.getObjectPath(t,"flags.setOverrideFocus",!0)&&e.moiEvents.init.setOverrideFocus(!0)}}),e.moiEvents.chains.navigation.openChain.add({name:"positionContainer",fire:function(t,n){if(!e.isUndefined(n.moiScope.activeQuick)&&e.getGlobalSetting("moi.displayInQuick",!1)){var s,a,i,o,c,r,l,u;if(g=document,m=g.body,h=g.documentElement,f=window,v=0,void 0!==f.innerWidth&&(v=f.innerWidth),c=(p="number"==typeof m.clientWidth?m.clientWidth:void 0!==h&&void 0!==h.clientWidth&&0!=h.clientWidth?h.clientWidth:g.getElementsByTagName("body")[0].clientWidth)>=v-17?p:v,r=function(){var e=document,t=e.body,n=e.documentElement,s=window;return void 0!==s.innerHeight?s.innerHeight:"number"==typeof t.clientHeight?t.clientHeight:void 0!==n&&void 0!==n.clientHeight&&0!=n.clientHeight?n.clientHeight:e.getElementsByTagName("body")[0].clientHeight}(),c<640)return;s=function(e){for(var t,n=0,s=0,a=e,i=document,o=i.body,c=!1,r=window;a&&"body"!==a.tagName.toLowerCase();)if(r.getComputedStyle||(r.getComputedStyle=function(e,t){return this.searchBox=e,this.getPropertyValue=function(t){var n=/(\-([a-z]){1})/g;return"float"===t&&(t="styleFloat"),n.test(t)&&(t=t.replace(n,(function(){return arguments[2].toUpperCase()}))),e.currentStyle[t]?e.currentStyle[t]:null},this}),t=r.getComputedStyle(a,null)){if("fixed"===t.getPropertyValue("position")){c=!0;break}a=a.parentNode}else a=a.parentNode;for(var l=1,u=void 0!==r.pageYOffset?r.pageYOffset:(i.documentElement||o.parentNode||o).scrollTop;e&&!isNaN(e.offsetLeft)&&!isNaN(e.offsetTop);)n+=e.offsetLeft-e.scrollLeft,c&&1===l?(s+=e.offsetTop+u,l=0):s+=e.offsetTop,e=e.offsetParent;return{top:s,left:n}}(n.moiScope.activeQuick.kScope.element),i=s.top,a=s.left,l=c/2,o=n.moiScope.activeQuick.kScope.element.offsetWidth;let t,b,S=n.moiScope.activeQuick.kScope.element.offsetHeight+i+"px";a+e.getGlobalSetting("moi.sizeOfChat",n.moiScope.target.clientWidth)>=l?(t=c-(a+o)+"px",b="auto"):(t="auto",b=a+"px"),u=Math.floor(.8*r)+"px";var d=e.getSetting(n.moiScope.settings,"settings.moi.containerTarget");e.dom.getFirst(".moiContainer",d).style="position:absolute;top:"+S+";left: "+b+";right: "+t+";height:"+u}var p,g,m,h,f,v}}),e.moiEvents.chains.navigation.openChain.add({name:"setToMaximise",fire:function(t,n){e.getObjectPath(t,"flags.maximiseChat",!0)&&e.getGlobalSetting("moi.displayInQuick",!1)&&e.moiEvents.display.maximiseChat()}}),e.moiEvents.chains.navigation.closeChain.add({name:"eventPrevent",fire:function(t,n){e.isUndefined(t.event)||t.event.preventDefault()}}),e.moiEvents.chains.navigation.closeChain.add({name:"removeActiveClass",fire:function(t,n){n.moiScope.target.classList.remove(e.getSetting(n.moiScope.settings,"settings.moi.activeClass"))}}),e.moiEvents.chains.navigation.closeChain.add({name:"setState",fire:function(t,n){e.getObjectPath(t,"flags.setState",!0)&&e.moiEvents.init.setState(!1)}}),e.moiEvents.chains.navigation.closeChain.add({name:"setOverrideFocus",fire:function(t,n){e.getObjectPath(t,"flags.setOverrideFocus",!0)&&e.moiEvents.init.setOverrideFocus(!1)}}),e.moiEvents.chains.navigation.closeChain.add({name:"tryToRefocus",fire:function(t,n){if(!e.isUndefined(n.moiScope.activeQuick)&&e.getGlobalSetting("moi.displayInQuick",!1))try{n.moiScope.activeQuick.focus()}catch(e){}}}),e.moiEvents.chains.navigation.toggleChain.add({name:"checksForWindowSearch",fire:function(t,n){e.getGlobalSetting("moi.displayInQuick",!1)||n.moiScope.target.classList.contains("active")&&e.getObjectPath(t,"flags.toggle",!1)&&(e.getObjectPath(t,"flags.toggle",!1)?n.moiScope.target.classList.toggle("moiMinimized"):e.getObjectPath(t,"flags.maximize",!1)?n.moiScope.target.classList.remove("moiMinimized"):e.getObjectPath(t,"flags.minimize",!1)&&n.moiScope.target.classList.add("moiMinimized"))}}),e.moiEvents.chains.navigation.toggleChain.add({name:"checksForInSearch",fire:function(t,n){n.moiScope.target.classList.contains("active")&&e.getGlobalSetting("moi.displayInQuick",!1)&&(e.getObjectPath(t,"flags.minimize",!1)&&n.moiScope.target.classList.remove("active"),e.getObjectPath(t,"flags.maximize",!1)&&n.moiScope.target.classList.add("active"))}}),e.extend({moiObjectBuild:function(){var t={settings:{},webhookSettings:{run:!0,object:"moi",scope:"all,base"}};function n(e){t.element=document.createElement("input"),t.element.moiObject=e,t.element.moiScope=t,t.element.moiElem=t.element,t.element.webhookSettings=e.getWebhookSettings()}function s(){return{context:{klevuApiKey:null},request:{context:{sessionId:null,klevuApiKey:null},message:null,filter:{},product:{},form:{}},response:{current:{}},scope:{}}}e.setObjectPath(t,"id",e.randomId()),e.setObjectPath(t,"history",e.dictionary("moiCache")),t.history.setStorage("session"),t.history.mergeFromGlobal(),e.setSetting(t.settings,"settings.moi.lastMessage",e.time.timestamp()-3600),"sessionId"!==t.history.getElement("sessionId")&&e.setSetting(t.settings,"settings.moi.sessionId",t.history.getElement("sessionId")),e.setObjectPath(t,"template",e.template()),t.template.setWebhookSettings({run:t.webhookSettings.run,object:t.webhookSettings.object,scope:t.webhookSettings.scope}),e.setObjectPath(t,"chains.actions.doMoi",e.chain({stopOnFalse:!0,webhook:{name:"chains.actions.doMoi"}})),e.setObjectPath(t,"chains.actions.finalise",e.chain({stopOnFalse:!0,webhook:{name:"chains.actions.finalise"}})),e.setObjectPath(t,"chains.events.send",e.chain({stopOnFalse:!0,webhook:{name:"chains.events.send"}})),e.setObjectPath(t,"chains.request.control",e.chain({stopOnFalse:!0,webhook:{name:"chains.request.control"}})),e.setObjectPath(t,"chains.request.build",e.chain({stopOnFalse:!0,webhook:{name:"chains.request.build"}})),e.setObjectPath(t,"chains.request.send",e.chain({stopOnFalse:!0,webhook:{name:"chains.request.send"}})),e.setObjectPath(t,"chains.request.ajax.send",e.chain({stopOnFalse:!0,webhook:{name:"chains.request.ajax.send"}})),e.setObjectPath(t,"chains.request.fetch.send",e.chain({stopOnFalse:!0,webhook:{name:"chains.request.fetch.send"}})),e.setObjectPath(t,"chains.response.success",e.chain({stopOnFalse:!0,webhook:{name:"chains.response.success"}})),e.setObjectPath(t,"chains.response.done",e.chain({stopOnFalse:!0,webhook:{name:"chains.response.done"}})),e.setObjectPath(t,"chains.response.fail",e.chain({stopOnFalse:!0,webhook:{name:"chains.response.fail"}})),e.setObjectPath(t,"chains.process.display",e.chain({stopOnFalse:!0,webhook:{name:"chains.process.display"}})),e.setObjectPath(t,"chains.process.events",e.chain({stopOnFalse:!0,webhook:{name:"chains.process.events"}})),e.setObjectPath(t,"chains.process.processLine",e.chain({stopOnFalse:!0,webhook:{name:"chains.process.processLine"}})),e.setObjectPath(t,"chains.process.render",e.chain({stopOnFalse:!0,webhook:{name:"chains.process.render"}})),e.setObjectPath(t,"chains.process.actions",e.chain({stopOnFalse:!0,webhook:{name:"chains.process.actions"}})),t.data={context:{klevuApiKey:null},request:{context:{sessionId:null,klevuApiKey:null},message:null,filter:{},product:{},form:{}},response:{current:{}},scope:{}},t.mode={mode:"general"};var a={init:n,resetData:function(){var e=s();return t.data.context=e.context,t.data.request=e.request,t.data.response=e.response,t.data.scope=null,t.data},buildData:s,setScope:function(e){return t=e},getScope:function(){return t},setWebhookSettings:function(n){return n&&(t.webhookSettings=e.extend(!0,t.webhookSettings,n),t.template.setWebhookSettings({run:t.webhookSettings.run,object:t.webhookSettings.object,scope:t.webhookSettings.scope})),this},getWebhookSettings:function(){return t.webhookSettings}};return n(a),a}});e({moi:{dateDelay:900,redirectDelay:2e3,focusOnActive:!1,moiTarget:".moiContainer",chatList:".ksMoiChatContent",inputBox:"#message",buttonsBox:".moiButtons",activateButton:".toggleMoi",menuBox:".moiMenu",menuBoxButton:".toggleMoiMenu",products:"div.moiProductSlider",productAction:"a.ksMoiProductAction",productBlock:".moiProductBlock",productBlockContent:".moiProductContent",productDirectLink:"a.ksMoiProductLink",productLink:".moiProductlinks",productSlider:".moiProductSlidesContainer",productSlide:".moiSlides",productSliderArrow:".moiSliderArrowNav",productSliderDots:".moiSliderdot",filters:"div.kumoifilterList",filterAction:"a.kumoifiltername",buttonAction:"a.kumoifiltername",menuAction:"a.moi-menuOption",leftClass:"fromkumoi",rightClass:"fromUser",filterDelimiterWord:" and ",filterSearchReplace:"$VALUE$",overlay:".kumoiOverlay",overlayContent:".kumoiOverlayContent",overlayProductBlock:".moiQuickViewProductBlock",overlayClose:".kumoiOverlayClose",closeChat:".Kumoi-Closeicon",cancelChat:".ksMoiCancelIcon",minimiseChat:".ksMoiMinimise",maximiseChat:".kumoiLogoMinimized",overlayForm:".moiQuickViewFormContent",overlayFormItem:".moiQuickViewFormField",overlayFormError:".moiQuickViewFormErrors",overlayFormInvalid:"invalid",overlayProductShortDesc:".moiProductShortDesc",overlayProductShortDescActive:"ksMoiOpenText",activeClass:"active",inactiveClass:"inactive",disabledClass:"disabled"}}),e.extensions.kmcModulesLoader.listOfModules.add({name:"moiScript",fire:function(t,n){var s=e.search.modules.kmcInputs.base.getDataPath("klevu_moi.enabled",!1),a=e.search.modules.kmcInputs.base.getDataPath("features.moi.displayInQuick",!1);if(a&&e({moi:{displayInQuick:a}}),s||(s=e.search.modules.kmcInputs.base.getDataPath("features.moi.status",!1)),s){var i=e.getGlobalSetting("moi.theme",!1);if(i){c={src:i};t.scriptList.push(c)}else{var o=e.getGlobalSetting("url.componentUrl",!1),c={src:(o||"https://js.klevu.com/components/")+"moi/v2/moi.js"};t.scriptList.push(c)}}}})}(klevu),function(e){var t=e.moiObjectBuild();t.getScope().chains.actions.doMoi.add({name:"doRequest",fire:function(t,n){t.context.doRequest=!1;var s=e.getObjectPath(n.moiScope,"chains.request.control");if(e.isUndefined(s)||0===s.list().length)return t.context.preventDefault=!0,n.moiScope.data=t,!1;s.setScope(n.moiElem),s.setData(t),s.fire(),n.moiScope.data=t}}),t.getScope().chains.events.send.add({name:"generateURL",fire:function(t,n){var s=e.getSetting(n.moiScope.settings,"settings.url.moi","//moi-ai.ksearchnet.com/chat/send");if(!s)return!1;t.context.url=s}}),t.getScope().chains.events.send.add({name:"addApiKey",fire:function(t,n){var s=e.getSetting(n.moiScope.settings,"settings.moi.apiKey",e.getGlobalSetting("moi.apiKey",e.getGlobalSetting("global.apiKey")));if(e.isUndefined(s))return!1;t.context.apiKey=s,t.request.context.klevuApiKey=s;var a=e.getSetting(n.moiScope.settings,"settings.moi.sessionId",!1);a&&(t.request.context.sessionId=a)}}),t.getScope().chains.events.send.add({name:"addUserData",fire:function(t,n){if(e.support.isActive("user")){let n=e.user.getIpData();e.isUndefined(n.ipv4)||(t.request.context.ipAddressV4=n.ipv4),e.isUndefined(n.ipv6)||(t.request.context.ipAddressV6=n.ipv6),e.isUndefined(n.uuid)||(t.request.context.klevu_uuid=n.uuid)}e.support.isActive("core.dataProtection")&&(t.request.context.dataProtection=e.dataProtection.dataCanBeTracked())}}),t.getScope().chains.events.send.add({name:"addExtraContextForProduct",fire:function(e,t){"product-specific-question"===e.context.mode&&(e.request.context.url=e.context.productUrl,e.request.context.productId=e.context.id,e.request.context.mode=e.context.mode)}}),t.getScope().chains.events.send.add({name:"doMoi",fire:function(t,n){var s=e.getObjectPath(n.moiScope,"chains.actions.doMoi");if(e.isUndefined(s)||0===s.list().length||(s.setScope(n.moiElem),s.setData(t),s.fire()),n.moiScope.data=t,!0===t.context.preventDefault)return!1}}),t.getScope().chains.request.ajax.send.add({name:"sendRequest",fire:function(t,n){"moiAjaxV1"===t.context.eventAction&&(t.scope=n,t.context.doRequest?e.ajax({url:t.context.url,dataType:"json",contentType:"application/json; charset=utf-8",type:"POST",data:JSON.stringify(t.request),crossDomain:!0,success:function(t){var n=e.getObjectPath(t.requestDetails.scope.moiScope,"chains.response.success");e.isUndefined(n)||0===n.list().length||(n.setScope(t.requestDetails.scope.moiElem),t.requestDetails.response=t.responseObj.data.data,t.requestDetails.context.status=t.status,t.requestDetails.context.isSuccess=t.isSuccess,n.setData(t.requestDetails),n.fire())},done:function(t){var n=e.getObjectPath(t.requestDetails.scope.moiScope,"chains.response.done");e.isUndefined(n)||0===n.list().length||(n.setScope(t.requestDetails.scope.moiElem),t.requestDetails.response=t.responseObj.data.data,t.requestDetails.context.status=t.status,t.requestDetails.context.isSuccess=t.isSuccess,n.setData(t.requestDetails),n.fire())},error:function(t){var n=e.getObjectPath(t.requestDetails.scope.moiScope,"chains.response.fail");e.isUndefined(n)||0===n.list().length||(n.setScope(t.requestDetails.scope.moiElem),t.requestDetails.response={},t.requestDetails.context.status=t.status,t.requestDetails.context.isSuccess=t.isSuccess,n.setData(t.requestDetails),n.fire())},requestDetails:t}):e.settings.console.type.ajax&&(e.logError("chains.request.ajax.send - sendRequest - Request object is not present or request was forced stopped."),e.logDebug("chains.request.ajax.send - sendRequest - Data:"),e.logDebug(t)))}}),t.getScope().chains.request.fetch.send.add({name:"sendRequest",fire:function(t,n){"moiFetchV1"===t.context.eventAction&&(t.scope=n,t.context.doRequest?e.request({url:t.context.url,type:"FETCH",method:"POST",dataType:"json",contentType:"application/json; charset=utf-8",mimeType:"application/json; charset=UTF-8",data:JSON.stringify(t.request),crossDomain:!0,success:function(t,n,s,a){var i=e.getObjectPath(n.scope.kScope,"chains.response.success");e.isUndefined(i)||0===i.list().length||(i.setScope(n.scope.kElem),e.setObjectPath(n,"response.data",t),e.setObjectPath(n,"context.status",s),e.setObjectPath(n,"context.isSuccess",a),i.setData(n),i.fire())},done:function(t,n,s,a){var i=e.getObjectPath(n.scope.kScope,"chains.response.done");e.isUndefined(i)||0===i.list().length||(i.setScope(n.scope.kElem),e.setObjectPath(n,"response.data",t),e.setObjectPath(n,"context.status",s),e.setObjectPath(n,"context.isSuccess",a),i.setData(n),i.fire())},error:function(t,n,s){var a=e.getObjectPath(t.scope.kScope,"chains.response.fail");e.isUndefined(a)||0===a.list().length||(a.setScope(t.scope.kElem),e.setObjectPath(t,"response.data",{}),e.setObjectPath(t,"context.status",n),e.setObjectPath(t,"context.isSuccess",s),a.setData(t),a.fire())},requestDetails:t},t):e.settings.console.type.ajax&&(e.logError("chains.request.ajax.send - sendRequest - Request object is not present or request was forced stopped."),e.logDebug("chains.request.ajax.send - sendRequest - Data:"),e.logDebug(t)))}}),t.getScope().chains.request.control.add({name:"initRequest",fire:function(t,n){t.context.doRequest=!1;var s=e.getObjectPath(n.moiScope,"chains.request.build");return e.isUndefined(s)||0===s.list().length?(t.context.preventDefault=!0,n.moiScope.data=t,!1):(s.setScope(n.moiElem),s.setData(t),s.fire(),n.moiScope.data=t,!1!==t.context.doRequest&&void 0)}}),t.getScope().chains.request.control.add({name:"sanitiseRequest",fire:function(t,n){var s=e.clean(t.request);t.request=s}}),t.getScope().chains.request.control.add({name:"makeRequest",fire:function(t,n){var s=e.getObjectPath(n.moiScope,"chains.request.send");if(!e.isUndefined(s)&&0!==s.list().length)return s.setScope(n.moiElem),s.setData(t),s.fire(),n.moiScope.data=t,!1}}),t.getScope().chains.request.build.add({name:"buildMap",fire:function(e,t){e.context.status=null,e.context.isSuccess=!1,e.context.doRequest=!0}}),t.getScope().chains.request.send.add({name:"requestTypeAjaxV1",fire:function(e,t){window.fetch?e.context.eventAction="moiFetchV1":e.context.eventAction="moiAjaxV1",e.context.eventAction="moiAjaxV1"}}),t.getScope().chains.request.send.add({name:"requestTypeAjaxSendV1",fire:function(t,n){if("moiAjaxV1"===t.context.eventAction){var s=e.getObjectPath(n.moiScope,"chains.request.ajax.send");if(!e.isUndefined(s)&&0!==s.list().length)return s.setScope(n.moiElem),s.setData(t),s.fire(),n.moiScope.data=t,!1}}}),t.getScope().chains.request.send.add({name:"requestTypeFetchSendV1",fire:function(t,n){if("moiFetchV1"===t.context.eventAction){var s=e.getObjectPath(n.moiScope,"chains.request.fetch.send");if(!e.isUndefined(s)&&0!==s.list().length)return s.setScope(n.moiElem),s.setData(t),s.fire(),n.moiScope.data=t,!1}}}),t.getScope().chains.response.success.add({name:"checkForSuccess",fire:function(t,n){if(n.moiScope.data=t,!1===t.context.isSuccess)return e.settings.console.type.ajax&&(e.logError("chains.response.ajax.success - checkForSuccess - Request was not successful."),e.logDebug("chains.response.ajax.success - checkForSuccess - success:"),e.logDebug(t)),!1;t.response=t.response,e.settings.console.type.ajax&&(e.logError("chains.response.ajax.success - checkForSuccess - Request was successful."),e.logDebug("chains.response.ajax.success - checkForSuccess - success:"),e.logDebug(t))}}),t.getScope().chains.response.success.add({name:"removeLoading",fire:function(t,n){void 0!==e.dom.getFirst(".loadingRow",n.moiScope.target).innerHTML&&e.dom.helpers.getClosest(e.dom.getFirst(".loadingRow",n.moiScope.target),".klevuWrap").remove()}}),t.getScope().chains.response.success.add({name:"processByType",fire:function(t,n){var s=e.dom.getFirst(".ksMoiChatWraper[data-chat='"+n.moiScope.mode.mode+"'] "+e.getSetting(n.moiScope.settings,"settings.moi.buttonsBox"),n.moiScope.target);1==s.nodeType&&(s.innerHTML="");var a=e.dom.getFirst(".ksMoiChatWraper[data-chat='"+n.moiScope.mode.mode+"'] "+e.getSetting(n.moiScope.settings,"settings.moi.menuBox"),n.moiScope.target);1==a.nodeType&&(a.innerHTML=""),e.each(t.response,(function(t,s){if("object"==typeof s){var a=e.getObjectPath(n.moiScope,"chains.process.processLine");if(!e.isUndefined(a)&&0!==a.list().length){a.setScope(n.moiElem);var i={line:s};a.setData(i),a.fire()}}}))}}),t.getScope().chains.process.actions.add({name:"clearChat",fire:function(t,n){if("clearChat"===t.type&&1==t.context.value){var s=e.dom.find(e.getSetting(n.moiScope.settings,"settings.moi.chatList")+"[data-chat='"+n.moiScope.mode.mode+"']> div",n.moiScope.target);e.each(s,(function(e,t){t.parentNode.removeChild(t)}))}}}),t.getScope().chains.process.actions.add({name:"redirectToUrl",fire:function(t,n){"redirectToUrl"===t.type&&null!==t.context.link&&setTimeout((function(){window.location.href=t.context.link}),e.getSetting(n.moiScope.settings,"settings.moi.redirectDelay",2e3))}}),t.getScope().chains.process.actions.add({name:"openMenu",fire:function(t,n){"openMenu"===t.type&&1==t.context.value&&e.dom.getFirst(e.getSetting(n.moiScope.settings,"settings.moi.menuBoxButton"),n.moiScope.target).click()}}),t.getScope().chains.process.actions.add({name:"closeChat",fire:function(t,n){"closeChat"===t.type&&1==t.context.value&&e.dom.getFirst(e.getSetting(n.moiScope.settings,"settings.moi.closeChat"),n.moiScope.target).click()}}),t.getScope().chains.process.actions.add({name:"purgeHistory",fire:function(t,n){if("purgeHistory"===t.type&&"purgeHistory"===t.context.value){var s=n.moiScope.history.getElement("chat");s=(s="chat"===s?new Array:JSON.parse(s)).slice(-2),n.moiScope.history.addElement("chat",JSON.stringify(s)),n.moiScope.history.mergeToGlobal();var a=e.dom.find(e.getSetting(n.moiScope.settings,"settings.moi.chatList")+"[data-chat='"+n.moiScope.mode.mode+"']> div",n.moiScope.target),i=a.length;e.each(a,(function(e,t){i-2>e&&t.parentNode.removeChild(t)}))}}}),t.getScope().chains.process.display.add({name:"displayDate",fire:function(t,n){if("message"===t.displayType||"filter"===t.displayType||"product"===t.displayType){var s=e.getSetting(n.moiScope.settings,"settings.moi.lastMessage",0);if("date"in t||(t.date=e.time.timestamp()),e.setSetting(n.moiScope.settings,"settings.moi.lastMessage",t.date),s+e.getSetting(n.moiScope.settings,"settings.moi.dateDelay")<t.date){var a=new Date(1e3*t.date);n.moiScope.template.setData({message:a.toLocaleDateString("default",{month:"short",day:"numeric",year:"numeric"})+" "+a.toLocaleTimeString(),settings:{imageLocation:e.getGlobalSetting("moi.imageLocation","https://js.klevu.com/components/moi/v2/images")}});var i={type:"line",tpl:n.moiScope.template.convertTemplate(n.moiScope.template.render("date"))},o=e.getObjectPath(n.moiScope,"chains.process.render");e.isUndefined(o)||0===o.list().length||(o.setScope(n.moiElem),o.setData(i),o.fire())}}}}),t.getScope().chains.process.display.add({name:"displayMessage",fire:function(t,n){if("message"===t.displayType){t.message=e.md.parser(t.message),n.moiScope.template.setData({className:t.type,message:t.message,note:t.note,explain:t.explain,settings:{imageLocation:e.getGlobalSetting("moi.imageLocation","https://js.klevu.com/components/moi/v2/images")}});var s={type:"line",tpl:n.moiScope.template.convertTemplate(n.moiScope.template.render("message"))},a=e.getObjectPath(n.moiScope,"chains.process.render");e.isUndefined(a)||0===a.list().length||(a.setScope(n.moiElem),a.setData(s),a.fire()),t.tpl=s.tpl}}}),t.getScope().chains.process.display.add({name:"displayLoading",fire:function(t,n){if("loading"===t.displayType){n.moiScope.template.setData({className:t.type,message:t.message,settings:{imageLocation:e.getGlobalSetting("moi.imageLocation","https://js.klevu.com/components/moi/v2/images")}});var s={type:"line",tpl:n.moiScope.template.convertTemplate(n.moiScope.template.render("loading"))},a=e.getObjectPath(n.moiScope,"chains.process.render");e.isUndefined(a)||0===a.list().length||(a.setScope(n.moiElem),a.setData(s),a.fire())}}}),t.getScope().chains.process.display.add({name:"displayFilters",fire:function(t,n){if("filter"===t.displayType){n.moiScope.template.setData({className:e.getSetting(n.moiScope.settings,"settings.moi.leftClass",!1),message:t.filter.settings.label,options:t.filter.options,chatValue:t.filter.settings.chatFormat,chatEmptyValue:t.filter.settings.chatFormatEmpty,note:t.note,settings:{imageLocation:e.getGlobalSetting("moi.imageLocation","https://js.klevu.com/components/moi/v2/images")}});var s={type:"line",tpl:n.moiScope.template.convertTemplate(n.moiScope.template.render("filters"))},a=e.getObjectPath(n.moiScope,"chains.process.render");e.isUndefined(a)||0===a.list().length||(a.setScope(n.moiElem),a.setData(s),a.fire()),t.tpl=s.tpl}}}),t.getScope().chains.process.display.add({name:"displayProducts",fire:function(t,n){if("product"===t.displayType){n.moiScope.template.setData({className:e.getSetting(n.moiScope.settings,"settings.moi.leftClass",!1),products:t.products,note:t.note,settings:{imageLocation:e.getGlobalSetting("moi.imageLocation","https://js.klevu.com/components/moi/v2/images")}});var s={type:"line",tpl:n.moiScope.template.convertTemplate(n.moiScope.template.render("product"))},a=e.getObjectPath(n.moiScope,"chains.process.render");e.isUndefined(a)||0===a.list().length||(a.setScope(n.moiElem),a.setData(s),a.fire()),t.tpl=s.tpl}}}),t.getScope().chains.process.display.add({name:"displayMenu",fire:function(t,n){if("menu"===t.displayType){n.moiScope.template.setData({buttons:t.options,settings:{imageLocation:e.getGlobalSetting("moi.imageLocation","https://js.klevu.com/components/moi/v2/images")}});var s={type:"menu",optionCount:t.options.length,tpl:n.moiScope.template.convertTemplate(n.moiScope.template.render("menu"))},a=e.getObjectPath(n.moiScope,"chains.process.render");e.isUndefined(a)||0===a.list().length||(a.setScope(n.moiElem),a.setData(s),a.fire()),t.tpl=s.tpl}}}),t.getScope().chains.process.display.add({name:"displayButtons",fire:function(t,n){if("buttons"===t.displayType){n.moiScope.template.setData({buttons:t.options,settings:{imageLocation:e.getGlobalSetting("moi.imageLocation","https://js.klevu.com/components/moi/v2/images")}});var s={type:"buttons",optionCount:t.options.length,tpl:n.moiScope.template.convertTemplate(n.moiScope.template.render("buttons"))},a=e.getObjectPath(n.moiScope,"chains.process.render");e.isUndefined(a)||0===a.list().length||(a.setScope(n.moiElem),a.setData(s),a.fire()),t.tpl=s.tpl}}}),t.getScope().chains.process.display.add({name:"saveHistory",fire:function(t,n){if(!0!==t.fromHistory&&"message"===t.displayType&&"general"===n.moiScope.mode.mode){var s=n.moiScope.history.getElement("chat");s="chat"===s?new Array:JSON.parse(s),t.date=e.time.timestamp(),s.push({type:"message",from:t.type,data:t}),n.moiScope.history.addElement("chat",JSON.stringify(s)),n.moiScope.history.mergeToGlobal()}}}),t.getScope().chains.process.events.add({name:"message",fire:function(t,n){"message"===t.eventType&&e.each(e.dom.find(e.getSetting(n.moiScope.settings,"settings.moi.explainButton",".kumoiExplainButton"),t.tpl),(function(t,s){e.isUndefined(e.moiEvents)||e.isUndefined(e.moiEvents.message)||e.moiEvents.message.openCloseExplain(s,n)}))}}),t.getScope().chains.process.events.add({name:"filters",fire:function(t,n){"filter"===t.eventType&&e.each(e.dom.find(e.getSetting(n.moiScope.settings,"settings.moi.filterAction"),t.tpl),(function(t,s){e.isUndefined(e.moiEvents)||e.isUndefined(e.moiEvents.filters)||e.moiEvents.filters.moiFiltersClick(s,n)}))}}),t.getScope().chains.process.events.add({name:"products",fire:function(t,n){"product"===t.eventType&&(e.each(e.dom.find(e.getSetting(n.moiScope.settings,"settings.moi.productAction"),t.tpl),(function(t,s){e.isUndefined(e.moiEvents)||e.isUndefined(e.moiEvents.product)||e.moiEvents.product.moiProductIntent(s,n)})),e.each(e.dom.find(e.getSetting(n.moiScope.settings,"settings.moi.productDirectLink"),t.tpl),(function(t,s){e.isUndefined(e.moiEvents)||e.isUndefined(e.moiEvents.product)||e.moiEvents.product.moiProductClick(s,n)})))}}),t.getScope().chains.process.events.add({name:"menu",fire:function(t,n){"menu"===t.eventType&&e.each(e.dom.find(e.getSetting(n.moiScope.settings,"settings.moi.menuAction"),t.tpl),(function(t,s){e.isUndefined(e.moiEvents)||e.isUndefined(e.moiEvents.menu)||e.moiEvents.menu.moiMenuClick(s,n)}))}}),t.getScope().chains.process.events.add({name:"buttons",fire:function(t,n){"buttons"===t.eventType&&e.each(e.dom.find(e.getSetting(n.moiScope.settings,"settings.moi.buttonAction"),t.tpl),(function(t,s){e.isUndefined(e.moiEvents)||e.isUndefined(e.moiEvents.buttons)||e.moiEvents.buttons.moiButtonsClick(s,n)}))}}),t.getScope().chains.process.render.add({name:"renderLine",fire:function(t,n){if("line"===t.type){var s=e.dom.getFirst(e.getSetting(n.moiScope.settings,"settings.moi.chatList")+"[data-chat='"+n.moiScope.mode.mode+"']",n.moiScope.target);return 1==s.nodeType&&(s.appendChild(t.tpl),e.moiEvents.display.scrollToBottom(),!0)}}}),t.getScope().chains.process.render.add({name:"renderMenu",fire:function(t,n){if("menu"===t.type){var s=e.dom.getFirst(".ksMoiChatWraper[data-chat='"+n.moiScope.mode.mode+"'] "+e.getSetting(n.moiScope.settings,"settings.moi.menuBox"),n.moiScope.target),a=e.dom.getFirst(".ksMoiChatWraper[data-chat='"+n.moiScope.mode.mode+"'] "+e.getSetting(n.moiScope.settings,"settings.moi.menuBoxButton"),n.moiScope.target);1==s.nodeType&&(0==t.optionCount?a.classList.add(e.getSetting(n.moiScope.settings,"settings.moi.disabledClass")):a.classList.remove(e.getSetting(n.moiScope.settings,"settings.moi.disabledClass")),s.appendChild(t.tpl),t.tpl=s)}}}),t.getScope().chains.process.render.add({name:"renderButtons",fire:function(t,n){if("buttons"===t.type){var s=e.dom.getFirst(".ksMoiChatWraper[data-chat='"+n.moiScope.mode.mode+"'] "+e.getSetting(n.moiScope.settings,"settings.moi.buttonsBox"),n.moiScope.target);1==s.nodeType&&(t.optionCount>0?s.classList.add(e.getSetting(n.moiScope.settings,"settings.moi.activeClass")):s.classList.remove(e.getSetting(n.moiScope.settings,"settings.moi.activeClass")),s.appendChild(t.tpl),e.isUndefined(e.moiEvents)||e.isUndefined(e.moiEvents.display)||e.isUndefined(e.moiEvents.display.fixView)||e.moiEvents.display.fixView(n),t.tpl=s)}}}),t.getScope().chains.process.processLine.add({name:"initDate",fire:function(t,n){"date"in t.line||(t.line.date=e.time.timestamp())}}),t.getScope().chains.process.processLine.add({name:"context",fire:function(t,n){"context"in t.line&&(e.isUndefined(t.line.context.sessionId)||e.setSetting(n.moiScope.settings,"settings.moi.sessionId",t.line.context.sessionId))}}),t.getScope().chains.process.processLine.add({name:"message",fire:function(t,n){if("message"in t.line&&"text"===t.line.message.type){var s=e.getObjectPath(n.moiScope,"chains.process.display");if(!e.isUndefined(s)&&0!==s.list().length){s.setScope(n.moiElem);var a={displayType:"message",type:e.getSetting(n.moiScope.settings,"settings.moi.leftClass"),message:t.line.message.value,note:t.line.message.note,explain:t.line.message.explain,date:t.line.date,tpl:null};if(s.setData(a),s.fire(),s=e.getObjectPath(n.moiScope,"chains.process.events"),!e.isUndefined(s)&&0!==s.list().length){s.setScope(n.moiElem);var i={eventType:"message",message:t.line.message.value,note:t.line.message.note,explain:t.line.message.explain,tpl:a.tpl};s.setData(i),s.fire()}}}}}),t.getScope().chains.process.processLine.add({name:"filter",fire:function(t,n){if("filter"in t.line){var s=e.getObjectPath(n.moiScope,"chains.process.display");if(!e.isUndefined(s)&&0!==s.list().length){s.setScope(n.moiElem);var a={displayType:"filter",filter:t.line.filter,note:t.line.filter.note,date:t.line.date,tpl:null};if(s.setData(a),s.fire(),s=e.getObjectPath(n.moiScope,"chains.process.events"),!e.isUndefined(s)&&0!==s.list().length){s.setScope(n.moiElem);var i={eventType:"filter",filter:t.line.filter,tpl:a.tpl};s.setData(i),s.fire()}}}}}),t.getScope().chains.process.processLine.add({name:"products",fire:function(t,n){if("productData"in t.line){var s=e.getObjectPath(n.moiScope,"chains.process.display");if(!e.isUndefined(s)&&0!==s.list().length){s.setScope(n.moiElem);var a={displayType:"product",products:t.line.productData.products,note:t.line.productData.note,date:t.line.date,tpl:null};if(s.setData(a),s.fire(),s=e.getObjectPath(n.moiScope,"chains.process.events"),!e.isUndefined(s)&&0!==s.list().length){s.setScope(n.moiElem);var i={eventType:"product",products:t.line.productData.products,tpl:a.tpl};s.setData(i),s.fire()}}}}}),t.getScope().chains.process.processLine.add({name:"menu",fire:function(t,n){if("menuOptions"in t.line){var s=e.getObjectPath(n.moiScope,"chains.process.display");if(!e.isUndefined(s)&&0!==s.list().length){s.setScope(n.moiElem);var a={displayType:"menu",options:t.line.menuOptions.options,tpl:null};if(s.setData(a),s.fire(),s=e.getObjectPath(n.moiScope,"chains.process.events"),!e.isUndefined(s)&&0!==s.list().length){s.setScope(n.moiElem);var i={eventType:"menu",options:t.line.menuOptions.options,tpl:a.tpl};s.setData(i),s.fire()}}}}}),t.getScope().chains.process.processLine.add({name:"buttons",fire:function(t,n){if("genericOptions"in t.line){var s=e.getObjectPath(n.moiScope,"chains.process.display");if(!e.isUndefined(s)&&0!==s.list().length){s.setScope(n.moiElem);var a={displayType:"buttons",options:t.line.genericOptions.options,tpl:null};if(s.setData(a),s.fire(),s=e.getObjectPath(n.moiScope,"chains.process.events"),!e.isUndefined(s)&&0!==s.list().length){s.setScope(n.moiElem);var i={eventType:"buttons",options:t.line.genericOptions.options,tpl:a.tpl};s.setData(i),s.fire()}}}}}),t.getScope().chains.process.processLine.add({name:"actions",fire:function(t,n){"actions"in t.line&&t.line.actions.actions.length&&e.each(t.line.actions.actions,(function(t,s){var a=e.getObjectPath(n.moiScope,"chains.process.actions");if(!e.isUndefined(a)&&0!==a.list().length){a.setScope(n.moiElem);var i={type:s.type,context:s.context};a.setData(i),a.fire()}}))}}),t.getScope().chains.process.processLine.add({name:"saveHistory",fire:function(t,n){if(!0!==t.fromHistory&&"general"===n.moiScope.mode.mode){var s=n.moiScope.history.getElement("chat");s="chat"===s?new Array:JSON.parse(s),"context"in t.line&&(e.isUndefined(t.line.context.sessionId)||n.moiScope.history.addElement("sessionId",t.line.context.sessionId)),"menuOptions"in t.line&&n.moiScope.history.addElement("menuOptions",JSON.stringify(t)),"genericOptions"in t.line&&n.moiScope.history.addElement("genericOptions",JSON.stringify(t)),"filter"in t.line&&s.push({type:"filter",from:e.getSetting(n.moiScope.settings,"settings.moi.leftClass"),data:t}),"productData"in t.line&&s.push({type:"products",from:e.getSetting(n.moiScope.settings,"settings.moi.leftClass"),data:t}),s.length>e.getSetting(n.moiScope.settings,"settings.moi.historySize",100)&&s.splice(0,10),n.moiScope.history.addElement("chat",JSON.stringify(s)),n.moiScope.history.mergeToGlobal()}}}),t.getScope().chains.process.processLine.add({name:"fadeInEffect",fire:function(t,n){const s="settings.moi.intervalFadeIn";if(!0!==t.fromHistory){e.getSetting(n.moiScope.settings,s,!1)||e.setSetting(n.moiScope.settings,s,setInterval((function(){const t=e.dom.getFirst(".fromkumoi:not(.moiFadeIn):not(.moiFromHistory)");t.classList?t.classList.add("moiFadeIn"):(clearInterval(e.getSetting(e.getGlobalSetting("moi.box",e.moi.base).getScope().settings,s)),e.setSetting(n.moiScope.settings,s,!1))}),e.getGlobalSetting("moi.fadeInMessageDelay",300)))}else{const t=e.dom.find(".kumoichatRow");t.length>0&&e.each(t,(function(e,t){t.classList.add("moiFromHistory")}))}}}),e.moi={base:t},e.moi.build=!0,e.support.register({name:"moi",loaded:!0,active:!0,dependency:["core.lib"]})}(klevu),function(e){e.extend(!0,e,{component:{nlp:{varsion:"1.0.0",utility:{sendAnnotationsRequest:function(t){t.type="annotations",e.component.nlp.utility.getByType(t)},getByType:function(t){var n=e.getObjectPath(e.component.nlp,"utility.chains.getByType");e.isUndefined(n)||0===n.list().length||(n.setScope({}),n.setData(t),n.fire())},chains:{getByType:e.chain({stopOnFalse:!0})}}}}}),e.support.register({name:"nlp",loaded:!0,active:!0,dependency:["core.lib"]}),e.component.nlp.utility.chains.getByType.add({name:"getAnnotationsData",fire:function(t,n){if("annotations"===t.type){var s=e.getObjectPath(t,"settings.apiKey",e.getGlobalSetting("search.apiKey",e.getGlobalSetting("global.apiKey",!1)));if(!s)return;var a=e.getObjectPath(t,"settings.url","https://nlp-services.ksearchnet.com/"+s+"/annotations");if(e.isUndefined(t.data)||e.isUndefined(t.data.query))return void(e.getGlobalSetting("console.type.nlp",!1)&&e.logWarning("NLP - Annotations - No query supplied"));if(e.isUndefined(t.data)||e.isUndefined(t.data.title))return void(e.getGlobalSetting("console.type.nlp",!1)&&e.logWarning("NLP - Annotations - No title supplied"));if(e.isUndefined(t.data)||e.isUndefined(t.data.category))return void(e.getGlobalSetting("console.type.nlp",!1)&&e.logWarning("NLP - Annotations - No category supplied"));if(e.isUndefined(t.data)||e.isUndefined(t.data.languageCode))return void(e.getGlobalSetting("console.type.nlp",!1)&&e.logWarning("NLP - Annotations - No languageCode supplied"));var i={url:a,data:{query:encodeURIComponent(t.data.query),title:encodeURIComponent(t.data.title),category:encodeURIComponent(t.data.category),languageCode:t.data.languageCode}};e.isUndefined(t.callbacks)||(i.callbacks=t.callbacks);var o={options:i,settings:t.settings,callbacks:{success:function(t,n,s,a){e.getGlobalSetting("console.type.nlp",!1)&&e.logInfo("NLP - Annotations - Request has returned as success");var i=[{status:s,isSuccess:a,requestDetails:n,data:t}];e.getObjectPath(n.options,"callbacks.success",[]).length>0&&e.each(n.options.callbacks.success,(function(e,t){t.fire.apply(this,i)}))},error:function(t,n,s){e.getGlobalSetting("console.type.nlp",!1)&&e.logInfo("NLP - Annotations - Request has returned as error");var a=[{status:n,isSuccess:s,requestDetails:t}];e.getObjectPath(t.options,"callbacks.error",[]).length>0&&e.each(t.options.callbacks.error,(function(e,t){t.fire.apply(this,a)}))}}},c={url:i.url+"?"+e.queryString(i.data),type:e.getGlobalSetting("component.nlp.annotations.sendMethod","FETCH"),method:"GET",crossDomain:!0,mimeType:"application/json; charset=UTF-8",contentType:"application/json; charset=utf-8"};c.success=o.callbacks.success,c.error=o.callbacks.error,e.getGlobalSetting("console.type.nlp",!1)&&e.logInfo("NLP - Annotations - Request has been send"),e.request(c,o)}}})}(klevu),function(e){var t={markAllResourcesLoaded:function(t){e.isUndefined(t)&&(t=!0),e.extensions.abTest.resourcesLoaded=!0,e.getGlobalSetting("console.type.abtest")&&e.logDebug("ABTEST - Data ready to be used"),"function"==typeof klevu_processABTestInputData&&klevu_processABTestInputData(),t&&e.extensions.abTest.base.processData()},processData:function(){var t=e.getGlobalSetting("search.apiKey",e.getGlobalSetting("global.apiKey")),n=e.getObjectPath(e.extensions,"abTest.abtestDictionary"),s=JSON.parse(n.getElement(t)),a={};e.isEmptyObject(s.CAT_NAV)||e.each(s.CAT_NAV,(function(e,t){a[t.sourceId.toLowerCase()]=t})),e.extensions.abTest.catnav=a},loadCallBack:function(t,n){var s=e.getObjectPath(e.extensions,"abTest.abtestDictionary"),a=s.getElement(n.apiKey);if(!e.isUndefined(t.assigned)&&t.assigned.length>0){t=t.assigned;var i={CAT_NAV:{},RECS:{},SEARCH:{}};e.each(t,(function(e,t){switch(t.clicked=!1,t.send=!1,t.type){case"CAT_NAV":i.CAT_NAV[t.abTestId+t.sourceId.toLowerCase()]=t;break;case"RECS":i.RECS[t.abTestId+t.sourceId]=t;break;case"SEARCH":i.SEARCH[t.abTestId+t.sourceId]=t}})),a===n.apiKey||(a=JSON.parse(a),e.isEmptyObject(a.CAT_NAV)||e.each(a.CAT_NAV,(function(t,n){e.isUndefined(n.clicked)||!0!==n.clicked||e.isUndefined(i.CAT_NAV[n.abTestId+n.sourceId.toLowerCase()])||(i.CAT_NAV[n.abTestId+n.sourceId.toLowerCase()].clicked=n.clicked,i.CAT_NAV[n.abTestId+n.sourceId.toLowerCase()].abTestVariantId=n.abTestVariantId),e.isUndefined(n.send)||!0!==n.send||e.isUndefined(i.CAT_NAV[n.abTestId+n.sourceId.toLowerCase()])||(i.CAT_NAV[n.abTestId+n.sourceId.toLowerCase()].send=n.send)})),e.isEmptyObject(a.RECS)||e.each(a.RECS,(function(t,n){e.isUndefined(n.clicked)||!0!==n.clicked||e.isUndefined(i.RECS[n.abTestId+n.sourceId])||(i.RECS[n.abTestId+n.sourceId].clicked=n.clicked,i.RECS[n.abTestId+n.sourceId].abTestVariantId=n.abTestVariantId),e.isUndefined(n.send)||!0!==n.send||e.isUndefined(i.RECS[n.abTestId+n.sourceId])||(i.RECS[n.abTestId+n.sourceId].send=n.send)})),e.isEmptyObject(a.SEARCH)||e.each(a.SEARCH,(function(t,n){e.isUndefined(n.clicked)||!0!==n.clicked||e.isUndefined(i.SEARCH[n.abTestId+n.sourceId])||(i.SEARCH[n.abTestId+n.sourceId].clicked=n.clicked,i.SEARCH[n.abTestId+n.sourceId].abTestVariantId=n.abTestVariantId),e.isUndefined(n.send)||!0!==n.send||e.isUndefined(i.SEARCH[n.abTestId+n.sourceId])||(i.SEARCH[n.abTestId+n.sourceId].send=n.send)}))),a=i}if(a.timeOfLoad=e.time.timestamp(),s.addElement(n.apiKey,JSON.stringify(a)),s.overrideGlobal(),e.extensions.abTest.loadCounter===n.totalToLoad){var o=e.getObjectPath(e.extensions,"abTest.abTestData");e.isUndefined(o)&&(e.extensions.abTest.abTestData=JSON.parse(s.getElement(n.apiKey))),e.extensions.abTest.base.markAllResourcesLoaded(!1)}},loadAbTestData:function(t){e.extensions.abTest.resourceLoadInitiated=!0,e.extensions.abTest.loadCounter=0;var n=e.search.modules.kmcInputs.base.getDataPath("klevu_apiDomain");if(!e.isUndefined(n)){var s=[{id:t,src:"https://"+n+"/abtest/public/allocation/"+t}];s.forEach((function(n){var a={url:n.src,type:"json",mimeType:"application/json",apiKey:t,totalToLoad:s.length},i={success:function(t,n,s,a){e.extensions.abTest.loadCounter++,e.extensions.abTest.base.loadCallBack(t,n)},error:function(t,n,s,a){e.extensions.abTest.loadCounter++,e.extensions.abTest.base.loadCallBack(t,n)},options:a},o={url:a.url,type:"FETCH",method:"POST",mimeType:a.mimeType,crossDomain:!0,success:function(e,t,n,s){t.success(e,t.options,n,s)},error:function(e,t,n){e.error({},e.options,t,n)}};e.request(o,i)}))}},getDataPath:function(t){var n,s=e.getObjectPath(e.extensions,"abTest.abTestData."+t);return window&&(n=e.getInterfaceObjectPath(window,t)),e.isUndefined(n)?s:n},setClickedEvent:function(t,n){var s=e.getGlobalSetting("search.apiKey",e.getGlobalSetting("global.apiKey")),a=e.getObjectPath(e.extensions,"abTest.abtestDictionary"),i=JSON.parse(a.getElement(s));e.isUndefined(i[n])||e.isEmptyObject(i[n])||e.isUndefined(i[n][t])||(i[n][t].clicked=!0,a.addElement(s,JSON.stringify(i)),a.overrideGlobal())},usageTrack:function(t,n){var s=e.getGlobalSetting("search.apiKey",e.getGlobalSetting("global.apiKey")),a=e.getObjectPath(e.extensions,"abTest.abtestDictionary"),i=JSON.parse(a.getElement(s)),o={};if(!(e.isUndefined(i[n])||e.isEmptyObject(i[n])||e.isUndefined(i[n][t])||!1!==i[n][t].send||!0!==i[n][t].clicked)){o={sourceId:i[n][t].sourceId,abTestId:i[n][t].abTestId,abTestVariantId:i[n][t].abTestVariantId,type:i[n][t].type};var c=e.search.modules.kmcInputs.base.getDataPath("klevu_apiDomain");if(!e.isUndefined(c)){var r={url:"https://"+c+"/abtest/public/usage/"+s,type:"json",mimeType:"application/json",data:JSON.stringify(o)},l={success:function(t,n,s,a){var i=e.getGlobalSetting("search.apiKey",e.getGlobalSetting("global.apiKey")),o=e.getObjectPath(e.extensions,"abTest.abtestDictionary"),c=JSON.parse(o.getElement(i)),r=JSON.parse(n.data);e.isUndefined(c[r.type])||e.isEmptyObject(c[r.type])||e.isUndefined(c[r.type][r.abTestId+r.sourceId.toLowerCase()])||(204===parseInt(s)?(delete c[r.type][r.abTestId+r.sourceId.toLowerCase()],!1!==e.getObjectPath(e.extensions,"abTest.catnav."+r.sourceId.toLowerCase(),!1)&&delete e.extensions.abTest.catnav[r.sourceId.toLowerCase()]):c[r.type][r.abTestId+r.sourceId.toLowerCase()].send=!0,o.addElement(i,JSON.stringify(c)),o.overrideGlobal()),e.getGlobalSetting("console.type.abtest")&&e.logDebug("ABTEST - Usage confirmed")},error:function(t,n,s,a){e.getGlobalSetting("console.type.abtest")&&e.logDebug("ABTEST - Usage error")},options:r},u={url:r.url,type:"FETCH",method:"POST",data:r.data,mimeType:r.mimeType,crossDomain:!0,success:function(e,t,n,s){t.success(e,t.options,n,s)},error:function(e,t,n){e.error({},e.options,t,n)}};e.request(u,l)}}}};e.extend(!0,e,{extensions:{abTest:{base:t,build:!0,resourcesLoaded:!1,resourceLoadInitiated:!1}}})}(klevu),klevu.settings.chains.initChain.add({name:"abTestKmcCheck",fire:function(e,t){var n=klevu.getGlobalSetting("powerUp.abTest");if(klevu.isUndefined(n)||!1!==n){var s=klevu.getGlobalSetting("kmc.loaded");if(!klevu.isUndefined(s)&&!0===s){var a=klevu.search.modules.kmcInputs.base.getDataPath("klevu_abTestActive");if(void 0!==a&&!0===JSON.parse(a))klevu.setObjectPath(e,"powerUp.abTest",!0);else{var i=klevu.dictionary("abTest");i.setStorage("local"),i.overrideGlobal()}}}}}),klevu.settings.chains.initChain.add({name:"abTestPowerUp",fire:function(e,t){var n=klevu.getGlobalSetting("search.apiKey",klevu.getGlobalSetting("global.apiKey"));if(!klevu.isUndefined(n)){var s=klevu.getGlobalSetting("powerUp.abTest");if(!klevu.isUndefined(s)&&!1===s)return;if(!0!==s)return;var a=klevu.getObjectPath(klevu.extensions,"abTest.resourcesLoaded");if(!klevu.isUndefined(a)&&!0===a)return;klevu.getGlobalSetting("console.type.abTest")&&klevu.logDebug("abTest - Api key found , Starting abTest powerUp");var i=klevu.getObjectPath(klevu.extensions,"abTest.abtestDictionary");klevu.isUndefined(i)&&((i=klevu.dictionary("abTest")).setStorage("local"),i.mergeFromGlobal(),klevu.setObjectPath(klevu.extensions,"abTest.abtestDictionary",i),klevu.getGlobalSetting("console.type.abTest")&&klevu.logDebug("abTest - dictionary set"));var o=i.getElement(n),c=!0;if(n!==o)(o=JSON.parse(o)).timeOfLoad+parseInt(klevu.getGlobalSetting("abTest.invalidateInterval",1200))>klevu.time.timestamp()?c=!1:klevu.extensions.abTest.base.processData(),klevu.setObjectPath(klevu.extensions,"abTest.abTestData",o),klevu.getGlobalSetting("console.type.abTest")&&klevu.logDebug("abTest - abTest data set from localStorage");if(c){var r=klevu.getObjectPath(klevu.extensions,"abTest.resourceLoadInitiated");(klevu.isUndefined(r)||!1===r)&&(klevu.extensions.abTest.base.loadAbTestData(n),klevu.getGlobalSetting("console.type.abTest")&&klevu.logDebug("abTest - File loading started"))}else klevu.getGlobalSetting("console.type.abTest")&&klevu.logDebug("abTest - File loading skipped"),klevu.extensions.abTest.base.markAllResourcesLoaded()}}}),klevu.analytics.base.getScope().chains.events.catview.addBefore("viewRequestCheck",{name:"addABTest",fire:function(e,t){var n=klevu.getObjectPath(e.request.analytics,"klevu_abTestId",!1),s=klevu.getObjectPath(e.request.analytics,"klevu_abTestSource",!1);delete e.request.analytics.klevu_abTestSource,n&&s&&klevu.extensions.abTest.base.usageTrack(n+s,"CAT_NAV")}}),function(e){e({}),e.support.register({name:"abTest",loaded:!0,active:!0,dependency:["core.lib"]})}(klevu),function(e){var t={submit:function(t){var n=e.getObjectPath(e.modules,"imageUpload.base.chains.submitFormChain");e.isUndefined(n)||0===n.list().length||(n.setScope({}),n.setData(t),n.fire())},chains:{submitChain:e.chain({stopOnFalse:!0}),submitFormChain:e.chain({stopOnFalse:!0})}};e.extend(!0,e,{modules:{imageUpload:{base:t}}}),e.modules.imageUpload.base.chains.submitChain.add({name:"submitController",fire:function(t,n){if("form"===e.getObjectPath(t,"type","")){var s=e.modules.imageUpload.base.submitFormChain;e.isUndefined(s)||0===s.list().length||(s.setScope(n),s.setData(t),s.fire())}}}),e.modules.imageUpload.base.chains.submitFormChain.add({name:"submitForm",fire:function(t,n){var s={url:e.getGlobalSetting("url.imageUpload","https://api.ksearchnet.com/image/store/")+e.getGlobalSetting("search.apiKey",e.getGlobalSetting("global.apiKey")),data:t},a={options:s,callbacks:{success:function(t,n,s,a){var i=e.getObjectPath(n.options,"data.callbacks.success",!1),o=e.getObjectPath(n.options,"data.scope",!1);if(t.status=s,t.isSuccess=a,i&&o&&!e.isUndefined(t.url)){var c=e.getObjectPath(o.kScope,i);e.isUndefined(c)||0===c.list().length||(c.setScope(o.kElem),c.setData(t),c.fire())}else{var r=e.getObjectPath(n.options,"data.callbacks.error",!1);if(r&&o){var l=e.getObjectPath(o.kScope,r);e.isUndefined(l)||0===l.list().length||(l.setScope(o.kElem),l.setData(t),l.fire())}}},error:function(n,s,a){var i=e.getObjectPath(n.options,"data.callbacks.error",!1),o=e.getObjectPath(n.options,"data.scope",!1);if(t.status=s,t.isSuccess=a,i&&o){var c=e.getObjectPath(o.kScope,i);e.isUndefined(c)||0===c.list().length||(c.setScope(o.kElem),c.setData(t),c.fire())}}}},i=new FormData;i.append("image",t.source.files[0]);var o={url:s.url,type:"FETCH",method:"POST",crossDomain:!0,processData:!1,contentType:!1,data:i};o.success=a.callbacks.success,o.error=a.callbacks.error,e.request(o,a)}}),e.extend(!0,e,{modules:{imageUpload:{build:!0}}});e({modules:{imageUpload:{build:!0}}}),e.support.register({name:"imageUpload",loaded:!0,active:!0,dependency:["core.lib"]})}(klevu),klevu.settings.chains.initChain.add({name:"imageUploadKmcCheck",fire:function(e,t){var n=klevu.getGlobalSetting("powerUp.imageUpload");if(klevu.isUndefined(n)){var s=klevu.getGlobalSetting("kmc.loaded");if(!klevu.isUndefined(s)&&!0===s){var a=klevu.search.modules.kmcInputs.base.getDataPath("klevu_imageSearchActive");if(void 0!==a&&!0===JSON.parse(a)){if("function"==typeof FormData&&window.fetch)return klevu.setObjectPath(e,"powerUp.imageUpload",!0),void klevu.setObjectPath(e,"theme.modules.imageSearch.enable",!0);klevu.setObjectPath(e,"powerUp.imageUpload",!1),klevu.setObjectPath(e,"theme.modules.imageSearch.enable",!1)}}}}}),function(e){e.extend({pbEvents:{}}),e.extend(!0,e.pbEvents,{init:{build:{name:"init-pb",fire:function(){var t={elem:e.pb.base},n=e.pbEvents.init.buildChain;e.isUndefined(n)||0===n.list().length||(n.setScope(e.pb.base.getScope().element),n.setData(t),n.fire())}},buildChain:e.chain({stopOnFalse:!0})},request:{done:function(t){t.scope.pbObject.removeActiveFile(),0===e.getSetting(t.scope.pbScope.settings,"settings.pagebuild.activeFiles",0)&&e.event.fireChain(t.scope.pbScope,t.scope.pbScope.data.executeAfter,t.scope.pbScope.element,t.scope.pbScope.data,null)}}}),e.pbEvents.init.buildChain.add({name:"checkUrlOverides",fire:function(t,n){var s=e.getAllUrlParameters();s.length>0&&e.each(s,(function(t,s){e.strStartsWith(s.name,"klib_")&&(s.name=s.name.replace("klib_","").replace(new RegExp(/_/,"g"),"."),e.setSetting(n.pbScope.settings,"settings."+s.name,s.value))}))}}),e.pbEvents.init.buildChain.add({name:"powerUp",fire:function(t,n){e.event.fireChain(n.pbScope,"chains.coreLoad",n.pbScope.element,n.pbScope.data,null)}}),e.coreEvent.build({name:"buildPb",fire:function(){return!(!e.getSetting(e.settings,"settings.pagebuild.activate",!1)||!e.getSetting(e.settings,"settings.localSettings",!1)||!e.getSetting(e.settings,"settings.powerUp.pageBuilder",!1))}}),e.coreEvent.attach("buildPb",e.extend(!0,{},e.pbEvents.init.build)),e.extend({pbObjectBuild:function(){var t={settings:{}};function n(e){t.element=document.createElement("div"),t.element.pbObject=e,t.element.pbScope=t,t.element.pbElem=t.element}e.setObjectPath(t,"id",e.randomId()),e.setObjectPath(t,"chains.coreLoad",e.chain({stopOnFalse:!0})),e.setObjectPath(t,"chains.extraLoad",e.chain({stopOnFalse:!0})),e.setObjectPath(t,"chains.interactive",e.chain({stopOnFalse:!0})),t.data={apiKey:!1,pageId:!1,version:!1,url:!1,executeAfter:!1};var s={init:n,setScope:function(e){return t=e},getScope:function(){return t},addActiveFile:function(){t.settings.settings.pagebuild.activeFiles++},removeActiveFile:function(){t.settings.settings.pagebuild.activeFiles--}};return n(s),s},pbObjectClone:function(t){var n=e.pbObjectBuild();return n.setScope(e.extend(!0,{},t.getScope())),n.getScope().id=e.randomId(),n}});e({url:{pbSource:"//js.klevu.com/klevu-js-v2/pagebuilder/"},pagebuild:{active:!1,version:"published",nocache:!1,activeFiles:0},console:{type:{pb:!1}}})}(klevu),function(e){var t=e.pbObjectBuild();t.getScope().chains.coreLoad.add({name:"resetActiveFiles",fire:function(t,n){e.getSetting(n.pbScope.settings,"settings.pagebuild.activeFiles",0)>0&&e.settings.console.type.pb&&logInfo("PB - A new load can not start as last one did not finish"),e.setSetting(n.pbScope.settings,"settings.pagebuild.activeFiles",0)}}),t.getScope().chains.coreLoad.add({name:"getPageId",fire:function(t,n){if(t.pageId=e.getSetting(n.pbScope.settings,"settings.pagebuild.pageId",!1),!t.pageId)return e.settings.console.type.pb&&logInfo("PB - PageId can not be detected"),!1}}),t.getScope().chains.coreLoad.add({name:"getApikey",fire:function(t,n){if(t.apiKey=e.getSetting(n.pbScope.settings,"settings.pagebuild.apiKey",e.getSetting(n.pbScope.settings,"settings.search.apiKey",!1)),!t.apiKey)return e.settings.console.type.pb&&logInfo("PB - API key can not be detected"),!1}}),t.getScope().chains.coreLoad.add({name:"getVersion",fire:function(t,n){if(t.version=e.getSetting(n.pbScope.settings,"settings.pagebuild.version"),!t.version)return e.settings.console.type.pb&&logInfo("PB - Version can not be detected"),!1}}),t.getScope().chains.coreLoad.add({name:"getHostUrl",fire:function(t,n){t.url=e.settings.url.protocol+e.getSetting(n.pbScope.settings,"settings.url.pbSource")+t.apiKey+"/"+t.pageId+"/"+t.version}}),t.getScope().chains.coreLoad.add({name:"getCache",fire:function(t,n){if(t.nocache=e.getSetting(n.pbScope.settings,"settings.pagebuild.nocache",!1),"true"==t.nocache){e.settings.console.type.pb&&logInfo("PB - Nocache active");var s=Math.floor(900000001*Math.random())+1e8;t.nocache="?"+s}else t.nocache=""}}),t.getScope().chains.coreLoad.add({name:"setChainAfter",fire:function(e,t){e.executeAfter="chains.extraLoad"}}),t.getScope().chains.coreLoad.add({name:"loadJs",fire:function(t,n){n.pbObject.addActiveFile(),e.assets.getFile({url:t.url+".js"+t.nocache,type:"js",options:{scope:n,successCallback:e.pbEvents.request.done,errorCallback:e.pbEvents.request.done}})}}),t.getScope().chains.coreLoad.add({name:"loadCss",fire:function(t,n){n.pbObject.addActiveFile(),e.assets.getFile({url:t.url+".css"+t.nocache,type:"css",options:{scope:n,successCallback:e.pbEvents.request.done,errorCallback:e.pbEvents.request.done}})}}),t.getScope().chains.extraLoad.add({name:"setChainAfter",fire:function(e,t){e.executeAfter="chains.interactive"}}),e.pb={base:t},e.pb.build=!0}(klevu),function(e){e.extend(!0,e,{recs:{events:{}}}),e.extend(!0,e.recs.events,{init:{build:{name:"init-recs",fire:function(){var t={elem:e.recs.base},n=e.recs.events.init.buildChain;e.isUndefined(n)||0===n.list().length||(n.setScope(e.recs.base.getScope().element),n.setData(t),n.fire())}},buildChain:e.chain({stopOnFalse:!0})},request:{done:function(t){t.scope.recsObject.removeActiveFile(),0===e.getSetting(t.scope.recsScope.settings,"settings.recs.activeFiles",0)&&e.event.fireChain(t.scope.recsScope,t.scope.recsScope.data.powerUp.executeAfter,t.scope.recsScope.element,t.scope.recsScope.data,null)}}}),e.recs.events.init.buildChain.add({name:"checkUrlOverides",fire:function(t,n){var s=e.getAllUrlParameters();s.length>0&&e.each(s,(function(t,s){e.strStartsWith(s.name,"klib_")&&(s.name=s.name.replace("klib_","").replace(new RegExp(/_/,"g"),"."),e.setSetting(n.recsScope.settings,"settings."+s.name,s.value))}))}}),e.recs.events.init.buildChain.add({name:"powerUp",fire:function(t,n){e.event.fireChain(n.recsScope,"chains.core.coreLoad",n.recsScope.element,n.recsScope.data,null)}}),e.coreEvent.build({name:"buildRecs",fire:function(){return!!e.getSetting(e.settings,"settings.recs.activate",!1)}}),e.coreEvent.attach("buildRecs",e.extend(!0,{},e.recs.events.init.build)),e.extend(!0,e,{recs:{list:[],build:function(){var t={settings:{}};return e.setObjectPath(t,"id",e.randomId()),e.setObjectPath(t,"chains.core.coreLoad",e.chain({stopOnFalse:!0})),e.setObjectPath(t,"chains.core.extraLoad",e.chain({stopOnFalse:!0})),e.setObjectPath(t,"chains.core.interactive",e.chain({stopOnFalse:!0})),e.setObjectPath(t,"chains.actions.load",e.chain({stopOnFalse:!0})),e.setObjectPath(t,"chains.processors.settings",e.chain({stopOnFalse:!0})),e.setObjectPath(t,"chains.request.control",e.chain({stopOnFalse:!0})),e.setObjectPath(t,"chains.request.build",e.chain({stopOnFalse:!0})),e.setObjectPath(t,"chains.request.send",e.chain({stopOnFalse:!0})),e.setObjectPath(t,"chains.request.ajax.send",e.chain({stopOnFalse:!0})),e.setObjectPath(t,"chains.request.fetch.send",e.chain({stopOnFalse:!0})),e.setObjectPath(t,"chains.response.success",e.chain({stopOnFalse:!0})),e.setObjectPath(t,"chains.response.done",e.chain({stopOnFalse:!0})),e.setObjectPath(t,"chains.response.fail",e.chain({stopOnFalse:!0})),e.setObjectPath(t,"chains.response.ajax.success",e.chain({stopOnFalse:!0})),e.setObjectPath(t,"chains.response.ajax.done",e.chain({stopOnFalse:!0})),e.setObjectPath(t,"chains.response.ajax.fail",e.chain({stopOnFalse:!0})),e.setObjectPath(t,"chains.response.fetch.success",e.chain({stopOnFalse:!0})),e.setObjectPath(t,"chains.response.fetch.done",e.chain({stopOnFalse:!0})),e.setObjectPath(t,"chains.response.fetch.fail",e.chain({stopOnFalse:!0})),e.setObjectPath(t,"chains.search.control",e.chain({stopOnFalse:!0})),e.setObjectPath(t,"chains.type.staticContent",e.chain({stopOnFalse:!0})),e.setObjectPath(t,"chains.type.hideBanner",e.chain({stopOnFalse:!0})),t.data={powerUp:{apiKey:!1,url:!1,executeAfter:!1},context:{eventAction:"",preventDefault:!1,status:null,isSuccess:!1,apiKey:null,recId:null},request:{settings:{url:null}},response:{}},{init:function(e,n){t.element=n,t.element.recsObject=e,t.element.recsScope=t,t.element.recsElem=t.element},setScope:function(e){return t=e},getScope:function(){return t},addActiveFile:function(){t.settings.settings.recs.activeFiles++},removeActiveFile:function(){t.settings.settings.recs.activeFiles--},powerUp:function(){var n=e.getObjectPath(t,"chains.actions.load");e.isUndefined(n)||0===n.list().length||(n.setScope(t.element),n.setData(t.data),n.fire())}}},clone:function(t){var n=e.recs.base,s=e.recs.build();return s.setScope(e.extend(!0,{},n.getScope())),s.init(s,t.element),e.setSetting(s.getScope().element.recsScope.settings,"settings.recs.apiKey",t.apiKey),e.setSetting(s.getScope().element.recsScope.settings,"settings.recs.recId",t.recId),s.getScope().id=e.randomId(),s.getScope().searchObject=null,s.getScope().kmcData=null,e.recs.list.push(s),s}}});e({url:{recsSource:"//js.klevu.com/recs/",recsEndpoint:"//config-cdn.ksearchnet.com/recommendations/"},recs:{active:!1,nocache:!1,activeFiles:0},console:{type:{recs:!1}}})}(klevu),function(e){var t=e.recs.build();t.getScope().chains.core.coreLoad.add({name:"resetActiveFiles",fire:function(t,n){e.getSetting(n.recsScope.settings,"settings.recs.activeFiles",0)>0&&e.settings.console.type.recs&&logInfo("RECS - A new load can not start as last one did not finish"),e.setSetting(n.recsScope.settings,"settings.recs.activeFiles",0)}}),t.getScope().chains.core.coreLoad.add({name:"getApikey",fire:function(t,n){if(t.apiKey=e.getSetting(n.recsScope.settings,"settings.recs.apiKey",e.getSetting(n.recsScope.settings,"settings.search.apiKey",e.getGlobalSetting("global.apiKey"))),!t.apiKey)return e.settings.console.type.recs&&logInfo("RECS - API key can not be detected"),!1}}),t.getScope().chains.core.coreLoad.add({name:"getHostUrl",fire:function(t,n){t.url="https:"+e.getSetting(n.recsScope.settings,"settings.url.recsSource")+t.apiKey+"/"}}),t.getScope().chains.core.coreLoad.add({name:"getCache",fire:function(t,n){if(t.nocache=e.getSetting(n.recsScope.settings,"settings.recs.nocache",!1),"true"==t.nocache){e.settings.console.type.recs&&logInfo("RECS - Nocache active");var s=Math.floor(900000001*Math.random())+1e8;t.nocache="?"+s}else t.nocache=""}}),t.getScope().chains.core.coreLoad.add({name:"setChainAfter",fire:function(e,t){e.powerUp.executeAfter="chains.core.extraLoad"}}),t.getScope().chains.core.coreLoad.add({name:"loadJs",fire:function(t,n){n.recsObject.addActiveFile(),e.assets.getFile({url:t.url+".js"+t.nocache,type:"js",options:{scope:n,successCallback:e.recs.events.request.done,errorCallback:e.recs.events.request.done}})}}),t.getScope().chains.core.extraLoad.add({name:"setChainAfter",fire:function(e,t){e.powerUp.executeAfter="chains.core.interactive"}}),t.getScope().chains.actions.load.add({name:"checkSettings",fire:function(t,n){var s=e.getObjectPath(n.recsScope,"chains.processors.settings");if(e.isUndefined(s)||0===s.list().length||(s.setScope(n.recsElem),s.setData(t),s.fire()),n.recsScope.data=t,!0===t.context.preventDefault)return!1}}),t.getScope().chains.actions.load.add({name:"doRequest",fire:function(t,n){t.context.doCall=!1;var s=e.getObjectPath(n.recsScope,"chains.request.control");if(e.isUndefined(s)||0===s.list().length)return t.context.preventDefault=!0,n.recsScope.data=t,!1;s.setScope(n.recsElem),s.setData(t),s.fire(),n.recsScope.data=t}}),t.getScope().chains.processors.settings.add({name:"checkDefinedApi",fire:function(t,n){if(e.isUndefined(t.context.recId))return t.context.preventDefault=!0,!1}}),t.getScope().chains.request.ajax.send.add({name:"sendRequest",fire:function(t,n){"recsAjax"===t.context.eventAction&&(t.scope=n,t.context.doCall?(t.context.requestObject={url:t.request.settings.url,type:"AJAX",method:"GET",mimeType:"application/json; charset=UTF-8",contentType:"application/json; charset=utf-8",dataType:"json",crossDomain:!0,success:function(t){var n=e.getObjectPath(t.requestDetails.scope.recsScope,"chains.response.success");e.isUndefined(n)||0===n.list().length||(n.setScope(t.requestDetails.scope.recsElem),e.setObjectPath(t.requestDetails,"response.data",t.responseObj.data),e.setObjectPath(t.requestDetails,"context.status",t.status),e.setObjectPath(t.requestDetails,"context.isSuccess",t.isSuccess),n.setData(t.requestDetails),n.fire())},done:function(t){var n=e.getObjectPath(t.requestDetails.scope.recsScope,"chains.response.done");e.isUndefined(n)||0===n.list().length||(n.setScope(t.requestDetails.scope.recsElem),e.setObjectPath(t.requestDetails,"response.data",t.responseObj.data),e.setObjectPath(t.requestDetails,"context.status",t.status),e.setObjectPath(t.requestDetails,"context.isSuccess",t.isSuccess),n.setData(t.requestDetails),n.fire())},error:function(t){var n=e.getObjectPath(t.requestDetails.scope.recsScope,"chains.response.fail");e.isUndefined(n)||0===n.list().length||(n.setScope(t.requestDetails.scope.recsElem),e.setObjectPath(t.requestDetails,"response.data",{}),e.setObjectPath(t.requestDetails,"context.status",t.status),e.setObjectPath(t.requestDetails,"context.isSuccess",t.isSuccess),n.setData(t.requestDetails),n.fire())},data:""},t.context.requestDetails=t):e.settings.console.type.ajax&&(e.logError("chains.actions.doCall - makeRequest - Request object is not present or request was forced stopped."),e.logDebug("chains.actions.doCall - makeRequest - Data:"),e.logDebug(t)))}}),t.getScope().chains.request.fetch.send.add({name:"sendRequest",fire:function(t,n){"recsFetch"===t.context.eventAction&&(t.scope=n,t.context.doCall?(t.context.requestObject={url:t.request.settings.url,type:"FETCH",method:"GET",mimeType:"application/json; charset=UTF-8",contentType:"application/json; charset=utf-8",dataType:"json",crossDomain:!0,success:function(t,n,s,a){var i=e.getObjectPath(n.scope.recsScope,"chains.response.success");e.isUndefined(i)||0===i.list().length||(i.setScope(n.scope.recsElem),e.setObjectPath(n,"response.data",t),e.setObjectPath(n,"context.status",s),e.setObjectPath(n,"context.isSuccess",a),i.setData(n),i.fire())},error:function(t,n,s){var a=e.getObjectPath(t.scope.recsScope,"chains.response.fail");e.isUndefined(a)||0===a.list().length||(a.setScope(t.scope.recsElem),e.setObjectPath(t,"response.data",{}),e.setObjectPath(t,"context.status",n),e.setObjectPath(t,"context.isSuccess",s),a.setData(t),a.fire())},data:""},t.context.requestDetails=e.extend(!0,{},t)):e.settings.console.type.ajax&&(e.logError("chains.actions.doCall - makeRequest - Request object is not present or request was forced stopped."),e.logDebug("chains.actions.doCall - makeRequest - Data:"),e.logDebug(t)))}}),t.getScope().chains.request.control.add({name:"initRequest",fire:function(t,n){t.context.doCall=!0;var s=e.getObjectPath(n.recsScope,"chains.request.build");return e.isUndefined(s)||0===s.list().length?(t.context.preventDefault=!0,n.recsScope.data=t,!1):(s.setScope(n.recsElem),s.setData(t),s.fire(),n.recsScope.data=t,!1!==t.context.doCall&&void 0)}}),t.getScope().chains.request.control.add({name:"generateURL",fire:function(t,n){var s=e.getSetting(n.recsScope.settings,"settings.url.recsEndpoint",!1);s&&(t.request.settings.url=e.settings.url.protocol+s+t.context.apiKey+"/settings/"+t.context.recId)}}),t.getScope().chains.request.control.add({name:"addQueryParamsToUrl",fire:function(t,n){var s=e.getObjectPath(t.request,"settings.url",!1);if(s){var a=[];a.push("cp="+encodeURIComponent(e.dom.helpers.convertHtmlToText(e.pageMeta.getData("page.category.categoryPath","")))),a.push("gpid="+encodeURIComponent(e.pageMeta.getData("page.pdp.products.0.itemGroupId",""))),a.push("pid="+encodeURIComponent(e.pageMeta.getData("page.pdp.products.0.itemId",""))),e.support.isActive("user")&&e.user.getSegments()&&a.push("sids="+encodeURIComponent(e.user.getSegments().join(","))),a.length>0&&(s=s+"?"+a.join("&"),t.request.settings.url=s)}}}),t.getScope().chains.request.control.add({name:"makeRequest",fire:function(t,n){var s=e.getObjectPath(n.recsScope,"chains.request.send");if(!e.isUndefined(s)&&0!==s.list().length)return s.setScope(n.recsElem),s.setData(t),s.fire(),n.recsScope.data=t,!1}}),t.getScope().chains.request.build.add({name:"buildMap",fire:function(t,n){t.context.status=null,t.context.isSuccess=!1,t.context.apiKey=e.getSetting(n.recsScope.settings,"settings.recs.apiKey",e.getGlobalSetting("search.apiKey",e.getGlobalSetting("global.apiKey"))),t.context.recId=e.getSetting(n.recsScope.settings,"settings.recs.recId",null),t.request.requestObject={}}}),t.getScope().chains.request.send.add({name:"checkFetch",fire:function(e,t){window.fetch?e.context.eventAction="recsFetch":e.context.eventAction="recsAjax"}}),t.getScope().chains.request.send.add({name:"requestTypeAjax",fire:function(t,n){if("searchAjax"===t.context.eventAction){var s=e.getObjectPath(n.recsScope,"chains.request.ajax.send");e.isUndefined(s)||0===s.list().length||(s.setScope(n.recsElem),s.setData(t),s.fire(),n.recsScope.data=t)}}}),t.getScope().chains.request.send.add({name:"requestTypeFetch",fire:function(t,n){if("searchAjax"!==t.context.eventAction){var s=e.getObjectPath(n.recsScope,"chains.request.fetch.send");e.isUndefined(s)||0===s.list().length||(s.setScope(n.recsElem),s.setData(t),s.fire(),n.recsScope.data=t)}}}),t.getScope().chains.request.send.add({name:"requestSend",fire:function(t,n){e.request(t.context.requestObject,t.context.requestDetails)}}),t.getScope().chains.response.success.add({name:"checkForSuccess",fire:function(e,t){if(t.recsElem.data=e,!1===e.context.isSuccess)return!1}}),t.getScope().chains.response.success.add({name:"executeAjaxResponseProcessor",fire:function(t,n){if("recsAjax"===t.context.eventAction){var s=e.getObjectPath(n.recsScope,"chains.response.ajax.success");e.isUndefined(s)||0===s.list().length||(s.setScope(n.recsElem),s.setData(t),s.fire()),n.recsScope.data=t}}}),t.getScope().chains.response.success.add({name:"executeFetchResponseProcessor",fire:function(t,n){if("recsFetch"===t.context.eventAction){var s=e.getObjectPath(n.recsScope,"chains.response.fetch.success");e.isUndefined(s)||0===s.list().length||(s.setScope(n.recsElem),s.setData(t),s.fire()),n.recsScope.data=t}}}),t.getScope().chains.response.success.add({name:"saveSettings",fire:function(t,n){n.recsScope.kmcData=e.getObjectPath(t.response,"data")}}),t.getScope().chains.response.success.add({name:"checkForHideBanner",fire:function(t,n){if("HIDE_RECOMMENDATION"===e.getObjectPath(n.recsScope,"kmcData.metadata.action",!1)){var s=e.getObjectPath(n.recsScope,"chains.type.hideBanner");return e.isUndefined(s)||0===s.list().length||(s.setScope(n.recsElem),s.setData(t),s.fire()),!1}}}),t.getScope().chains.response.success.add({name:"checkForStaticContent",fire:function(t,n){if("STATIC_CONTENT"===e.getObjectPath(n.recsScope,"kmcData.metadata.action",!1)){var s=e.getObjectPath(n.recsScope,"chains.type.staticContent");return e.isUndefined(s)||0===s.list().length||(s.setScope(n.recsElem),s.setData(t),s.fire()),!1}}}),t.getScope().chains.response.success.add({name:"buildTheSearchObject",fire:function(t,n){n.recsScope.searchObject=e.searchObjectClone(e.search.base),n.recsScope.searchObject.setWebhookSettings({scope:"all,block,recs"})}}),t.getScope().chains.response.success.add({name:"executeSearchObjectPowerUp",fire:function(t,n){var s=e.getObjectPath(n.recsScope,"chains.search.control");e.isUndefined(s)||0===s.list().length||(s.setScope(n.recsElem),s.setData(t),s.fire()),n.recsScope.data=t}}),e.extend(!0,e,{recs:{base:t,baseBuild:!0}})}(klevu),klevu.support.register({name:"recs",loaded:!0,active:!0,dependency:["core.lib","search"]});